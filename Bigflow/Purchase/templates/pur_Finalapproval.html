{% extends 'Shared/mainLayout.html' %}
{% load static from staticfiles %}
{% block title %}PR Approved Summary  {% endblock %}
{% block content %}
{% csrf_token %}
{% verbatim %}
<div class="maincontent">
    <div class="container container1" ng-app="prApproved" ng-controller="CtrlprApproved" ng-cloak>
        <div class="row">
            <div class="row-header col-lg-12 col-sm-12">
                <h4>PR Approved Summary</h4>
            </div>
        </div>
        <div class="row">
            <div class="col-md-3">
                <md-input-container class="md-block inputcontainer">
                   <label>PR NO</label>
                   <input type="text" ng-model="prno"
                          maxlength="64>=1"  ng-change="searchDetails()"
                          ng-required="value" >
                </md-input-container>
             </div>
            <div class="col-md-3">
                    <md-autocomplete
                            md-clear-button="true"
                            md-floating-label="Supplier Name"
                            md-item-text="item.supplier_name"
                            md-input-maxlength=12
                            md-min-length=0
                            md-items="item in getsupp1(searchText5)"
                            md-no-cache="true"
                            md-search-text="searchText5"
                            md-selected-item="ddlstatus1_supplier"
                            md-selected-item-change="searchDetails()"
                            layout-fill>
                        <md-item-template>
                            <span md-highlight-text="searchText5">{{item.supplier_name}}</span>
                        </md-item-template>
                        <md-not-found>
                            No dispatch matching "{{searchText5}}" were found.
                        </md-not-found>
                    </md-autocomplete>
                </div>
            <div class="col-md-3">
                <md-autocomplete
                            md-clear-button="true"
                            md-floating-label="Commodity Name"
                            md-input-maxlength=40
                            md-item-text="item.commodity_name"
                            md-items="item in commodity(searchText)"
                            md-min-length=0
                            md-no-cache="true"
                            md-search-text="searchText"
                            md-selected-item="commodityname1"
                            md-selected-item-change="searchDetails()"
                           >
                        <md-item-template>
                            <span md-highlight-text="searchText"> {{item.commodity_name}} </span>
                        </md-item-template>
                        <md-not-found>
                            No product matching "{{searchText}}" were found.
                        </md-not-found>
                    </md-autocomplete>
            </div>
            <div class="col-md-3">
                <md-autocomplete
                    md-item-text="item.product_name"
                    md-items="item in product_Search(searchTex)"
                    md-min-length=0
                    md-no-cache="true"
                    md-search-text="searchTex"
                    md-selected-item="prodnme"
                    md-selected-item-change="searchDetails()"
                    md-floating-label="Product Name"
                    md-clear-button="true">
                    <md-item-template>
                        <span md-highlight-text="searchTex"> {{item.product_displayname}} </span>
                    </md-item-template>
                    <md-not-found>
                        No Product Name matching "{{searchTex}}" were found.
                    </md-not-found>
                </md-autocomplete>
                            </div>
        </div>
        <div class="row">
            <div class="col-md-3">
                    <md-autocomplete
                            md-clear-button="true"
                            md-floating-label="Branch Name"
                            md-input-maxlength=126
                            md-item-text="item.branch_name"
                            md-items="item in getbranch(searchText1)"
                            md-min-length=0
                            md-no-cache="true"
                            md-search-text="searchText1"
                            md-selected-item="branch_content"
                            md-selected-item-change="searchDetails()"
                           >
                        <md-item-template>
                            <td md-highlight-text="searchText1">
                                {{item.branch_name}}
                            </td>
                        </md-item-template>
                        <md-not-found>
                            No product matching "{{searchText1}}" were found.
                        </md-not-found>
                    </md-autocomplete>
                </div>
        </div>
        <div class="row table-responsive">
            <div class="col-md-12 col-lg-12 col-sm-12">
                <form name="demoForm">
                <table class="table table-striped table-bordered table-condensed table-hover md-primary">
                    <thead class="header">
                    <tr>
                        <th>S.No</th>
                        <th>PR Number</th>
                        <th>Product Name</th>
                        <th>Commodity Name</th>
                        <th>Branch Name</th>
                        <th>Supplier Name</th>
                        <th ng-hide="true">Unit Price</th>
                        <th>MEP Number</th>
                        <th ng-hide="true">DTS Status</th>
                        <th>Request Quantity</th>
                        <th>Remaining  Quantity</th>
                        <th>Delivery CCBS</th>
                        <th ng-hide="true">Quantity</th>
                        <th ng-hide="true">ADD</th>
                        <th ng-hide="true">Tax Amount</th>
                        <th ng-hide="true">Total</th>
                        <th ng-hide="true">Action</th>
                        <th ng-hide="true">Action1</th>

                    </tr>
                    </thead>
                    <tbody>
                    <tr ng-repeat="emp in listproductnamepo.slice(((currentPage-1)*itemsPerPage), ((currentPage)*itemsPerPage)) " >
                        <td>
                            <center>{{((currentPage-1)*itemsPerPage)+$index+1}}</center>
                        </td>
                        <td class="text-center">{{emp.prheader_no}}</td>
                        <td class="text-center">{{emp.product_name}}</td>
                        <td class="text-center">{{emp.commodity_name}}</td>
                        <td class="text-center">{{emp.branch_name}}</td>
                        <td class="text-center">{{emp.supplier_name}}</td>
                        <td class="text-right" ng-hide="true">{{emp.supplierproduct_unitprice}}</td>
                        <td class="text-center">{{emp.prheader_mepno}} {{emp.supplierproduct_dts}}</td>
                        <td ng-hide="true" ng-if="emp.supplierproduct_dts=='Y' "
                           ng-class="emp.supplierproduct_dts=='Y' ? 'text-success':''">
                           DTS
                        </td>
                        <td ng-hide="true" ng-if="emp.supplierproduct_dts=='N' "
                            ng-class="emp.supplierproduct_dts=='N' ? 'info':'danger'">
                           NON-DTS
                        </td>
                        <td class="text-right">
                            {{emp.prdetails_qty}}
                        </td>
                        <td class="text-right">
<!--                                    <span-->
<!--                                    ng-if="emp.remaining_qty-emp.prdetails_qty1-emp-->
<!--                                    .add_button<0">-->
<!--                                        {{emp.remaining_qty-emp.prdetails_qty1+1-emp.add_button}}-->
<!--                                    </span>-->
<!--                                        <span-->
<!--                                        ng-if="emp.remaining_qty-emp.prdetails_qty1-emp-->
<!--                                    .add_button>=0">-->
<!--                                        {{emp.remaining_qty-emp.prdetails_qty1-emp.add_button}}-->
<!--                                    </span>-->

                            {{emp.remaining_qty}}
                        </td>
                        <td align="center">
                            <button class="btn btn-success" ng-click="ccbs_popup(emp)">
                            Assign CCBC
                                <md-tooltip>Aggregate ccbs Quantity</md-tooltip>
                            </button>
                        </td>
                        <!-- <td class="text-right">{{emp.prdetails_qty-emp.prdetails_qty1}}</td> -->
                        <td align="right" ng-hide="true">
                            <form name="demoForm_form" novalidate>
                                <input align="right"  name="qty" type="text"
                                    maxlength="4" ng-model="emp.prdetails_qty1"
                                       ng-init="emp.prdetails_qty1=0"
                                       ng-disabled="addfun"numbers-only
                                    class="form-control"
                                       ng-change="emp.prdetails_qty1<=emp.remaining_qty ||
                                                  emp.prdetails_qty1 == '' ||
                                                  emp.prdetails_qty1 == undefined ||
                                                  emp.prdetails_qty1 == null
                                                   ?
                                                  emp.prdetails_qty1=emp.prdetails_qty1:
                                                  emp.prdetails_qty1=0 "
                                       required>
                            </form>
                        </td>
                        <td style="width:100px" align="center" ng-hide="true">
                            <div class="btn-group btn-group-sm"  aria-label="Basic example">
                                    <button type="button"
                                            ng-click="emp.prdetails_qty1<emp.remaining_qty ?
                                            emp.prdetails_qty1=(emp.prdetails_qty1*1)+(1*1)  : '' "
                                            class="btn btn-secondary"
                                            style="background-color:green;color:white;
                                            border-color:green"
                                            >
                                        +{{emp.prdetails_qty1}}
                                    </button>
                                    <button type="button"
                                            ng-click="emp.prdetails_qty1>0 ?
                                            emp.prdetails_qty1=(emp.prdetails_qty1*1)-(1*1) : '';
                                            "
                                            class="btn btn-secondary"
                                            style="background-color:white;color:green;
                                            border-color:green">
                                        -
                                    </button>
                            </div>
                        </td>
                        <td class="text-right" ng-hide="true">{{emp.hsn_igstrate}}</td>
                        <td class="text-right"ng-model="emp.tot"
                            ng-if="emp.prdetails_qty1!=undefined" ng-hide="true">
                            <span ng-model="emp.tot" >
                                {{
                                emp.prdetails_qty1*emp.supplierproduct_unitprice+
                                (emp.prdetails_qty1*emp.supplierproduct_unitprice*
                                emp.hsn_igstrate/100) |number :2
                                }}
                            </span>
                        </td>
                        <td ng-if="emp.prdetails_qty1==undefined" ng-hide="true"></td>
                        <td ng-hide="true">
                            <input type="checkbox" ng-model="emp.checked"
                                    ng-click="checkbox(emp)" />
                        </td>
                        <td ng-hide="true">
<!--                            ng-class="custo.customer_isactive=='Y'? 'editlink':''"-->
                            <button class="btn btn-success"
                                    ng-init="emp.add_button=0;"
                                    ng-model="emp.add_button"

                                    ng-click="gotoDetails(emp);
                                    emp.remaining_qty=emp.remaining_qty-emp.prdetails_qty1;
                                    emp.prdetails_qty1=0;
                                    "
                                    ng-disabled="emp.prdetails_qty1*1>0 &&
                                    (emp.remaining_qty*1-emp.prdetails_qty1*1-emp.add_button*1+1)>0
                                    ? false : true">
<!--                                {{emp.prdetails_qty1}}-->
<!--                                {{add_dis}}-->
                                ADD
                            </button>
                        </td>
                    </tr>
                    <tr ng-show="listproductnamepo.length ==  0">
                        <td class="warning" colspan="21">
                            No Records Found.
                        </td>
                    </tr>
                    </tbody>
                    <tfoot>
                    <tr>
                        <div class="col-md-12 col-lg-12 col-sm-12">
                            <td colspan="15">
                                <ul boundary-links="true" class="pagination-sm cust_pagination"
                                    items-per-page="itemsPerPage"
                                    max-size="maxSize"
                                    ng-model="currentPage" total-items="listproductnamepo.length"
                                    uib-pagination></ul>
                            </td>
                        </div>
                    </tr>

<!--                    <tr>-->
<!--                        <td colspan="15" align="right"><b>Total</b></td>-->
<!--                        <td colspan="1" align="right">-->
<!--                            <span ng-if="purchase.length == 0"><b>{{total}}</b></span>-->
<!--                            <span ng-if="purchase.length > 0"><b>{{loaddata()| number:2}}</b></span>-->
<!--                        </td>-->

<!--                </tr>-->

                    </tfoot>
                </table>
                </form>
            </div>
        </div>
        <div class="row">
            <md-subheader class="md-accent" ><h4>PO Aggregated Summary :</h4></md-subheader>
        </div>
            <marquee behavior="scroll" direction="left"
               onmousedown="this.stop();"
               onmouseup="this.start();">
              <h5>Note : Choose the Approperiate Data from PR Aggregate Summary</h5>
            </marquee>
        <br>
        <div class="row">
            <div class="col-md-3">
                <md-autocomplete
                            md-clear-button="sub_supplier_clear_button"
                            md-floating-label="Supplier Name"
                            md-item-text="item.supplier_name"
                            md-input-maxlength=126
                            md-min-length=0
                            md-items="item in getsupper(searchText2)"
                            md-no-cache="true"
                            md-search-text="searchText2"
                            md-selected-item="ddlstatus"
                            md-selected-item-change="ccbsglno(chk)"
                            required>
                        <md-item-template>
                            <span md-highlight-text="searchText2"> {{item.supplier_name}} </span>
                        </md-item-template>
                        <md-not-found>
                            No dispatch matching "{{searchText2}}" were found.
                        </md-not-found>
                    </md-autocomplete>
            </div>
            <div class="col-md-3" style="margin-top:34px">
                Supplier Name : <span style="color:#D9534F;font-size:13px">
                {{ddlstatus.supplier_name}}
                </span>
            </div>
        </div>
        <br>
        <div class="row table-responsive">
            <div class="col-md-12 col-lg-12 col-sm-12" >
                <form name="demoForm">
                <table class="table table-striped table-bordered table-condensed table-hover md-primary">
                    <thead class="header" style="background-color:#808080">
                    <tr>
                        <th>S.No</th>
                        <th>Product Name</th>
                        <th>Commodity Name</th>
                        <th>Total Quantity</th>
                        <th>Action</th>
                    </tr>
                    </thead>
                    <tbody>
                    <tr ng-repeat="po in poaggre_array.slice(((currentPage1-1)*itemsPerPage1), ((currentPage1)*itemsPerPage1)) " >
                        <td>
                            <center>{{((currentPage1-1)*itemsPerPage1)+$index1+1}}</center>
                        </td>
                        <td class="text-center">{{po.product_name}}</td>
                        <td class="text-center">{{po.commodity_name}}</td>
                        <td class="text-center"
                            ng-class="getTotal(po)>0?'success':'danger'"
                            ng-model="po.total_quatity=getTotal(po)"
                            >
                            {{getTotal(po)}}
                        </td>
                        <td class="text-center">
                            <span>
                                <i class="material-icons"
                                   class='btn btn-danger'
                                   ng-click="removeddl(po,$index)"
                                   style="font-size:30px;color:#cc0000">
                                    delete_forever
                                </i>
                                <md-tooltip>Remove Cart</md-tooltip>
                            </span>

                        </td>
                    </tr>
                    <tr ng-show="poaggre_array.length ==  0">
                        <td class="warning" colspan="8">
                            No Records Found.
                        </td>
                    </tr>
                    </tbody>
                    <tfoot>
                    <tr>
                        <div class="col-md-12 col-lg-12 col-sm-12">
                            <td colspan="8">
                                <ul boundary-links="true" class="pagination-sm cust_pagination"
                                    items-per-page="itemsPerPage1"
                                    max-size="maxSize1"
                                    ng-model="currentPage1" total-items="poaggre_array.length"
                                    uib-pagination></ul>
                            </td>
                        </div>
                    </tr>
                    </tfoot>
                </table>
                    <p>NOTE : Don't Make Any Mistakes , Did You  Refresh Page ,Data Will Be Erased.!!</p>
                </form>
            </div>
        </div>
        <div class="col-md-12 text-right">
                <md-button  href="createpoindex" class="md-raised">Back
                    <md-tooltip>Back</md-tooltip>
                </md-button>
<!--                <md-button ng-click="save_podetails(poheader_gid)" ng-hide="disable"-->
<!--                class="btn btn-info custbutton">Submit-->
<!--                <md-tooltip>Submit</md-tooltip>-->
<!--                </md-button>-->
                <md-button class="md-raised md-warn"
                           ng-click="submitfun(poaggre_array)">
                submit
                </md-button>
        </div>
        <div class="row">
            <div class="col-lg-12 col-sm-12" ng-include="'prheader_ccbs'"></div>
        </div>
    </div>
</div>
{% endverbatim %}
<script>
    var myApp = angular.module('prApproved', ['ngMaterial', 'ui.bootstrap', 'ngMessages','AppCommon'])
        .config(function($httpProvider) {
            $httpProvider.defaults.xsrfCookieName = 'csrftoken';
            $httpProvider.defaults.xsrfHeaderName = 'X-CSRFToken';
        });

myApp.run(function($mdDateLocale, $filter) {
    $mdDateLocale.formatDate = function(date) {
        return $filter('date')(date, "dd-MMM-yyyy");
    };
})


myApp.directive('numbersOnly', function () {
   return {
       require: 'ngModel',
       link: function (scope, element, attr, ngModelCtrl) {
           function fromUser(text) {
               if (text) {
                   var transformedInput = text.replace(/[^0-9]/g, '');
                   if (transformedInput !== text) {
                       ngModelCtrl.$setViewValue(transformedInput);
                       ngModelCtrl.$render();
                   }
                   return transformedInput;
               }
               return undefined;
           }
           ngModelCtrl.$parsers.push(fromUser);
       }
   };
});

myApp.controller('CtrlprApproved', ['$scope', 'ApprovedtService', '$mdDialog', 'SerCommon' , '$mdToast', '$rootScope', '$window', '$filter','$interval', '$timeout', '$element',
    function($scope, ApprovedtService, $mdDialog , SerCommon , $mdToast,  $rootScope, $window, $filter,$interval,$timeout,$element)
    {


        $scope.currentPage = 1;
        $scope.maxSize = 3;
        $scope.itemsPerPage = 10;
        $scope.currentPage2 = 1;
        $scope.maxSize2 = 3;
        $scope.itemsPerPage2 = 10;
        $scope.currentPage1 = 1;
        $scope.maxSize1 = 3;
        $scope.itemsPerPage1 = 10;
        var detail = JSON.parse(sessionStorage.getItem('today'));
        $scope.employgid = detail.employee_gid;
        $scope.entity_gid = detail.entity_gid;
        $scope.empsmry=[];
        $scope.maintable=[];
        $scope.maintemp_data=[];
        //$scope.count=0;
        $scope.addfun=false;
        $scope.poaggre_array=[];
        $scope.delivery_details_array=[];
        $scope.total1=0;
        $scope.vendor_array=[];
        $scope.sub_supplier_clear_button=true;
        $scope.ccbsdetailarray=[];
        //$scope.listproductnamepo=[];
        //$scope.maintemp_data=[];
        $scope.emp=[];
        $scope.temparray=[];
        $scope.POsupplier_list=[];
        $scope.temparray=[];

         $scope.endloading = function()
         {
            $mdDialog.hide();
         };

        $scope.loading = function()
        {
            $mdDialog.show({
                templateUrl: 'loaderSpinner',
                parent: angular.element(document.body),
                clickOutsideToClose: false
            });
        };

            debugger;
<!--            $scope.loading();-->
            loadmain();
<!--            $scope.endloading();-->
            function loadmain()
            {
                $scope.loading();
                var productname = ApprovedtService.getprcesmry();
                productname.then(function (productname)
                {
                debugger;
                var result = (productname.data);
                $scope.maintemp_data=result;
                $scope.listproductnamepo = result;
                sub_load(result);
                   }).finally($scope.endloading);
            }

            function sub_load(result)
            {
                $scope.listproductnamepo = result;
                $scope.listproductnamepo.forEach(function(v)
                {
                    v.temp_remaining_qty=v.remaining_qty;
                    v.ccbs_details.forEach(function(x)
                    {
                    x.remaining_qty=x.prccbs_remaining_qty_Value
                    //x.remaining_qty=x.prccbs_qty
                    x.temp_reftable=JSON.parse(x.temp_reftable)
                    });
                });

                $scope.maintable = $filter('orderBy')(result, '-prheader_gid');

                for (var i = 0; i < $scope.listproductnamepo.length; i++) {
                    debugger;
                        if ($scope.listproductnamepo[i].remaining_qty===0) {

                            var index = i;
                            $scope.listproductnamepo.splice(i, 1);
                        }
                    }

            }
        //----------------------------------------------->search Details Autocomplete values


        // supplier----------------------------->

         $scope.getsupp1 = getsupplier11;

         function getsupplier11(query)
         {
            var result = $filter('filter')($scope.POsupplier_list, {
                'supplier_name': query
            });
            return result;
         }


            var posupplier = ApprovedtService.getdropdown("supplier")
            posupplier.then(function (posupplier) {
                debugger;
                var  posupplier = JSON.parse(posupplier.data)
                $scope.POsupplier_list = posupplier;
            });



        // Branch Name------------------------------------------->

        $scope.getbranch = goto;

         function goto(query) {
                    var result = $filter('filter')($scope.brncode, {
                        'branch_name': query
                    });
                    return result;
                }



         var brancode = ApprovedtService.branchresult()
            brancode.then(function (result) {
            debugger;
                $scope.brncode = JSON.parse(result.data);

            }, function () {
                alert("Record Not Found")
            });


        //------------Commodity Name------------------------------------->

          $scope.commodity = gotocust;

          function gotocust(query)
          {
                var result = $filter('filter')($scope.commodityname, {
                    'commodity_name': query
                });
                return result;
          }


            var commodityname = ApprovedtService.commodity($scope.entity_gid);
            debugger;
            commodityname.then(function (commodityname)
            {
                $scope.commodityname = JSON.parse(commodityname.data);
            },
            function (err) {
                alert('No data!.');
            }).finally();

      //---------------Product Name---------------------------------->
      $scope.product_Search = gotoproduct;

      function gotoproduct(query)
      {
        var result = $filter('filter')($scope.prodget, {
            'product_displayname': query
        });
        return result;
      }

       loadprod();

       function loadprod() {
            var data = {
                Table_name: 'gal_mst_tproduct',
                Column_1: 'product_gid,product_name,product_displayname,product_unitprice',
                Column_2: '',
                Where_Common: 'product',
                Where_Primary: 'tradingitem',
                Primary_Value: 'Y',
                Order_by: 'producttype_gid'
            }

            var data_prod = {
                Action: '',
                Entity_Gid: $scope.entity_gid,
                data: data
            };
            getprodname(data_prod);
        }


        function getprodname(data_prod)
         {
            var get_state = ApprovedtService.getprod(data_prod)
            get_state.then(function(result) {
                    $scope.prodget = result.data.DATA;
                }, function(err) {
                    alert('No data!.');
                })
                .finally();
        };


        $scope.ccbs_sub=function()
        {
        //alert(JSON.stringify($scope.temparray));


        var check_validate=$filter('filter')($scope.poaggre_array,
            {
            "commodity_name":$scope.temparray.commodity_name
            });

            if(check_validate.length == 0  && $scope.poaggre_array.length > 0)
            {

            var check_validate1=$filter('filter')($scope.listproductnamepo,
            {
            "prheader_no":$scope.temparray.prheader_no
            });
            alert('Choose the Same Commodity Name..!');
            var index=$scope.listproductnamepo.indexOf(check_validate1[0]);
            $scope.listproductnamepo[index].remaining_qty=
            parseInt($scope.listproductnamepo[index].remaining_qty) +  parseInt($scope.temparray.prdetails_qty1);
            return false;
            }

<!--            $scope.emp.remaining_qty=$scope.emp.remaining_qty-$scope.emp.prdetails_qty1;-->

            var result=$filter('filter')($scope.poaggre_array,
            {
            "product_name":$scope.temparray.product_name,
            "commodity_name":$scope.temparray.commodity_name
            });
        if(result.length >=1)
        {
            var index=$scope.poaggre_array.indexOf(result[0]);
            $scope.id=$scope.poaggre_array[index];
            $scope.bb=$scope.id.delivery_details;
            // checking already same prheader or not Otherwise data   size is increased.

           var check_validate=$filter('filter')($scope.bb,
            {
            "prheader_gid":$scope.temparray.prheader_gid
            });
            if(check_validate.length == 0)
            {

                $scope.pr_ccbs_array=[];
                var total=0;
                $scope.ccbsdetailarray.forEach(function(v)
                {
                v.ccbs_qty=parseInt(v.ccbs_qty);
                $scope.pr_ccbs_array.push(v);
                total = parseInt(total)+parseInt(v.ccbs_qty);
                });

                $scope.ccbsdetailarray.forEach(function(v)
                {
                v.remaining_qty = parseInt(v.remaining_qty)-parseInt(v.ccbs_qty);
                //v.ccbs_qty=0;
                });

                $scope.listproductnamepo.forEach(function(v)
                {
                    if(v.prheader_gid == $scope.temparray.prheader_gid && v.product_gid == $scope.temparray.product_gid )
                    {
                    v.remaining_qty=parseInt(v.remaining_qty)-parseInt(total)
                    }
                });

            var data1={
                            "prheader_gid":$scope.temparray.prheader_gid,
                            "prheader_no":$scope.temparray.prheader_no,
                            "prdetails_gid":$scope.temparray.prdetails_gid,
                            "prdetails_productname":$scope.temparray.product_name,
                            "qty":total,
                            "pr_ccbs":$scope.pr_ccbs_array,
                            "product_gid":$scope.temparray.product_gid,
                            "branch_name":$scope.temparray.branch_name,
                            "commodity_name":$scope.temparray.commodity_name,
                            "supplier_name":$scope.temparray.supplier_name,
                            "supplier_gid":$scope.temparray.supplier_gid,
                            "Address":$scope.temparray.address_1,
                            "City":$scope.temparray.City_Name,
                            "District":$scope.temparray.district_name,
                            "State":$scope.temparray.state_name,
                            "Pincode":$scope.temparray.address_pincode
                       }
            $scope.bb.push(data1);
            modalhide('mdl_present');
            }
            else
            {

                //alert($scope.bb[0].pr_ccbs);
                //alert(JSON.stringify($scope.temparray.ccbs_details));

                //------------>current ccbs_qty from same pr line item
                var total_ccbs_qty=0;
                $scope.temparray.ccbs_details.forEach(function(z)
                {
                z.ccbs_qty=parseInt(z.ccbs_qty);
                total_ccbs_qty=total_ccbs_qty+parseInt(z.ccbs_qty);
                });

                //------------>adding value from current ccbs_qty to previous ccbs_qty

                //$scope.bb[0].qty=parseInt($scope.bb[0].qty)+parseInt(total_ccbs_qty);
                $scope.bb.forEach(function(gg)
                {
                    if(gg.prheader_gid == $scope.temparray.prheader_gid)
                    {
                    gg.qty=total_ccbs_qty;
                    gg.pr_ccbs.forEach(function(yy)
                    {
                    //yy.remaining_qty=yy.prccbs_qty-yy.ccbs_qty;
                    yy.remaining_qty=yy.prccbs_remaining_qty_Value-parseInt(yy.ccbs_qty);
                    })
                    }
                });

                //$scope.bb[0].qty=parseInt(total_ccbs_qty);

                //------------>decrease the main pr content remaining qty value.
                $scope.temparray.remaining_qty=parseInt($scope.temparray.temp_remaining_qty)-parseInt(total_ccbs_qty);

<!--                $scope.bb.pr_ccbs.forEach(function(x)-->
<!--                {-->
<!--                x.remaining_qty=x.prccbs_qty-x.ccbs_qty;-->
<!--                });-->
                modalhide('mdl_present');
             }

<!--                $scope.bb.forEach(function(v)-->
<!--                {-->
<!--                    if(v.prheader_gid ==$scope.temparray.prheader_gid)-->
<!--                    {-->
<!--                        v.qty=parseInt(v.qty)+parseInt($scope.temparray.prdetails_qty1);-->
<!--                    }-->
<!--                    else-->
<!--                    {-->

<!--                        var data1={-->
<!--                            "prheader_gid":$scope.temparray.prheader_gid,-->
<!--                            "prheader_no":$scope.temparray.prheader_no,-->
<!--                            "prdetails_gid":$scope.temparray.prdetails_gid,-->
<!--                            "prdetails_productname":$scope.temparray.product_name,-->
<!--                            "qty":$scope.temparray.prdetails_qty1,-->
<!--                            "product_gid":$scope.temparray.product_gid,-->
<!--                            "branch_name":$scope.temparray.branch_name,-->
<!--                            "commodity_name":$scope.temparray.commodity_name,-->
<!--                            "supplier_name":$scope.temparray.supplier_name,-->
<!--                            "supplier_gid":$scope.temparray.supplier_gid,-->
<!--                            "Address":$scope.temparray.address_1,-->
<!--                            "City":$scope.temparray.City_Name,-->
<!--                            "District":$scope.temparray.district_name,-->
<!--                            "State":$scope.temparray.state_name,-->
<!--                            "Pincode":$scope.temparray.address_pincode-->
<!--                            }-->
<!--                            $scope.bb.push(data1);-->
<!--                    }-->
<!--                });-->
        }


            if(result.length == 0)
            {
            //--------------make note on it
                $scope.pr_ccbs_array=[];
                var total=0;
                $scope.ccbsdetailarray.forEach(function(v)
                {
                v.ccbs_qty=parseInt(v.ccbs_qty);
                $scope.pr_ccbs_array.push(v);
                total = parseInt(total)+parseInt(v.ccbs_qty);
                });

                $scope.ccbsdetailarray.forEach(function(v)
                {
                v.remaining_qty = parseInt(v.remaining_qty)-parseInt(v.ccbs_qty);
                //v.ccbs_qty=0;
                });

                $scope.listproductnamepo.forEach(function(v)
                {
                    if(v.prheader_gid == $scope.temparray.prheader_gid && v.product_gid == $scope.temparray.product_gid )
                    {
                    v.remaining_qty=parseInt(v.remaining_qty)-parseInt(total)
                    }
                });




                $scope.delivery_details_array=[];
                var data={
                    "prheader_gid":$scope.temparray.prheader_gid,
                    "prdetails_gid":$scope.temparray.prdetails_gid,
                    "prheader_no":$scope.temparray.prheader_no,
                    "product_gid":$scope.temparray.product_gid,
                    "prdetails_productname":$scope.temparray.product_name,
                    "qty":total,
                    "pr_ccbs":$scope.pr_ccbs_array,
                    "branch_name":$scope.temparray.branch_name,
                    "commodity_name":$scope.temparray.commodity_name,
                    "supplier_name":$scope.temparray.supplier_name,
                    "supplier_gid":$scope.temparray.supplier_gid,
                    "Address":$scope.temparray.address_1,
                    "City":$scope.temparray.City_Name,
                    "District":$scope.temparray.district_name,
                    "State":$scope.temparray.state_name,
                    "Pincode":$scope.temparray.address_pincode
                }

                $scope.delivery_details_array.push(data);

                var dta = {
                            "product_name":$scope.temparray.product_name,
                            "product_gid":$scope.temparray.product_gid,
                            "podetails_uom":$scope.temparray.uom_name,
                            "supplier_gid":$scope.temparray.supplier_gid,
                            "supplier_name":$scope.temparray.supplier_name,
                            "commodity_gid":$scope.temparray.commodity_gid,
                            "teamandcont_gid":0,
                            "commodity_name":$scope.temparray.commodity_name,
                            "delivery_details":$scope.delivery_details_array,
                            "tax_amount":$scope.temparray.hsn_igstrate
                          }
                    $scope.poaggre_array.push(dta);


                    $scope.vendor_array.push($scope.temparray.product_gid);
                    var data={"Params":
                                    { "FILTER":
                                        {"li_list_data":$scope.vendor_array,
                                        "li_count":$scope.vendor_array.length
                                        },
                                    }
                             }

                    var data_int={
                                    "Action":"vendor_get",
                                    "data":data
                                }

                       var sum_details=ApprovedtService.details_sum(data_int)
                       sum_details.then(function(result)
                       {
                       debugger;
                       //alert(JSON.stringify(result));
                       $scope.supplier_dropdown_array=result.data;
                       });
                    modalhide('mdl_present')
            }

        }

        $scope.ccbs_popup=function(emp)
        {
            debugger;
            $scope.temparray=emp;
            $scope.pr_no=emp.prheader_no;
            $scope.unit_price=emp.supplierproduct_unitprice;
            $scope.ccbsdetailarray=emp.ccbs_details;
            if ($scope.poaggre_array.length>0)
            {
                var result=$filter('filter')($scope.poaggre_array,
                {
                "commodity_name":emp.commodity_name
                });

                if(result.length == 0)
                {
                alert('Kindly Choose the Same Commodity Name..!!')
                return false;
                }
            }
            modalshow('mdl_present');
        }
        //$scope.add_dis=false;

        //----------->supplier_dropdown

        $scope.getsupper = getsupplier1;

         function getsupplier1(query) {
                    var result = $filter('filter')($scope.supplier_dropdown_array, {
                        'supplier_name': query
                    });
                    return result;
                }


        $scope.submitfun=function(x)
        {
            debugger;
            var count=0;
            if($scope.ddlstatus == undefined || $scope.ddlstatus == '' || $scope.ddlstatus == null)
            {
            alert('Supplier Name is Mandatory.!!')
            return false;
            }
            x.forEach(function(x)
            {
                if(x.total_quatity == 0)
                {
                alert('Total Quantity is less than 1!!');
                count=1;
                }
            });

            if(count == 1)
            {
            return false;
            }


        $scope.json_object=JSON.parse($scope.ddlstatus.json_product_supplier_price);
        $scope.pocreate_data=x;
        $scope.pocreate_data.forEach(function(v)
        {
            $scope.json_object.forEach(function(u)
            {
            v.supplier_gid = $scope.ddlstatus.supplier_gid;
            v.supplier_name = $scope.ddlstatus.supplier_name;
            if (v.product_name == u.product_name )
            v.supplier_unit_price=u.supplierproduct_unitprice;
            });
         });
        var bb= $scope.pocreate_data;
        sessionStorage.setItem('PO_Creation',JSON.stringify(x));
        $window.location.href='createpoindex';

        }

        $scope.getTotal = function(x){
        //alert(x);
            var total = 0;
            for(var i = 0; i < x.delivery_details.length; i++)
            {
                var product = x.delivery_details[i];
                total = parseInt(total)+parseInt(product.qty);
            }
            return total;
        }

        $scope.get_ccbs_total = function(){
            var total = 0;
            for(var i = 0; i < $scope.ccbsdetailarray.length; i++)
            {
                var product = $scope.ccbsdetailarray[i];
                if(product.ccbs_qty == undefined)
                {
                product.ccbs_qty=0;
                }
                total = parseInt(total)+parseInt(product.ccbs_qty);
            }
            return total;
        }


        $scope.emp=[];
        $scope.gotoDetails=function(poaggre)
        {
        debugger;

            var check_validate=$filter('filter')($scope.poaggre_array,
            {
            "commodity_name":poaggre.commodity_name
            });

            if(check_validate.length == 0  && $scope.poaggre_array.length > 0)
            {

            var check_validate1=$filter('filter')($scope.listproductnamepo,
            {
            "prheader_no":poaggre.prheader_no
            });
            alert('Choose the Same Commodity Name..!');
            var index=$scope.listproductnamepo.indexOf(check_validate1[0]);
            $scope.listproductnamepo[index].remaining_qty=
            parseInt($scope.listproductnamepo[index].remaining_qty) +  parseInt(poaggre.prdetails_qty1);
            return false;
            }

<!--            $scope.emp.remaining_qty=$scope.emp.remaining_qty-$scope.emp.prdetails_qty1;-->

            var result=$filter('filter')($scope.poaggre_array,
            {
            "product_name":poaggre.product_name,
            "commodity_name":poaggre.commodity_name
            });
        if(result.length >=1)
        {
        var index=$scope.poaggre_array.indexOf(result[0]);
        $scope.id=$scope.poaggre_array[index];
        $scope.bb=$scope.id.delivery_details;

        //logic concept

            //alert($scope.bb.ccbs_details);



<!--                $scope.bb.forEach(function(v)-->
<!--                {-->
<!--                    if(v.prheader_gid ==poaggre.prheader_gid)-->
<!--                    {-->
<!--                        v.qty=parseInt(v.qty)+parseInt(poaggre.prdetails_qty1);-->
<!--                    }-->
<!--                    else-->
<!--                    {-->

<!--                        var data1={-->
<!--                            "prheader_gid":poaggre.prheader_gid,-->
<!--                            "prheader_no":poaggre.prheader_no,-->
<!--                            "prdetails_gid":poaggre.prdetails_gid,-->
<!--                            "prdetails_productname":poaggre.product_name,-->
<!--                            "qty":poaggre.prdetails_qty1,-->
<!--                            "product_gid":poaggre.product_gid,-->
<!--                            "branch_name":poaggre.branch_name,-->
<!--                            "commodity_name":poaggre.commodity_name,-->
<!--                            "supplier_name":poaggre.supplier_name,-->
<!--                            "supplier_gid":poaggre.supplier_gid,-->
<!--                            "Address":poaggre.address_1,-->
<!--                            "City":poaggre.City_Name,-->
<!--                            "District":poaggre.district_name,-->
<!--                            "State":poaggre.state_name,-->
<!--                            "Pincode":poaggre.address_pincode-->
<!--                            }-->
<!--                            $scope.bb.push(data1);-->
<!--                    }-->
<!--                });-->
        }


            if(result.length == 0)
            {
            //--------------make note on it
                $scope.delivery_details_array=[];
                var data={
                    "prheader_gid":poaggre.prheader_gid,
                    "prdetails_gid":poaggre.prdetails_gid,
                    "prheader_no":poaggre.prheader_no,
                    "product_gid":poaggre.product_gid,
                    "prdetails_productname":poaggre.product_name,
                    "qty":poaggre.prdetails_qty1,
                    "branch_name":poaggre.branch_name,
                    "commodity_name":poaggre.commodity_name,
                    "supplier_name":poaggre.supplier_name,
                    "supplier_gid":poaggre.supplier_gid,
                    "Address":poaggre.address_1,
                    "City":poaggre.City_Name,
                    "District":poaggre.district_name,
                    "State":poaggre.state_name,
                    "Pincode":poaggre.address_pincode
                }

                $scope.delivery_details_array.push(data);

                var dta = {
                            "product_name":poaggre.product_name,
                            "product_gid":poaggre.product_gid,
                            "podetails_uom":poaggre.uom_name,
                            "supplier_gid":poaggre.supplier_gid,
                            "supplier_name":poaggre.supplier_name,
                            "commodity_gid":poaggre.commodity_gid,
                            "teamandcont_gid":0,
                            "commodity_name":poaggre.commodity_name,
                            "delivery_details":$scope.delivery_details_array,
                            "tax_amount":poaggre.hsn_igstrate
                          }
                    $scope.poaggre_array.push(dta);


                    $scope.vendor_array.push(poaggre.product_gid);
                    var data={"Params":
                                    { "FILTER":
                                        {"li_list_data":$scope.vendor_array,
                                        "li_count":$scope.vendor_array.length
                                        },
                                    }
                             }

                    var data_int={
                                    "Action":"vendor_get",
                                    "data":data
                                }

                       var sum_details=ApprovedtService.details_sum(data_int)
                       sum_details.then(function(result)
                       {
                       debugger;
                       $scope.supplier_dropdown_array=result.data;
                       });

                    //alert($scope.poaggre_array);
            }
        }




//    $scope.p= $scope.prdetails_qty1* $scope.supplierproduct_unitprice+( $scope.prdetails_qty1* $scope.supplierproduct_unitprice* $scope.hsn_igstrate/100)
        $scope.loaddata=function()
            {

                var sum=0;
                for(var i=0;i<$scope.purchase.length;i++)
                {
                 if(parseInt($scope.purchase[i].podetails_qty)== undefined)
                 {
                     var unity=0;
                 }
                 else{
                     var unity=parseInt($scope.purchase[i].podetails_qty);
                 }
                    sum+=(unity*$scope.purchase[i].podetails_unitprice)+(unity* $scope.purchase[i].podetails_unitprice* $scope.purchase[i].hsn_igstrate/100)

                }
                $scope.totalamt=sum;
                //alert(JSON.stringify(sum));
                return sum;

            }



            $scope.purchase = [];
            $scope.checkbox = function (array) {
                debugger;
                 if(array.prdetails_qty1==undefined||array.prdetails_qty1==0){
                     alert('Add quantity');
                     array.checked=false;
                     return false;
                      }


                if (array.checked == true) {

                   var rem= parseInt(array.remaining_qty);
                   if(array.prheader_mepno==undefined)
                   {
                       var mep=''

                   }
                   else{
                      var mep=array.prheader_mepno
                   }
                   var unit=parseInt(array.prdetails_qty1);
                   $scope.prheader_totalamount=(unit*array.supplierproduct_unitprice)+(unit* array.supplierproduct_unitprice*array.hsn_igstrate/100)

                $scope.prpoqty_filter=$filter('filter')($scope.listproductnamepo, {product_gid: array.prdetails_product_gid,checked: true},true);
                var data={
                "pr_no":array.prheader_no,
                "poheader_gid": array.prheader_gid,
                "podetail_gid":  array.prdetails_gid,
                "teamandcont_gid":0,
                "amement_gid":'N',
                "vesion_gid":0,
                "supplier_name": array.supplier_name,
                "supplier_gid": array.supplier_gid,
                "product_gid": array.prdetails_product_gid,
                "product_name": array.product_name,
                "podetails_uom":array.uom_name,
                "podetails_qty": unit,
                "podetails_unitprice":  array.supplierproduct_unitprice,
                "prheader_commodity_gid": array.prheader_commodity_gid,
                "podetails_amount":unit*array.supplierproduct_unitprice,
                "prheader_mepno": mep,
                "podetails_taxamount":array.hsn_igstrate,
                "podetails_totalamount":$scope.prheader_totalamount,
                "prpopty":$scope.prpoqty_filter,
                "godown":"",
                "delete":"",
                "hsn_igstrate":array.hsn_igstrate,
                "branch_gid":array.branch_gid,
                "supplierproduct_dts":array.supplierproduct_dts,
                "Address_1":array.address_1,
                "Address_2":array.address_2,
                "Address_3":array.address_3,
                "branch_name":array.branch_name,
                "state_name":array.state_name,
                "district_name":array.district_name,
                "city_name":array.City_Name,
                "commodity_name":array.commodity_name,
                "pincode":array.address_pincode
                }


                    $scope.purchase.push(data)
                    if( $scope.purchase.length>1){

                        if($scope.purchase[0].prheader_commodity_gid!=array.prheader_commodity_gid)
                        {
                            alert('Select the Same Commodity')
                            i= $scope.purchase.length;
                            $scope.purchase.pop(i,1); // removes the matched element
                            array.checked=false;
                            return false
                        }
                        if($scope.purchase[0].supplier_name!=array.supplier_name)
                        {
                            alert('Select the Same Supplier Name')
                            i= $scope.purchase.length;
                            $scope.purchase.pop(i,1); // removes the matched element
                            array.checked=false;
                            return false
                        }
                        if($scope.purchase[0].supplierproduct_dts!=array.supplierproduct_dts)
                            {
                            alert('Select the Same DTS Products')
                            i= $scope.purchase.length;
                            $scope.purchase.pop(i,1); // removes the matched element
                            array.checked=false;
                            return false
                            }

                    }
                    }
                    else{

                    var index =$scope.purchase.indexOf(array);
                    $scope.purchase.splice(index, 1);

                    }

            }


            $scope.amount = function (pur) {
                debugger;
                if(parseInt(pur.prdetails_qty1)>pur.remaining_qty)
                {
                    confirm("please add valid qty");
                    pur.prdetails_qty1='';
                    return false;
                };
                //alert('hai')
                // pur.remaining_qty-emp.prdetails_qty1
            }

            $scope.add=function()
            {
            debugger;
            $scope.count=$scope.count+1;
            }


             $scope.sub=function()
            {
            debugger;
            $scope.count=$scope.count-1;
            }
            $scope.save_podetails=function(action,prheader_gid){
            debugger;
                if($scope.purchase[0].supplierproduct_dts==='Y'){
                    action='Approve'
                    status='Approved'
                }
            else
            {status='Draft'
            action ='draft'}
            var fromdate =formatDate(new Date());
            var todate = formatDate(new Date());
            var amt=$scope.totalamt;
            var array=[];
            var entire={
                        "action":action,
                        "status":status,
                        "purchase":$scope.purchase,
                        "fromdate":fromdate,
                        "todate":todate,
                        "amt":amt
                        }
                        //sessionStorage.clear();
            savetodata_localstorage(entire);

            function savetodata_localstorage(X)
            {
                var a=[];
                var xx = sessionStorage.getItem('PO_Creation');
                if(xx != undefined && xx != null && xx != '')
                {
                    a=JSON.parse(sessionStorage.getItem('PO_Creation'));
                    a.push(X);
                    sessionStorage.setItem('PO_Creation',JSON.stringify(a));
                }
                else
                {
                a.push(X);
                sessionStorage.setItem('PO_Creation',JSON.stringify(a));
                }
            }

            $window.location.href='createpoindex';

<!--            var prdatas = ApprovedtService.setposave(action,status,$scope.purchase,fromdate,todate,amt)-->
<!--                prdatas.then(function(result) {-->
<!--                  alert(result.data);-->
<!--                  sessionStorage.setItem('povendor_gid', '');-->
<!--                  $window.location.href = "po_maker";-->
<!--                  $scope.endloading();-->
<!--             }),function() {-->
<!--                alert('no data');-->
<!--            }.finally($scope.endloading);-->
        }






    //supplier-name dropdown
    var supplier = ApprovedtService.getdropdown("supplier");
    supplier.then(function(supplier) {
        var supplier = JSON.parse(supplier.data);

        $scope.invoicesupplier_list = supplier;

    }, function() {
        alert("Record Not Found")
    });
     //Get Branch Code

            var brancode = ApprovedtService.branchresult()
            brancode.then(function (result) {
                $scope.brncode = JSON.parse(result.data);

            }, function () {
                alert("Record Not Found")
            });




             //Commodity Details

            var commodityname = ApprovedtService.commodity();
            commodityname.then(function (commodityname) {
            $scope.commodityname = JSON.parse(commodityname.data);
                },
                function (err) {
                    alert('No data!.');
                }).finally();

     $scope.searchDetails = function()
     {
     debugger;

      if($scope.prodnme != undefined && $scope.prodnme != null && $scope.prodnme != '')
     {
     var temp_product=$scope.prodnme.product_name;
     }


    if($scope.ddlstatus1_supplier != undefined && $scope.ddlstatus1_supplier != null && $scope.ddlstatus1_supplier != '')
     {
     var temp_supplier=$scope.ddlstatus1_supplier.supplier_name;
     }

     if($scope.branch_content != undefined && $scope.branch_content != null && $scope.branch_content != '')
     {
     var temp_branch=$scope.branch_content.branch_name;
     }

     if($scope.commodityname1 != undefined && $scope.commodityname1 != null && $scope.commodityname1 != '')
     {
     var temp_commodity=$scope.commodityname1.commodity_name;
     }


     $scope.listproductnamepo = $filter('filter')($scope.maintemp_data, {

        "prheader_no": $scope.prno == null || $scope.prno == undefined || $scope.prno == "" ?'' :  $scope.prno,
        "supplier_name":temp_supplier == null || temp_supplier == undefined || temp_supplier == "" ?'' :  temp_supplier,
        "commodity_name":temp_commodity == null || temp_commodity == undefined || temp_commodity == "" ?'' :  temp_commodity,
        "product_name": temp_product == null ||  temp_product == undefined ||  temp_product == "" ?'' :   temp_product,
        "branch_name":temp_branch == null || temp_branch == undefined || temp_branch == "" ?'' :  temp_branch
    });

     }


     // DELETION OF  PO AGGREGATED SUMMARY:

     $scope.removeddl=function(poaggregated_sum_details,index)
     {
     debugger;
     //$scope.sub_supplier_clear_button=false;
     $scope.ddlstatus = '';
     var a=poaggregated_sum_details;
     //alert(JSON.stringify(a));
     var total_sum1=0;

     // FIRST LOOP
     poaggregated_sum_details.delivery_details.forEach(function(main)
     {
             $scope.listproductnamepo.forEach(function(sub)
             {
                 if(sub.prheader_gid == main.prheader_gid && sub.product_gid == main.product_gid)
                 {
                     sub.remaining_qty=sub.remaining_qty+main.qty;
                     sub.ccbs_details.forEach(function(mini)
                     {
                     mini.remaining_qty=parseInt(mini.remaining_qty)+parseInt(mini.ccbs_qty);
                     mini.ccbs_qty=0;
                     });
                 }
             });

     });

     //------------>splice concept
     $scope.poaggre_array.splice(index,1);
     $scope.vendor_array=[];
     $scope.supplier_dropdown_array=[];
     if($scope.poaggre_array.length == 0)
     {
     return false;
     }
     if($scope.poaggre_array.length>=1)
     {
         $scope.poaggre_array.forEach(function(v)
         {
         $scope.vendor_array.push(v.product_gid);
         });
     }


                    var data={"Params":
                                    { "FILTER":
                                        {"li_list_data":$scope.vendor_array,
                                        "li_count":$scope.vendor_array.length
                                        },
                                    }
                             }

                    var data_int={
                                    "Action":"vendor_get",
                                    "data":data
                                }

                       var sum_details=ApprovedtService.details_sum(data_int)
                       sum_details.then(function(result)
                       {
                       debugger;
                       //alert(JSON.stringify(result));
                       $scope.supplier_dropdown_array=result.data;
                       });


     }

     //-------------->CLOSE CONCEPT

     $scope.closefunction=function()
     {
     debugger;
        var total_sum=0;
        $scope.remain_ccbs_qty=0;
        //alert(JSON.stringify($scope.poaggre_array));
        // alert(JSON.stringify($scope.temparray));
        var count=0;
        if($scope.poaggre_array.length>0)
        {
             $scope.poaggre_array.forEach(function(x)
             {
                 if(x.product_name == $scope.temparray.product_name)
                 {
                     x.delivery_details.forEach(function(y)
                     {
                         if(y.prheader_gid == $scope.temparray.prheader_gid)
                         {
                               y.pr_ccbs.forEach(function(z)
                               {
                               total_sum=total_sum+parseInt(z.ccbs_qty);
                               $scope.remain_ccbs_qty=$scope.remain_ccbs_qty+z.remaining_qty;
                               });
                               if(total_sum == 0)
                               {
                                    y.pr_ccbs.forEach(function(z)
                                   {
                                   total_sum=total_sum+parseInt(z.ccbs_qty);
                                   if(parseInt(z.ccbs_qty) == 0 && z.remaining_qty == 0)
                                   {
                                   $scope.remain_ccbs_qty=$scope.remain_ccbs_qty+z.prccbs_remaining_qty_Value;
                                   //z.remaining_qty=z.prccbs_remaining_qty_Value;
                                   }
                                   z.remaining_qty=z.prccbs_remaining_qty_Value;
                                   });
                               y.qty=total_sum;
                               var a=confirm('Are You Sure Previous Qty is Changed Completely.!!')
                                   if(a==true)
                                   {
                                   alert('Records Removed Completely from PO Details')
                                 // splice index concept----------->
                                    var result111=$filter('filter')(x.delivery_details,
                                    {
                                    "prheader_gid":y.prheader_gid
                                    });
                                    if(result111.length >0)
                                    {
                                        var index1=(x.delivery_details.indexOf(result111[0]));
                                    }
                                   x.delivery_details.splice(index1, 1);
                                   modalhide('mdl_present')
                                   count=2;
                                   }
                                   else
                                   {
                                   alert('OtherWise Increase the Quantity Value Greater Than 1.!!')
                                   count=1;
                                   }
                               }
                               else
                               {
                               count=2;
                               modalhide('mdl_present');
                               }
                         }
                     });
                 }
             });
         }
        if(count !=0)
        {
             $scope.listproductnamepo.forEach(function(x)
             {
                 if(x.prheader_gid == $scope.temparray.prheader_gid &&
                 x.product_gid == $scope.temparray.product_gid)
                 {
                 x.remaining_qty=$scope.remain_ccbs_qty;
                 }
             });
        }
        if(count != 2)
        {
             $scope.temparray.ccbs_details.forEach(function(x)
             {
             x.ccbs_qty=0;
             //x.remaining_qty=x.prccbs_qty;
             x.remaining_qty=x.prccbs_remaining_qty_Value;
             });
        }

         if(count==0)
         {
         modalhide('mdl_present');
         }


     }


     $scope.pageLength_sub=$scope.poaggre_array.length;
     $scope.Totalpages_sub=Math.ceil($scope.pageLength_sub/$scope.itemsPerPage);





















}]);
myApp.service("ApprovedtService", function($http) {
    this.getprcesmry = function() {
        var respons = $http.get(Appname + "/getfinalapproval/");
        return respons;
    }

 //supplier Name
    this.getdropdown = function(tablename) {
        var responsee = $http.post(Appname + "/Dropdown_detail_ap/", {
            params: {
                "tablename": tablename,
                "gid": 0,
                "name": ''
            }
        });
        return responsee;
    }
     //branchresult
        this.branchresult = function () {
            var response = $http.post(Appname + "/branchresult/");
            return response;
        }

        //Commodity details
        this.commodity = function () {
            var response = $http.post(Appname + "/commoditydropdown/")
            return response;
        }

          //Supplier Dropdown
        this.details_sum = function (a) {
            var response = $http.post(Appname + "/supplierdropdown/",a)
            return response;
        }

        // ccbs details get

        this.details_ccbs = function (a) {
            var response = $http.post(Appname + "/prdetails_ccbsget/",a)
            return response;
        }

        this.getdropdown = function (tablename) {
        var responsee = $http.post(Appname+"/Dropdown_details/",{params:{"tablename":tablename,"gid":0,"name":''}});
        return responsee;
        }

         // Branch details

         this.branchresult = function ()
         {
            var response = $http.post(Appname + "/branchresult/");
            return response;
         }

        //Commodity details

        this.commodity = function (entity_gid)
        {
            var response = $http.post(Appname + "/commoditydropdown/")
            return response;
        }

        //product details

        this.getprod = function(custid)
        {
            var respons = $http.post(Appname + "/prodget/",custid);
            return respons;
        }



<!--        this.setposave = function (action,status,podetails,fromdate,todate,amt) {-->
<!--      var response = $http.post(Appname + "/PR_to_POheader_Set/", {params:{'action':action,'status':status,'podetails':podetails,'from_date':fromdate,'to_date':todate,  "total_amount":amt}});-->
<!--      return response;-->
<!--    }-->
});


</script>
{% endblock %}
