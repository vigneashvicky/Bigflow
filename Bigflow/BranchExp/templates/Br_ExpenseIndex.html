{% extends 'Shared/mainLayout.html' %}
{% load static from staticfiles %}
{% block title %}Branch Maker Summary {% endblock %}
{% block content %}
{% csrf_token %}
{% verbatim %}
<style>
.w3-bar .w3-bar-item{padding:8px 16px;float:left;width:auto;border:none;display:block;outline:0}
.w3-bar .w3-dropdown-hover,.w3-bar .w3-dropdown-click{position:static;float:left}
.w3-bar .w3-button{white-space:normal}
.w3-bar-block .w3-bar-item{width:100%;display:block;padding:8px 16px;text-align:left;border:none;white-space:normal;float:none;outline:0}
.w3-bar-block.w3-center .w3-bar-item{text-align:center}.w3-block{display:block;width:100%}
.w3-bar-block .w3-dropdown-hover,.w3-bar-block .w3-dropdown-click{width:100%}
.w3-bar-block .w3-dropdown-hover .w3-dropdown-content,.w3-bar-block .w3-dropdown-click .w3-dropdown-content{min-width:100%}
.w3-bar-block .w3-dropdown-hover .w3-button,.w3-bar-block .w3-dropdown-click .w3-button{width:100%;text-align:left;padding:8px 16px}
.w3-main,#main{transition:margin-left .4s}
.w3-modal{z-index:3;display:none;padding-top:100px;position:fixed;left:0;top:0;width:100%;height:100%;overflow:auto;background-color:rgb(0,0,0);background-color:rgba(0,0,0,0.4)}
.w3-modal-content{margin:auto;background-color:#fff;position:relative;padding:0;outline:0;width:600px}
.w3-bar{width:100%;overflow:hidden}.w3-center .w3-bar{display:inline-block;width:auto}
.w3-bar .w3-bar-item{padding:8px 16px;float:left;width:auto;border:none;display:block;outline:0}
.w3-bar .w3-dropdown-hover,.w3-bar .w3-dropdown-click{position:static;float:left}
.w3-bar .w3-button{white-space:normal}
.w3-bar-block .w3-bar-item{width:100%;display:block;padding:8px 16px;text-align:left;border:none;white-space:normal;float:none;outline:0}
.w3-bar-block.w3-center .w3-bar-item{text-align:center}.w3-block{display:block;width:100%}
.w3-responsive{display:block;overflow-x:auto}
.w3-container:after,.w3-container:before,.w3-panel:after,.w3-panel:before,.w3-row:after,.w3-row:before,.w3-row-padding:after,.w3-row-padding:before,
.w3-cell-row:before,.w3-cell-row:after,.w3-clear:after,.w3-clear:before,.w3-bar:before,<div class="w3-bar:after">content:"";display:table;clear:both</div>
.w3-card-4,.w3-hover-shadow:hover{box-shadow:0 4px 10px 0 rgba(0,0,0,0.2),0 4px 20px 0 rgba(0,0,0,0.19)}
    .w3-ul.w3-hoverable li:hover{background-color:#ccc},
    .w3-ul{list-style-type:none;padding:0;margin:0}.w3-ul li{padding:8px 16px;border-bottom:1px solid #ddd}.w3-ul li:last-child{border-bottom:none}
.w3-tiny{font-size:10px!important}.w3-small{font-size:12px!important}.w3-medium{font-size:15px!important}.w3-large{font-size:18px!important}


.md-padding {
    padding: 8px;
    height: 470px !important;
}
md-tabs:not(.md-no-tab-content):not(.md-dynamic-height) {
    min-height: 470px;
}
















</style>
<div class="maincontent">
    <div ng-app="makersummary" ng-controller="ctrlsummary" class="container container1">
        <div class="row">
            <div class="row-header col-lg-12 col-sm-12">
                <h4>Expense Create</h4>
            </div>
        </div>
        <div class="w3-container">
            <ul class="w3-ul w3-card-4">
                <li class="w3-bar">


                    <div class="w3-bar-item">

<!--                        <span class="w3-large">Property Name :</span> <span class="w3-large">Mike   </span>-->
                        <span class="w3-large">Property Name :</span> <span class="w3-large">Mike</span><br>
                        <span class="w3-large">Advance Paid :</span> <span class="w3-large">10000</span><br>
                    </div>
                </li>
            </ul>
        </div>
        <md-content class="md-padding">
            <md-tabs md-selected="selectedIndex" md-border-bottom md-autoselect md-swipe-content>
                <md-tab ng-repeat="tab in tabs" ng-click="setTab(tab.title)"
                        ng-disabled="tab.disabled"
                        label="{{tab.title}}">
                    <!--<div class="demo-tab tab{{$index%4}}">-->
                    <!--<div ng-bind="tab.content"></div>-->
                    <!--<br/>-->
                    <!--<md-button class="md-primary md-raised" ng-click="removeTab( tab )"-->
                    <!--ng-disabled="tabs.length <= 1">-->
                    <!--Remove Tab-->
                    <!--</md-button>-->
                    <!--</div>-->
                    <!--<div ng-show="aaaaa">-->
                    <form role="form" name="Expense_valid">
                        <!--<div class="row">-->
                        <!--<div class="col-md-12">-->


                        <div class="col-md-3">
                            <md-input-container class="md-block inputcontainer">
                                <label>From Date</label>
                                <md-datepicker md-hide-icons="calendar"
                                               ng-model="models[tab.title].fromdate"
                                               md-hide-icons="calendar" ng-click="date" md-min-date="maxDate"
                                               md-max-date="minDate" formatDate required></md-datepicker>
                            </md-input-container>

                        </div>

                        <div class="col-md-3">
                            <md-input-container class="md-block inputcontainer">
                                <label>To Date</label>
                                <md-datepicker md-hide-icons="calendar"
                                               ng-model="models[tab.title].todate"
                                               md-hide-icons="calendar" ng-click="date" md-min-date="maxDate"
                                               md-max-date="minDate" formatDate required></md-datepicker>
                            </md-input-container>
                            </md-input-container>
                        </div>
                        <div class="col-md-1">
                            <input type="checkbox" id="myCheck" ng-true-value="1"
                                   ng-false-value="0"
                                   ng-model="models[tab.title].Recurring">
                            <strong id="text">Recurring</strong>
                        </div>
                        <div class="col-md-3">
                            <md-input-container class="md-block inputcontainer">
                                <label> Amount</label>
                                <input ng-model="models[tab.title].amount" valid-number
                                       maxlength="16" required/>
                            </md-input-container>
                        </div>
                        <div class="col-md-1" style=" bottom: -20px;">
                            <a href="" ng-click="CCBS_ADD(tab.title)"><i
                                    class="material-icons">
                                arrow_upward
                            </i>CCBS</a></div>
                        <div class="col-md-3">
                            <md-input-container class="md-block inputcontainer">
                                <!--ng-hide="!checkboxModel.value">-->
                                <label>Recurring Date</label>
                                <input ng-model="models[tab.title].Recurringdate" maxlength="3"/>
                            </md-input-container>
                        </div>

                        <div class="col-md-3">
                            <!--<md-input-container class="md-block inputcontainer" ng-hide="!checkboxModel.value">-->
                            <md-input-container class="md-block inputcontainer">
                                <label>Recurring Period</label>
                                <md-select ng-model="models[tab.title].period" >
                                    <md-option ng-repeat="x in period" ng-value="x.periodname"
                                               ng-click="periodclick(x)">{{ x.periodname }}
                                    </md-option>
                                </md-select>
                            </md-input-container>
                        </div>

                        <div class="col-md-3">


                            <md-input-container class="md-block inputcontainer">
                                <label>Supplier Name</label>
                                <md-select ng-model="models[tab.title].supplierid"

                                           md-on-close="clearSearchTerm()"
                                           data-md-container-class="selectdemoSelectHeader">
                                    <md-select-header class="demo-select-header">
                                        <input ng-model="searchTerm" type="search"
                                               placeholder="Search for a Supplier Name.."
                                               class="demo-header-searchbox md-text"
                                               onkeydown="mdSelectOnKeyDownOverride(event)">
                                    </md-select-header>
                                    <md-optgroup label="Supplier Name">
                                        <md-option ng-value="supplier.supplier_gid"
                                                   ng-selected="models[tab.title].supplierid == supplier.supplier_gid"
                                                   ng-click="supplierclick(supplier.supplier_gid)"
                                                   ng-repeat="supplier in invoicesupplier_list |
              filter:searchTerm">{{supplier.supplier_name}}
                                        </md-option>
                                    </md-optgroup>
                                </md-select>
                            </md-input-container>


                        </div>
                        <div class="col-md-1">
                            <input type="checkbox"  ng-true-value="1"
                                   ng-false-value="0"
                                   ng-model="models[tab.title].Isgst">
                            <strong >Gst Applicable</strong>
                        </div>
                        <div ng-repeat-start="param in parameters">
                            <div ng-show="param.expensecolumn_type == tab.title">
                                <div class="col-md-3" ng-show="param.inputtype == 'Textbox'"
                                     ng-repeat="para in param.columnsdata">
                                    <md-input-container ng-disabled="" class="md-block inputcontainer"
                                    >
                                        <label>{{para.displayname}}</label>
                                        <input ng-model="models[tab.title].values[para.ColumnName]" maxlength="16"/>
                                    </md-input-container>
                                </div>
                            </div>
                            <div ng-show="param.expensecolumn_type == tab.title">
                                <div class="col-md-3" ng-show="param.inputtype == 'Date'"
                                     ng-repeat="para in param.columnsdata">
                                    <md-input-container class="md-block inputcontainer"
                                                        ng-show="param.expensecolumn_type == tab.title">
                                        <label>{{para.displayname}}</label>
                                        <md-datepicker md-hide-icons="calendar"
                                                       ng-model="models[tab.title].values[para.ColumnName]"
                                                       md-hide-icons="calendar" ng-click="date"
                                                       md-min-date="maxDate"
                                                       md-max-date="minDate" formatDate></md-datepicker>
                                    </md-input-container>
                                </div>
                            </div>
                            <!--<div ng-show="param.expensecolumn_type == tab.title">-->
                            <!--<div class="col-md-3" ng-show="param.inputtype == 'DropDown'"-->
                            <!--ng-repeat="para in param.columnsdata">-->
                            <!--<md-input-container class="md-block inputcontainer"-->
                            <!--ng-show="param.expensecolumn_type == tab.title">-->
                            <!--<label>{{para.displayname}}</label>-->
                            <!--<md-select ng-model="models[tab.title].values[para.ColumnName]" required>-->
                            <!--<md-option ng-repeat="x in employee" ng-value="x.employee_gid"-->

                            <!--ng-click="sourceclick(x)">{{ x.employee_name }}-->
                            <!--</md-option>-->
                            <!--</md-select>-->
                            <!--</md-input-container>-->

                            <!--</div>-->
                            <!--</div>-->
                            <!---->

                            <!--<div ng-show="param.expensecolumn_type == tab.title">-->
                            <!--<div class="col-md-3" ng-show="param.inputtype == 'DropDown'"-->
                            <!--ng-repeat="para in param.columnsdata">-->
                            <!--<div ng-show="param.expensecolumn_type == tab.title">-->


                            <!--<label>{{para.displayname}}</label>-->
                            <!--<input ng-model="searchTermemp" type="search"-->
                            <!--placeholder="Search for a Employee Name.."-->
                            <!--class="demo-header-searchbox md-text"-->
                            <!--onkeydown="mdSelectOnKeyDownOverride(event)">-->
                            <!--<select ng-model="models[tab.title].values[para.ColumnName]">-->

                            <!--<option-->
                            <!--ng-value="x.employee_gid"-->
                            <!--ng-repeat="x in employee | filter:searchTermemp"-->
                            <!---->
                            <!--&gt;{{x.employee_name}}</option>-->


                            <!--</select>-->
                            <!--</div>-->
                            <!--</div>-->
                            <!--</div>-->


                            <!--<div ng-show="param.expensecolumn_type == tab.title">-->
                            <!--<div class="col-md-3" ng-show="param.inputtype == 'DropDown'"-->
                            <!--ng-repeat="para in param.columnsdata">-->
                            <!--<div>-->
                            <!--<md-autocomplete ng-show="param.expensecolumn_type == tab.title"-->
                            <!--style="min-width: 62px;"-->

                            <!--md-no-cache="true"-->
                            <!--md-selected-item="selectedItem"-->
                            <!--md-search-text="models[tab.title].values[para.ColumnName]"-->
                            <!--md-items="item in querySearch(models[tab.title].values[para.ColumnName])"-->
                            <!--md-item-text="item.employee_code"-->
                            <!--md-min-length=0>-->
                            <!--<md-item-template>-->
                            <!--<span md-highlight-text="models[tab.title].values[para.ColumnName]"> {{item.employee_code}} </span>-->
                            <!--</md-item-template>-->
                            <!--<md-not-found>-->
                            <!--No product matching "{{searchText}}" were found.-->
                            <!--</md-not-found>-->
                            <!--</md-autocomplete>-->
                            <!--</div>-->
                            <!--</div>-->
                            <!--</div>-->


                        </div>
                        <div ng-repeat-end></div>

                        <!--</div>-->
                        <!--</div>-->
                        <!--<div class="row">-->
                        <!--<div class="col-md-12">-->
                        <!--<div ng-repeat-start="param in parameters">-->
                        <!--<div ng-show="param.expensecolumn_type == tab.title">-->
                        <!--<div class="col-md-3" ng-show="param.inputtype == 'Date'"-->
                        <!--ng-repeat="para in param.columnsdata">-->
                        <!--<md-input-container class="md-block inputcontainer"-->
                        <!--ng-show="param.expensecolumn_type == tab.title">-->
                        <!--<label>{{para.displayname}}</label>-->
                        <!--<md-datepicker md-hide-icons="calendar"-->
                        <!--ng-model="models[tab.title].values[para.ColumnName]"-->
                        <!--md-hide-icons="calendar" ng-click="date"-->
                        <!--md-min-date="maxDate"-->
                        <!--md-max-date="minDate" formatDate></md-datepicker>-->
                        <!--</md-input-container>-->
                        <!--</div>-->
                        <!--</div>-->
                        <!--</div>-->
                        <!--<div ng-repeat-end></div>-->

                        <!--<div ng-repeat-start="param in parameters">-->
                        <!--<div ng-show="param.expensecolumn_type == tab.title">-->
                        <!--<div class="col-md-3" ng-show="param.inputtype == 'DropDown'"-->
                        <!--ng-repeat="para in param.columnsdata">-->
                        <!--<md-input-container class="md-block inputcontainer"-->
                        <!--ng-show="param.expensecolumn_type == tab.title">-->
                        <!--<label>{{para.displayname}}</label>-->
                        <!--<md-select ng-model="models[tab.title].values[para.ColumnName]" required>-->
                        <!--<md-option ng-repeat="x in employee" ng-value="x.employee_gid"-->

                        <!--ng-click="sourceclick(x)">{{ x.employee_name }}-->
                        <!--</md-option>-->
                        <!--</md-select>-->
                        <!--</md-input-container>-->

                        <!--</div>-->
                        <!--</div>-->
                        <!--</div>-->
                        <!--<div ng-repeat-end></div>-->


                        <!--</div>-->
                        <!--</div>-->
                        <div class="row">
                            <div class="col-md-3">
                                <md-button ng-click="save_details(tab.title)"
                                           class="md-raised md-warn">Submit
                                    <md-tooltip>Submit</md-tooltip>
                                </md-button>
                            </div>
                        </div>

                    </form>
                    <!--</div>-->
                    <div class="row table-responsive">
                        <div class="col-md-12 col-lg-12 col-sm-12">
                            <table class="table table-striped table-bordered table-condensed table-hover md-primary"
                            >
                                <thead class="header">
                                <tr style="text-align:center">
                                    <th>S no</th>
                                    <th>Amount</th>
                                    <th>Supplier Name</th>
                                    <th>Recurring Date</th>
                                    <th>Recurring From</th>
                                    <th>Recurring To</th>
                                    <th>Recurring Status</th>
                                    <th>Recurring Period</th>
                                    <th>Expense Details</th>


                                    <th ng-repeat="c in all_columns | filter: { expensecolumn_type: tab.title } : true">
                                        {{
                                        c.expensecolumn_name }}
                                    </th>
                                    <th>VIEW</th>


                                </tr>
                                </thead>
                                <tbody>
                                <tr ng-repeat="d in Expensesummary | filter: { branchexpense_type: tab.title }">
                                    <td class="text-center" ng-model="dept_name">
                                        {{$index+1}}
                                    </td>
                                    <td>{{d.branchexpense_amount}}</td>
                                    <td>{{d.supplier_name}}</td>
                                    <td>{{d.branchexpense_recurringdate}}</td>
                                    <td>{{d.branchexpense_fromdate | date:'dd-MMM-yyyy'}}</td>
                                    <td>{{d.branchexpense_todate | date:'dd-MMM-yyyy'}}</td>
                                    <td>{{d.branchexpense_recurringperiod }}</td>
                                    <td>{{d.branchexpense_status }}</td>
                                    <td align="center"><a href="" ng-click="branchdetails(d)"><i
                                            class="material-icons">
                                        arrow_upward
                                    </i></a>
                                    </td>
                                    <td ng-repeat="c in all_columns | filter: { expensecolumn_type: tab.title } : true">
                                        {{
                                        d[c.expensecolumn_name] }}
                                    </td>

                                    <td class="text-center" ng-click="Edit_expense(d,tab.title)">
                                        <a href=""><i class="material-icons">
                                            edit
                                        </i></a>

                                    </td>


                                </tr>

                                </tbody>
                                <tfoot>

                                </tfoot>
                            </table>
                        </div>
                    </div>
                </md-tab>
            </md-tabs>
        </md-content>
        <pre>{{models | json}}</pre>

        <div class="modal fade" id="mdl_exp" tabindex="-1" role="dialog" data-backdrop="static"
             data-keyboard="false"
             aria-labelledby="exampleModalLabel" aria-hidden="true">
            <div class="modal-dialog modal-lg" role="document">
                <div class="modal-content">


                    <div class="modal-header popup-header">

                        <h5 class="modal-title" id="s">
                            Details
                            <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                                <span aria-hidden="true">&times;</span>
                            </button>
                        </h5>
                    </div>

                    <div class="modal-body">
                        <div class="row">
                            <div class="row table-responsive">

                                <div class="col-md-1">
                                    <md-button class="md-fab md-mini md-primary custbutton"
                                               ng-click="Addccbs()" style="
                                        left: 795px;
                                         " ng-disabled="invoiceview">
                                        <md-icon>add</md-icon>
                                        <md-tooltip>ADD</md-tooltip>
                                    </md-button>
                                </div>
                                <div class="col-md-12 col-lg-12 col-sm-12">
                                    <!--<h5><b>Total Debit Amount:</b> {{quantity * price}}</h5>-->

                                    <table class="table table-striped table-bordered table-condensed table-hover md-primary"
                                           md-progress="deferred">
                                        <thead class="header">
                                        <tr style="text-align:center">
                                            <th>S.No</th>
                                            <th>Date</th>
                                            <th>Amount</th>
                                            <th>Status</th>
                                            <th>Remark</th>
                                            <th>Hold</th>
                                            <th>Update</th>

                                        </tr>
                                        </thead>
                                        <tbody>
                                        <tr ng-repeat="exp in expense_details">
                                            <td class="text-center" ng-model="dept_name">
                                                {{$index+1}}
                                            </td>
                                            <td>
                                                {{exp.branchexpensedetails_ondate}}
                                            </td>
                                            <td>
                                                <input class="textboxgeneral" ng-disabled="invoiceview"
                                                       maxlength="8"
                                                       ng-model="exp.branchexpensedetails_amount"
                                                />

                                            </td>
                                            <td>
                                                {{exp.branchexpensedetails_status}}

                                            </td>
                                            <td>
                                                <input class="textboxgeneral" ng-disabled="invoiceview"
                                                       maxlength="8"
                                                       ng-model="exp.branchexpensedetails_remark"
                                                />

                                            </td>
                                            <td>
                                                <input type="checkbox" ng-model="exp.branchexpensedetails_ishold" ng-true-value="1"
                                                       ng-false-value="0">

                                            </td>
                                            <td ><a href="" ng-click="updatebranchdetails(exp)">
                                                <i class="material-icons">
                                                    system_update_alt
                                                </i></a>

                                            </td>


                                        </tr>
                                        </tbody>

                                    </table>
                                </div>
                            </div>
                            <div class="row ">
                                <div class="col-lg-12 col-sm-12 text-right">
                                    <md-button ng-click="Close()" data-dismiss="modal" class="md-raised">
                                        Close
                                    </md-button>
                                    <md-button ng-click="save_ppx()" ng-hide="hide_show"
                                               data-dismiss="modal" class="md-raised md-warn">Submit
                                    </md-button>
                                </div>
                            </div>
                        </div>
                    </div>

                </div>
            </div>
        </div>

        <div class="modal fade" id="mdl_ccbs" tabindex="-1" role="dialog" data-backdrop="static"
             data-keyboard="false"
             aria-labelledby="exampleModalLabel" aria-hidden="true">
            <div class="modal-dialog modal-lg" role="document">
                <div class="modal-content">


                    <div class="modal-header popup-header">

                        <h5 class="modal-title" id="s">
                            CCBS Details
                            <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                                <span aria-hidden="true">&times;</span>
                            </button>
                        </h5>
                    </div>
                    <div class="row">
                        <div class="col-md-6 col-lg-6 col-sm-6 table-responsive">
                            <h4>ccbs Debit : </h4>
                            <div class=" text-right" ng-click="debitclick()"><a href=""> <i class="material-icons">
                                add
                            </i></a></div>
                            <table class="table table-bordered"
                            >
                                <thead class="header">
                                <tr>
                                    <th>S NO</th>
                                    <th>cc</th>

                                    <th>Bs</th>
                                    <th>Percentage</th>
                                </tr>
                                </thead>
                                <tbody ng-init="totall = 0">
                                <tr
                                        ng-repeat="type in ccbsdebit">
                                    <td class="text-center">
                                        {{$index+1}}
                                    </td>


                                    <td class="text-center"><input class="textboxgeneral"
                                                                   maxlength="8"
                                                                   ng-model="cc.cc"
                                    /></td>
                                    <td class="text-center"><input class="textboxgeneral"
                                                                   maxlength="8"
                                                                   ng-model="cc.bs"
                                    /></td>
                                    <td class="text-center"><input class="textboxgeneral"
                                                                   maxlength="8"
                                                                   ng-model="cc.percentage"
                                    /></td>
                                </tr>

                                </tbody>

                            </table>
                        </div>
                        <form role="form" name="column_valid">

                            <div class="col-md-6 col-lg-6 col-sm-6 table-responsive">
                                <h4>ccbs Credit : </h4>
                                <div class=" text-right" ng-click="creditclick()"><a href=""> <i class="material-icons">
                                    add
                                </i></a></div>
                                <table class="table table-bordered"
                                >
                                    <thead class="header">
                                    <tr>
                                        <th>S NO</th>
                                        <th>cc</th>

                                        <th>Bs</th>
                                        <th>Percentage</th>
                                    </tr>
                                    </thead>
                                    <tbody ng-init="totall = 0">
                                    <tr
                                            ng-repeat="cc in ccbscredit"
                                    >
                                        <td class="text-center">
                                            {{$index+1}}
                                        </td>


                                        <td class="text-center"><input class="textboxgeneral"
                                                                       maxlength="8"
                                                                       ng-model="cc.cc"
                                        /></td>
                                        <td class="text-center"><input class="textboxgeneral"
                                                                       maxlength="8"
                                                                       ng-model="cc.bs"
                                        /></td>
                                        <td class="text-center"><input class="textboxgeneral"
                                                                       maxlength="8"
                                                                       ng-model="cc.percentage"
                                                                       ng-blur="CCBS_PERchange($index,cc.percentage)"
                                        /></td>


                                    </tr>

                                    </tbody>

                                </table>
                            </div>
                        </form>
                    </div>


                </div>
            </div>
        </div>

    </div>
</div>

{% endverbatim %}
<style>

.btn-default.btn-on.active{background-color: #5BB75B;color: white;}
.btn-default.btn-off.active{background-color: #DA4F49;color: white;}

.btn-default.btn-on-1.active{background-color: #006FFC;color: white;}
.btn-default.btn-off-1.active{background-color: #DA4F49;color: white;}

.btn-default.btn-on-2.active{background-color: #00D590;color: white;}
.btn-default.btn-off-2.active{background-color: #A7A7A7;color: white;}

.btn-default.btn-on-3.active{color: #5BB75B;font-weight:bolder;}
.btn-default.btn-off-3.active{color: #DA4F49;font-weight:bolder;}

.btn-default.btn-on-4.active{background-color: #006FFC;color: #5BB75B;}
.btn-default.btn-off-4.active{background-color: #DA4F49;color: #DA4F49;}







</style>
<script>jQuery.event.special.touchstart = {
  setup: function( _, ns, handle ){
    if ( ns.includes("noPreventDefault") ) {
      this.addEventListener("touchstart", handle, { passive: false });
    } else {
      this.addEventListener("touchstart", handle, { passive: true });
    }
  }
};





</script>

<script>
    var app=angular.module('makersummary',['ngMaterial','ui.bootstrap','AppCommon','rzTable']).config(function($httpProvider) {
    $httpProvider.defaults.xsrfCookieName = 'csrftoken';
    $httpProvider.defaults.xsrfHeaderName = 'X-CSRFToken';

});

app.controller('ctrlsummary', ['$scope', '$filter', '$mdDateLocale', 'br_rentcreate', '$window', '$mdDialog', '$element',
    function($scope, $filter, $mdDateLocale, br_rentcreate, $window, $mdDialog, $element) {
        $scope.models = {};

        $scope.loading = function() {
            $mdDialog.show({
                templateUrl: 'loaderSpinner',
                parent: angular.element(document.body),
                clickOutsideToClose: false
            });
        };

        $scope.period = [{
        "periodname":"1 Week",

        },{
        "periodname":"15 Days",

        },{
        "periodname":"1 Month",

        },]
        $scope.endloading = function() {
            $mdDialog.hide();
        };
        $scope.querySearch = function(query) {
                te = $filter('filter')($scope.employee, {
                    'employee_code': query
                });
                // console.log(te)
                return te;

            }
            <!--$scope.isSet = function(tabNum) {-->
            <!--//  alert(tabNum)-->
            <!--// return $scope.tab === tabNum;-->
            <!--};-->
        window.mdSelectOnKeyDownOverride = function(event) {
            event.stopPropagation();
        };
        $scope.setTab = function(Tab) {
            $scope.parameters = [];
            //alert(Tab)
            $scope.aaaaa = false
            $scope.loading();
            $scope.parameters = $filter('filter')($scope.parameters_, {
                expensecolumn_type: Tab
            });
        //    console.log($scope.parameters)
            $scope.endloading();
        };

        function expensesummary(){

         var datas = {
                "Params": {
                    "FILTER": {
                        "Propertygid": $scope.tabs[0].Property_gid
                    },
                    "CLASSIFICATION": {
                        "Entity_Gid": [1]
                    }

                },
                "Group": "EXPENSE_DATA",
                "Type": "EXPENSE",
                "Sub_Type": "SUMMARY"
            }

            var columndata = br_rentcreate.get_expensesummary(datas);
            columndata.then(function(result) {
                      console.log(result)
                     $scope.endloading();
                $scope.Expensesummary = result.data.DATA;

            });
        }

        var Expense_titles = sessionStorage.getItem('Expense_values');
        if (Expense_titles !== null) {
            //       console.log(Expense_titles)

            $scope.tabs = JSON.parse(Expense_titles);
            expensesummary()
         //   console.log($scope.tabs);

        }

        var supplier = br_rentcreate.getdropdown("supplier");
        supplier.then(function(supplier) {

            var supplier = JSON.parse(supplier.data);

            $scope.invoicesupplier_list = supplier;

        }, function() {
            alert("Record Not Found")
        });
        selected = null,
            previous = null;
        $scope.selectedIndex = 0;
        <!--$scope.$watch('selectedIndex', function(newVal, oldVal) {-->
        <!--previous = selected;-->
        <!--selected = tabs[newVal];-->
        <!--if (oldVal + 1 && !angular.equals(oldVal, newVal)) {-->
        <!--$log.log('Goodbye ' + previous.title + '!');-->
        <!--}-->
        <!--if (newVal + 1 > 0) {-->
        <!--$log.log('Hello ' + selected.title + '!');-->
        <!--}-->
        <!--});-->
        $scope.employee = [];
        var employee = br_rentcreate.getemployee();
        employee.then(function(result) {
                var employee_data = JSON.parse(result.data)
                $scope.employee = employee_data;
            //    console.log($scope.employee)
            },
            function(err) {
                alert('No data!.');
            }).finally($scope.endloading);



        var datas = {
            "Params": {
                "FILTER": {
                    "ExpenseType": "HOUSEHOLD"
                },
                "CLASSIFICATION": {
                    "Entity_Gid": [1]
                }

            },
            "Group": "EXPENSE_DATA",
            "Type": "EXPENSE",
            "Sub_Type": "COLUMN"
        }


        var columndata = br_rentcreate.getcolumndata(datas);
        columndata.then(function(result) {
            //  console.log(result.data)
            $scope.parameters_ = result.data.DATA;
            angular.forEach($scope.parameters_, function(values, keys) {
                var columndata = JSON.parse(values.columnsdata);
                values.columnsdata = columndata
            });
       //     console.log($scope.parameters_)
            $scope.setTab($scope.tabs[0].title);

        });

        var column_field = {
            "Params": {
                "FILTER": {
                    "ExpenseType": "HOUSEHOLD"
                },
                "CLASSIFICATION": {
                    "Entity_Gid": [1]
                }

            },
            "Group": "EXPENSE_DATA",
            "Type": "EXPENSE",
            "Sub_Type": "COLUMN_FIELD"
        }
        var columndata = br_rentcreate.get_expensesummary(column_field);
        columndata.then(function(result) {
            //     console.log(result)

            $scope.all_columns = result.data.DATA;

        });

        <!--$scope.$watch('tabss', function() {-->
        <!--alert()-->
        <!--}, true);-->

        $scope.Edit_expense = function(editdata, type) {

            $scope.edit_todbdata = {};
               console.log(editdata)
            //     console.log(JSON.parse(editdata.jsondata))
            var data = JSON.parse(editdata.jsondata);
           // console.log(data)
            $scope.models[type] = { amount : editdata.branchexpense_amount };
            angular.forEach(data, function(values, keys) {
                    //alert(values.value_name);
                    $scope.edit_todbdata[values.value_name] = values.value;

                })
                //  console.log($scope.edit_todbdata)
            $scope.models[type] = {
                "values": $scope.edit_todbdata,
                "edit_id": data,
                "fromdate" :new Date( editdata.branchexpense_fromdate),
                "todate" : new Date(editdata.branchexpense_todate),
                "Recurring" : editdata.recurring,
                "Recurringdate" : editdata.branchexpense_amount,
                "amount" : editdata.branchexpense_amount,
                "supplierid" : editdata.branchexpense_supplierid,
            }
        }


        function selecteddate(datevalidate) {
            var d = datevalidate;
            var curr_date = d.getDate();
            var curr_month = d.getMonth();
            curr_month++;
            var curr_year = d.getFullYear();
            return curr_year + "-" + curr_month + "-" + curr_date;
        }


        $scope.save_details = function(type) {

                 $scope.loading();
                $scope.data_toexpense = []
                alert($scope.models[type].amount)
                angular.forEach($scope.models, function(values, keys) {

                    if (type == keys) {
                        // console.log(keys,values)
                        for (o in values.values) {
                            if (o.indexOf('date') >= 0) {
                                var d = values.values[o];
                                var curr_date = d.getDate();
                                var curr_month = d.getMonth();
                                curr_month++;
                                var curr_year = d.getFullYear();
                                values.values[o] = curr_year + "-" + curr_month + "-" + curr_date;

                            }

                            $scope.data_toexpense.push({
                                "columnname": o,
                                "columnvalue": values.values[o],
                            });
                        }
                    }

                })




                var datas = {
                    "Params": {
                        "FILTER": {
                            "Fromdate": selecteddate($scope.models[type].fromdate),
                            "Todate": selecteddate($scope.models[type].todate),
                            "Recurring": $scope.models[type].Recurring,
                            "Recurringdate": $scope.models[type].Recurringdate,
                            "Amount": $scope.models[type].amount,
                            "Supplierid": $scope.models[type].supplierid,
                            "period": $scope.models[type].period,
                            "Isgst": $scope.models[type].Isgst,
                            "Status": "Pending For Approval",
                            "Expensetype": type,
                            "Property_id": $scope.tabs[0].Property_gid,
                            "Expensedata": $scope.data_toexpense
                        },
                        "CLASSIFICATION": {
                            "Entity_Gid": [1]
                        }

                    },
                    "Group": "EXPENSE_DATA",
                    "Type": "EXPENSE_TYPE",
                    "Action": "COLUMN"
                }

                var setcolumndata = br_rentcreate.setcolumndata(datas);
                columndata.then(function(result) {
                    if(result.data.MESSAGE == 'SUCCESS'){
                        alert("Data Inserted Successfully")
                      expensesummary();

                     }else{
                       alert(result.data.MESSAGE)
                     }
                });

            }
            //  $scope.setTab($scope.tabs[0].title);
           $scope.expense_details = [];

         $scope.branchdetails = function(value){
                    $scope.expense_details = JSON.parse(value.branchdetails);
            modalshow('mdl_exp');

         }

            $scope.CCBS_ADD = function(value){

            modalshow('mdl_ccbs');

         }
           $scope.ccbscredit = [];
           $scope.ccbsdebit = [];
            $scope.creditclick = function(value){
               $scope.ccbscredit.push({
                "cc":001,
                "bs":001,
                "percentage":0
               })


         }
         $scope.debitclick = function(value){

             $scope.ccbsdebit.push({
                "cc":001,
                "bs":001,
                "percentage":0
               })
         }

       $scope.updatebranchdetails = function(expensedata){
           console.log(expensedata)
            var datas = {
                    "Params": {
                        "FILTER": {
                            "branchexpensedetails_amount": expensedata.branchexpensedetails_amount,
                            "branchexpensedetails_ishold": expensedata.branchexpensedetails_ishold,
                            "branchexpensedetails_remark": expensedata.branchexpensedetails_remark,
                            "branchexpensedetails_status": expensedata.branchexpensedetails_status,
                            "branchexpensedetails_gid": expensedata.branchexpensedetails_gid,

                        },
                        "CLASSIFICATION": {
                            "Entity_Gid": [1]
                        }

                    },
                    "Group": "EXPENSE_DATA",
                    "Type": "BRANCHDETAILS_UPDATE",
                    "Action": "UPDATE"
            }

            var setcolumndata = br_rentcreate.setcolumndata(datas);
            columndata.then(function(result) {
                 if(result.data.MESSAGE == 'SUCCESS'){
                        alert("Updated Successfully")
                       modalhide('mdl_exp')
                       expensesummary();
                 }else{
                   alert(result.data.MESSAGE)
                 }
            });

       }
        function percentage(num, per) {

            return (num / 100) * per;
        }

        $scope.CCBS_PERchange = function(index, value) {
             var sum = 0;
            angular.forEach($scope.ccbscredit, function(value, key) {
                sum += parseFloat(value.percentage);
                if (sum > 100) {
                    value.percentage = 0;
                    value.Amount = 0;
                }
            });
        }


    }
]);

app.service("br_rentcreate", function ($http) {
   this.getcolumndata = function (data) {
        var response=$http.post(Appname+"Get_expense/",data);
        return response;
    }

    this.get_expensesummary = function (data) {
        var response=$http.post(Appname+"Get_expense/",data);
        return response;
    }

    this.setcolumndata = function (data) {
        var response=$http.post(Appname+"Set_expense/",data);
        return response;
    }


       this.getemployee=function(){
        var response=$http.get(Appname+"/empddl/");
        return response;
     }
    this.getdropdown = function (tablename) {
        var responsee = $http.post(Appname+"/Dropdown_detail_ap/",{params:{"tablename":tablename,"gid":0,"name":''}});
        return responsee;
    }
});

























































</script>


{% endblock %}