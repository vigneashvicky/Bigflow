{% extends 'Shared/mainLayout.html' %}
{% load static from staticfiles %}
{% block title %}Profile Details{% endblock %}
{% block content %}
{% verbatim %}

<div class="maincontent">
    <div class="container container1" ng-app="Appreview" ng-controller="Ctrlreview" ng-cloak>
        <div class="row">
            <div>
                <md-content>
                    <md-tabs md-dynamic-height md-stretch-tabs>
                        <md-tab ng-class="{ active: isSet(1) }"
                                ng-click="setTab(1)" label="Add Partner">
                        </md-tab>
                        <md-tab label="Profile"  ng-click="setTab(12)" ng-class="{ active: isSet(12) }">
                            <md-tabs  md-dynamic-height md-stretch-tabs style="padding-left: 5em;">
                                <md-tab ng-class="{ active: isSet(12) }"
                                ng-click="setTab(12)" label="Profile Basic">
                                </md-tab>
                                <md-tab ng-class="{ active: isSet(8) }"
                                ng-click="setTab(8)" label="Profile Product">
                                </md-tab>
                                <md-tab ng-class="{ active: isSet(9) }"
                                ng-click="setTab(9)" label="Profile Branch">
                                </md-tab>
                                <md-tab ng-class="{ active: isSet(10) }"
                                ng-click="setTab(10)" label="Profile Client">
                                </md-tab>
                                <md-tab ng-class="{ active: isSet(11) }"
                                ng-click="setTab(11)" label="Profile Contract">
                                </md-tab>
                            </md-tabs>
                        </md-tab>
                        <md-tab ng-class="{ active: isSet(2) }"
                                ng-click="setTab(2)" label="Tax Details" ng-disabled="hidetabs">
                        </md-tab>
                        <md-tab ng-class="{ active: isSet(6) }"
                                ng-click="setTab(6)" label="Payment Details" ng-disabled="hidetabs">
                        </md-tab>
                        <md-tab ng-class="{ active: isSet(3) }"
                                ng-click="setTab(3)" label="Document Group" ng-disabled="hidetabs">
                        </md-tab>
                        <md-tab ng-class="{ active: isSet(5) }"
                                ng-click="setTab(5)" label="Activity" ng-disabled="hidetabs">
                        </md-tab>

                    </md-tabs>
                </md-content>
            </div>
        </div>

        <div ng-show="isSet(1)">
            <div class="row">
                <div class="row-header col-lg-12 col-sm-12">
                    <h4><strong>ATMA Supplier Profile Details <label ng-show="pacode">({{Partner.partnercode}}-{{Partner.partnername}})</label></strong></h4>
                </div>
            </div>
            <div name="formfill" role="form" class="row">
                <div class="col-md-12">
                    <div class="row">

                        <div class="col-md-4">
                            <md-input-container class="md-block inputcontainer">
                                <label>Partner Name </label>
                                <input type="text" maxlength="128" ng-model="Partner.partnername" ng-change="Partner.partnername = (Partner.partnername | uppercase)"
                                       autocomplete="off"
                                       required>
                            </md-input-container>
                        </div>
                        <div class="col-md-4">
                            <md-input-container class="md-block inputcontainer">
                                <label>Partner Pan No. </label>
                                <input type="text" maxlength="16" ng-model="Partner.partnerpan" ng-change="Partner.partnerpan = (Partner.partnerpan | uppercase)" autocomplete="off"
                                       >
                            </md-input-container>
                        </div>
                        <div class="col-md-4">
                            <md-input-container class="md-block inputcontainer">
                                <label> Company Reg. No </label>
                                <input type="text" maxlength="128" ng-model="Partner.companyregno" ng-change="Partner.companyregno = (Partner.companyregno | uppercase)" autocomplete="off"
                                       >
                            </md-input-container>
                        </div>

                    </div>
                    <div class="row">
                        <div class="col-md-3">
                            <md-input-container class="md-block inputcontainer">
                                <label> Customer Category</label>
                                <md-select ng-model="Partner.custcategorygid" required>
                                    <md-option ng-repeat="c in partnercustcategory"
                                               ng-value="c.custcategory_gid ">
                                        {{
                                        c.custcategory_name }}
                                    </md-option>
                                </md-select>
                            </md-input-container>
                        </div>
                         <div class="col-md-3">
                            <md-input-container class="md-block inputcontainer">
                                <label>Partner Group</label>
                                <md-select ng-model="Partner.partnergroup"  required>
                                    <md-option ng-repeat="a in partnergroup"
                                               ng-value="a.metadata_value ">
                                        {{
                                        a.metadata_value }}
                                    </md-option>
                                </md-select>
                            </md-input-container>
                        </div>
                        <div class="col-md-3">
                            <md-input-container class="md-block inputcontainer">
                                <label>Partner Classification</label>
                                <md-select ng-model="Partner.classification" ng-change="changepartnertype()" required>
                                    <md-option ng-repeat="a in partnerclassification"
                                               ng-value="a.metadata_value ">
                                        {{
                                        a.metadata_value }}
                                    </md-option>
                                </md-select>
                            </md-input-container>
                        </div>
                        <div class="col-md-3">
                            <md-input-container class="md-block inputcontainer">
                                <label>Partner Type</label>
                                <md-select ng-model="Partner.partnertype" required ng-disabled="editdisabledPartnertype">
                                    <md-option ng-repeat="x in partner" ng-value="x.metadata_value ">{{
                                        x.metadata_value }}
                                    </md-option>
                                </md-select>
                            </md-input-container>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-md-3">
                            <md-input-container class="md-block inputcontainer">
                                <label>Website</label>
                                <input type="text" maxlength="128" ng-model="Partner.website" autocomplete="off"
                                       >
                            </md-input-container>
                        </div>
                        <div class="col-md-3"  layout="row" style="margin-top:30px">
                            Contract
                            <md-radio-group   layout="row" ng-model="Partner.activecontractype" ng-change="radioChanged(Partner.activecontractype)">
                            <md-radio-button value="Yes" class="md-primary" >Yes</md-radio-button>
                            <md-radio-button value="No">No </md-radio-button>
                            </md-radio-group>
                        </div>
                        <div class="col-md-3">
                            <md-input-container class="md-block inputcontainer">
                                <label>Reason for no contract </label>
                                <input type="text" maxlength="128" ng-model="Partner.reasonfornocontract" autocomplete="off"
                                      ng-disabled="editreason">
                            </md-input-container>
                        </div>
                        <div class="col-md-3">
                            <md-input-container class="md-block inputcontainer">
                                <label>Organization Type</label>
                                <md-select ng-model="Partner.organizationtype">
                                    <md-option ng-repeat="y in organizationtype" ng-value="y.metadata_value"
                                               required>{{
                                        y.metadata_value}}
                                    </md-option>
                                </md-select>
                            </md-input-container>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-md-3">
                            <md-input-container class="md-block inputcontainer">
                                <label>Contract From</label>
                                <md-datepicker md-hide-icons="calendar" md-max-date="maxDatee" ng-disabled="contract_no"
                                               md-min-date="from_date"
                                               md-open-on-focus ng-model="Partner.contractfrom" ng-change="fromdatechange(Partner.contractfrom)"></md-datepicker>
                            </md-input-container>
                        </div>
                        <div class="col-md-3">
                            <md-input-container class="md-block inputcontainer">
                                <label>Contract To</label>
                                <md-datepicker md-hide-icons="calendar" md-max-date="maxDatee" ng-disabled="contract_no"
                                               md-min-date="from_date"
                                               md-open-on-focus ng-model="Partner.contractto" ng-change="todatechange(Partner.contractto)"></md-datepicker>
                            </md-input-container>
                        </div>
                        <div class="col-md-3">
                            <md-autocomplete md-clear-button="true"
                                             md-floating-label="RM Name"
                                             md-input-maxlength=126
                                             md-item-text="item.employee_name"
                                             md-items="item in rmdetails(searchRM)"
                                             md-min-length=0
                                             md-no-cache="true"
                                             md-search-text="searchRM"
                                             md-selected-item="selectedemp"
                                             md-selected-item-change="ACselectchange(item.employee_name)"
                                             required>
                                <md-item-template>
                                    <span md-highlight-text="searchRM">{{item.employee_name}}</span>
                                </md-item-template>
                                <md-not-found>
                                    No RM matching "{{searchRM}}" were found.
                                </md-not-found>
                            </md-autocomplete>
                        </div>
                        <div class="col-md-3">
                            <md-input-container class="md-block inputcontainer">
                                <label>Renewal Date</label>
                                <md-datepicker md-hide-icons="calendar" md-max-date="maxDatee"
                                               md-min-date="from_date"
                                               md-open-on-focus ng-model="Partner.partner_renewaldate" required >
                                </md-datepicker>
                            </md-input-container>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-md-3">
                            <md-input-container class="md-block inputcontainer">
                                <label>Aprox Spend(Rs)</label>
                                <input type="text" ng-model="Partner.approxspend" required  valid-number autocomplete="off">
                            </md-input-container>
                        </div>
                        <div class="col-md-3">
                            <md-input-container class="md-block inputcontainer">
                                <label>Actual Spend(Rs)</label>
                                <input type="text" ng-model="Partner.actualspend" required  valid-number autocomplete="off">
                            </md-input-container>
                        </div>
                        <div class="col-md-4">
                            <md-input-container class="md-block inputcontainer">
                                <label>Remarks</label>
                                <input type="text" maxlength="128" ng-model="Partner.remarks" autocomplete="off"
                                       >
                            </md-input-container>
                        </div>
                    </div>
                    <div class="row">

                        <div class="col-md-3">
                            <md-input-container class="md-block inputcontainer">
                                <laberl>Director/Partner Count</laberl>
                                <input type="text" ng-model="Partner.nodirector"
                                        autocomplete="off"
                                       required numbers-only>
                            </md-input-container>
                        </div>
                        <div class="col-md-3">
                            <md-input-container class="md-block inputcontainer">
                                <laberl>Name of Director</laberl>
                                <input type="text" maxlength="128" ng-model="directorName"
                                       aria-label='Enter Director name' autocomplete="off"
                                       required/>
                            </md-input-container>
                        </div>
                        <div class="col-md-3" ng-show="createpartner">
                            <br>
                            <md-button class="md-raised" ng-click="DirectoraddRow(Partner.nodirector)">
                                Add
                            </md-button>
                        </div>
                        <div class="col-md-3" ng-show="createpartner">
                            <br>
                            <md-button class="btn btn-info custbutton" value="Close" ng-click="save(Partner);">
                            Save
                            </md-button>
                        </div>

                    </div>
                    <div class="row">
                        <div class="col-md-12">
                            <!--CREATE A TABLE-->
                            <table class="table table-striped table-bordered table-condensed table-hover md-primary">
                                <thead class="header">
                                <tr>
                                    <th colspan="2">Director</th>
                                </tr>
                                </thead>
                                <tr ng-repeat="directorName1 in directorarray">

                                    <td><label>{{directorName1}}</label></td>
                                     <td align="center"><a href="" ng-click="Director_delete($index)"
                                                 ><i
                                    class="material-icons"
                                    style="material-icons.line-height:3px" ng-show="delete_show">delete</i></a>
                            </td>
                                </tr>
                            </table>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div ng-show="isSet(2)">
            <div ng-include="'atma_tax_details'">Tax</div>
        </div>

        <div ng-show="isSet(3)">
            <div ng-include="'atma_attachmentdetails'">Add Attachment</div>
        </div>

        <div ng-show="isSet(5)">
            <div ng-include="'atma_activityadd'">Add Activity</div>
        </div>

        <!-- ENDOF <div class="row" ng-show="isSet3)"> -->
        <div ng-show="isSet(6)">
            <div ng-include="'atma_paymentdetails'">Payment Details</div>
        </div>  <!-- ENDOF <div class="row" ng-show="isSet(6)"> -->

        <div ng-show="isSet(7)">
            <div ng-include="'atma_profilepage'">Profile</div>
        </div>

<!--        Start Profile Details Page-->
        <div ng-show="isSet(8)">
            <div ng-include="'atma_Productdetails'">Profile Product</div>
        </div>
        <div ng-show="isSet(9)">
            <div ng-include="'atma_Branchdetails'">Profile Branch</div>
        </div>
        <div ng-show="isSet(10)">
            <div ng-include="'atma_Clientdetails'">Profile Client</div>
        </div>
        <div ng-show="isSet(11)">
            <div ng-include="'atma_Contractdetails'">Profile Contract</div>
        </div>
        <div ng-show="isSet(12)">
            <div ng-include="'atma_BasicProfilDetails'">Profile Basic</div>
        </div>
        <div ng-show="isSet(13)">
            <div ng-include="'create_activity_details'">Create Activity Details</div>
        </div>
        <div ng-show="isSets(14)">
            <div ng-include="'create_catalog_details'" ng-show="qwe">Create Activity Details</div>
        </div>
<!--End Profile Details Page-->

        <div class="row">
            <div class="col-md-4">
                  <md-input-container class="md-block inputcontainer">
                    <label>Remarks</label>
                     <input type="text" ng-model="rmremarks" maxlength="256" ng-change="rmremarks()">
                    </md-input-container>
            </div>
            <div class="col-md-4 col-md-offset-4" >
                <br>
<!--                <md-button class="btn btn-info custbutton" value="Close" ng-click="save(Partner);">-->
<!--                    Save As Draft-->
<!--                </md-button>-->
                <md-button class="md-raised md-warn" value="Close" ng-click="movetoRM(Partner);" ng-show="createpartner">
                    Move To RM
                </md-button>

                <md-button class="btn btn-info custbutton" value="close" ng-href="ATMA_PartnerSummary">Cancel</md-button>
            </div>

        </div>
        <div ng-include="'atma_addpayment'">Payment View</div>
    </div> <!-- endof <div class="container container1" ng-app="Appreview" ng-controller="Ctrlreview"> -->
</div> <!--endof <div class="maincontent"> -->
{% endverbatim %}
<script>
    var app_review = angular.module('Appreview', ['ngMaterial', 'ui.bootstrap', 'AppCommon', 'ngMessages'])
        .config(function($httpProvider) {
            $httpProvider.defaults.xsrfCookieName = 'csrftoken';
            $httpProvider.defaults.xsrfHeaderName = 'X-CSRFToken';
        });

app_review.run(function($mdDateLocale, $filter) {
    $mdDateLocale.formatDate = function(date) {
        return $filter('date')(date, "dd-MMM-yyyy");
    };
})

app_review.directive('fileModel', ['$parse', function($parse) {
    return {
        restrict: 'A',
        link: function(scope, element, attrs) {
            element.bind('change', function() {
                $parse(attrs.fileModel).assign(scope, element[0].files)
                scope.$apply();
            });
        }
    };
}]);

app_review.directive("fileinput", [function() {
    return {
        scope: {
            fileinput: "=",
            filepreview: "="
        },
        link: function(scope, element, attributes) {
            element.bind("change", function(changeEvent) {
                scope.fileinput = changeEvent.target.files[0];
                var reader = new FileReader();
                reader.onload = function(loadEvent) {
                    scope.$apply(function() {
                        scope.filepreview = loadEvent.target.result;
                    });
                }
                reader.readAsDataURL(scope.fileinput);
            });
        }
    }
}]);

app_review.controller('Ctrlreview', function($scope, $rootScope, $filter, $mdDialog, Servicedrctsale,
    SerCommon, $element, $window, $location) {
    $element.find('input').on('keydown', function(ev) {
        ev.stopPropagation();
    });

    var detail = JSON.parse(sessionStorage.getItem('today'));
    $scope.employgid = detail.employee_gid1;

    $scope.entity_gid = detail.entity_gid;
    $scope.create_by = detail.employee_gid;
    //alert(JSON.stringify($scope.create_by));
    $scope.updtdis = true;
window.mdSelectOnKeyDownOverride = function(event) {
        event.stopPropagation();
    };
    $scope.currentPage = 1;
    $scope.cate_currentPage = 1;
    cate_itemsPerPage=5;
    $scope.currentPages = 1;
    $scope.currentPages1 = 1;
    $scope.currentPage_payment = 1;
    $scope.maxSize_payment = 3;
    $scope.itemsPerPage_payment = 10;
    $scope.maxSize = 3;
    $scope.cata_maxSize = 3;
    $scope.add = [];
    $scope.Partner = [];
    $scope.Activityadd=[];
    $scope.Attachment=[];
    $scope.itemsPerPage = 10;

    $scope.maxDate = new Date();
    $scope.gotcatagory =gotcatagory;

    $scope.ActivitycurrentPage = 1;
    $scope.ActivitymaxSize = 3;
    $scope.ActivityitemsPerPage = 10;
    $scope.itemsPerPage1 = 5;
    $scope.itemsPerPages = 5;
    $scope.itemsPerPages1 = 5;
    $scope.cata_maxSize = 3;

    $scope.header = [];
    $scope.rmdetails = fn_rmdetails;
    $scope.act_branchdetails=fn_activitybranchdetails;
    $scope.payment_partnerbranchdetails=fn_paymentpartnerbranchdetails;
    $scope.tax_partnerbranchdetails=fn_taxpartnerbranchdetails;
    $scope.gotodocname = gotodocname1;

    $scope.showadd = false;

    $scope.paymodename = paymodename;
    $scope.bank_name = bankgid;
    $scope.branch_name = bankbranchnames;
    $scope.paymodebankacctype = gotopartneracctype;

    $scope.one="gg";
    $scope.gottaxdetails=gottaxdetails;
    $scope.gottaxrate=gottaxratedetails;
    $scope.gotisexcempted=gotisexcempted;
    $scope.gottaxmsmedetails=gottaxmsmedetails;
    $scope.getproduct_gid = getproduct_gid;
    $scope.renewal_setdate=new Date($scope.Partner.contractto);
    $scope.gotoraiser = gotoraiser;

    $scope.ert=gotoapprover;
    //alert($scope.renewal_setdate);
    $scope.gotopartne_activity=gotopartne_activity;
    $scope.showpopup = function() {

        modalshow('mdl_present11');
    }


$scope.todatechange = function(e) {

    $scope.re_date=new Date(e)

       load_Data(e);
            $scope.Partner.partner_renewaldate=load_Data();

            function load_Data(){
             return new Date(
               $scope.re_date.getFullYear(),
               $scope.re_date.getMonth() - 1,
               $scope.re_date.getDate());
                }
                //alert($scope.re_date)
       }

       $scope.fromdatechange = function(e) {

    $scope.contarct_to_date=new Date(e)

       load_FromData(e);
            $scope.Partner.contractto=load_FromData();

            function load_FromData(){
             return new Date(
               $scope.contarct_to_date.getFullYear() +1,
               $scope.contarct_to_date.getMonth() ,
               $scope.contarct_to_date.getDate());
                }
                 $scope.re_date= $scope.Partner.contractto
                load_Data(e);

            $scope.Partner.partner_renewaldate=load_Data();

            function load_Data(){
             return new Date(
               $scope.re_date.getFullYear(),
               $scope.re_date.getMonth() - 1,
               $scope.re_date.getDate());
                }
                //alert($scope.contarct_to_date)

       }
    $scope.loading = function() {
        $mdDialog.show({
            templateUrl: 'loaderSpinner',
            parent: angular.element(document.body),
            clickOutsideToClose: false
        });
    };
    $scope.endloading = function() {
        $mdDialog.hide();
    };

    $scope.Director_delete = function(index){
         //alert(index);
         $scope.directorarray.splice(index, 1);
         $scope.Partner.nodirector=$scope.directorarray.length;
    }
    $scope.hidetabs=true;
    if (sessionStorage.getItem('partner_summary_session') != null)
     {
        //alert(JSON.parse(sessionStorage.getItem('partner_summary_session')));
        var partner_detail = JSON.parse(sessionStorage.getItem('partner_summary_session'));
        $scope.a=[partner_detail];
        //alert(JSON.stringify($scope.a));
        $scope.partner_gid = partner_detail.partnerdata.partner_gid;
        $scope.partner_rmgids = partner_detail.partnerdata.partner_rmname;
        //$scope.partnercode =  partner_detail.partnerdata.partner_code;
        //alert($scope.Partner.partner_gid);
        $scope.update = partner_detail.view;
        $scope.createpartner=true;

        if($scope.partner_gid > 0)
        {
        $scope.hidetabs=false;
        $scope.Partner = [];
        $scope.editdisabled = true;
        $scope.pacode=true;

        if(partner_detail.partnerdata.partner_activecontract=="Yes"){

         $scope.Partner.reasonfornocontract=""
        }else{
           $scope.Partner.reasonfornocontract=partner_detail.partnerdata.partner_reason_no_contract
        }
        $scope.Partner.partnercode =  partner_detail.partnerdata.partner_code;
        $scope.partner_rm_gid = partner_detail.partnerdata.partner_rmname;
        //alert($scope.partner_rmgids);
        $scope.Partner.partnername =  partner_detail.partnerdata.partner_name;
        $scope.tax_partnername=partner_detail.partnerdata.partner_name;
        $scope.Partner.partnerpan= partner_detail.partnerdata.partner_panno;
        $scope.Partner.companyregno= partner_detail.partnerdata.partner_compregno;
        $scope.Partner.custcategorygid= partner_detail.partnerdata.partner_custcategorygid;
        $scope.Partner.partnertype=partner_detail.partnerdata.partner_type;
        $scope.Partner.partnergroup=partner_detail.partnerdata.partner_group;
        $scope.Partner.classification=partner_detail.partnerdata.partner_Classification;
        $scope.Partner.website=partner_detail.partnerdata.partner_web;
        $scope.Partner.activecontractype=partner_detail.partnerdata.partner_activecontract;
        //$scope.Partner.reasonfornocontract=partner_detail.partnerdata.partner_reason_no_contract;
        $scope.Partner.organizationtype=partner_detail.partnerdata.partner_orgtype;
        $scope.Partner.contractfrom=new Date(partner_detail.partnerdata.partner_contractdatefrom);
        $scope.Partner.contractto=new Date(partner_detail.partnerdata.partner_contractdateto);
        $scope.Partner.partner_renewaldate=new Date(partner_detail.partnerdata.partner_renewdate);
        $scope.Partner.approxspend=partner_detail.partnerdata.partner_aproxspend;
        $scope.Partner.actualspend=partner_detail.partnerdata.partner_actualspend;
        $scope.Partner.remarks=partner_detail.partnerdata.partner_remarks;
        $scope.Partner.nodirector=partner_detail.partnerdata.partner_noofdir;
        $scope.selectedemp=partner_detail.partnerdata.employee_name;
        $scope.Partnercreateby=partner_detail.partnerdata.create_by;
        $scope.Partnestus=partner_detail.partnerdata.partner_status;
        $scope.Part_request=partner_detail.partnerdata.partner_requestfor;
        getdirector_data($scope.partner_gid);
        //alert($scope.Partner.activecontractype);
      if (partner_detail.partnerdata.partner_contractdatefrom){
      debugger;
                $scope.Partner.contractfrom =  formatStringDate(new Date(partner_detail.partnerdata.partner_contractdatefrom), 'yyyy-mm-dd');
             }
             else
             {
                $scope.Partner.contractfrom= null;
             }
             if (partner_detail.partnerdata.partner_contractdateto){
                $scope.Partner.contractto =  formatStringDate(new Date(partner_detail.partnerdata.partner_contractdateto), 'yyyy-mm-dd');
             }
             else
             {
                $scope.Partner.contractto= null;
             }
        if($scope.Partner.activecontractype=='No'){
        $scope.contract_no=true;
        $scope.editreason=false;
        }else{
        $scope.contract_no=false;
        $scope.editreason=true;
        }
        if( $scope.Partnestus ==  "DRAFT" || $scope.Partnestus ==  "REJECTED"){
     //alert("True");
     $scope.createpartner=true;
     $scope.delete_show=true;
     }else{
     //alert("False");
     $scope.createpartner=false;
     $scope.delete_show=false;
     }
        }

     }

     if($scope.Partnestus == "APPROVED"){
     $scope.msttable="Mst"
     }else{
     $scope.msttable=""
     }
<!--    alert($scope.msttable);-->
if( $scope.Part_request == "MODIFICATION"){
$scope.showcatalog=true;
$scope.hideaddbutton=false;
$scope.showsubmit=false;
}else{
$scope.showcatalog=false;
$scope.hideaddbutton=true;
$scope.showsubmit=true;
}

//$scope.editreason=true;
     $scope.radioChanged=function(x){
     if(x=="Yes"){
     $scope.editreason=true;
     $scope.Partner.reasonfornocontract="";
     $scope.contract_no=false;
     $scope.Partner.partner_renewaldate='';
     }else{
     $scope.editreason=false;
     $scope.contract_no=true;
    $scope.currentMinute = new Date();
    $scope.Partner.contractfrom='';
    $scope.Partner.contractto='';

    load_Datas();
    function load_Datas(){
             return new Date(
               $scope.currentMinute.getFullYear() +1,
               $scope.currentMinute.getMonth(),
               $scope.currentMinute.getDate());
                }
     }
    $scope.Partner.partner_renewaldate=load_Datas();

     }

    function getdirector_data(partnerGid){

        var data = {
            "Params": {
                "Filter":{
                    "Director_Partnergid":partnerGid,
                },
                "Classification": {
                    "Entity_Gid": $scope.entity_gid
                },
                "Group": "ATMASUMMARY",
                "Action": "Directors_Get",
                "Type": "dirname",
            }
        }
        var get_dir_data = Servicedrctsale.get_director(data)
        get_dir_data.then(function(result) {

        $scope.directorarraynew = [];
        $scope.directorarray = [];

            $scope.directorarraynew=result.data.DATA;

            for (var i = 0; i < $scope.directorarraynew.length; i++)
            {
                $scope.directorarray.push($scope.directorarraynew[i].directorName1);
            }

        })
    }

    $scope.tab = 1
    $scope.setTab = function(newTab) {
        $scope.tab = newTab;
        $scope.qwe=false;
    };

    $scope.isSet = function(tabNum) {
        return $scope.tab === tabNum;
    };


    $scope.Previous_clk=function(e,btn_type){

    $scope.loading();
    $scope.qwe=false;
    $scope.qw1=e.activity_gid;
    $scope.a=$scope.getActivitySummary.length-1;
    $scope.ase=JSON.stringify($scope.getActivitySummary[$scope.a].activity_gid);
    //alert( $scope.ase);
    $scope.ase1=JSON.stringify($scope.getActivitySummary[0].activity_gid);
    if(btn_type=="Previous"){
    if(parseInt($scope.ase1) == $scope.qw1){
    alert("Reach The Minium Count");
    $scope.endloading();
    return false;

    }}
     if(btn_type=="next"){
    if($scope.ase == $scope.qw1){
    alert("Reach The Maximum Count");
     $scope.endloading();
    return false;
    }}
            for (var i = 0; i < $scope.getActivitySummary.length; i++) {
                if ($scope.getActivitySummary[i].activity_gid == $scope.qw1) {
                $scope.arrayindex=i;
                }
            }
    if(btn_type=="Previous"){
        $scope.bind_actdetdata=$scope.getActivitySummary[$scope.arrayindex - 1];
        $scope.act_details=$scope.getActivitySummary[$scope.arrayindex - 1].activity_gid;

    }
    if(btn_type=="next"){
        $scope.bind_actdetdata=$scope.getActivitySummary[$scope.arrayindex + 1];
        $scope.act_details=$scope.getActivitySummary[$scope.arrayindex + 1].activity_gid;
    }
    setTab_Changes();
    $scope.endloading();
    }


        $scope.tab = 1;

     $scope.act_details=0;
    $scope.setTab_Change = function(newTab,e) {
    debugger;
    $scope.bind_actdetdata=e;

    $scope.act_details=e.activity_gid;
    $scope.act_name_bind=e.activity_name;
    $scope.activity_partnerbranchgid_formap=e.partnerbranch_gid;
        $scope.tab = newTab;
<!--        activity_branchname();-->
        setTab_Changes();
    };
//start activity details

 function setTab_Changes(){

     //alert($scope.act_det.act_details);
            var filter = {};
            if ($scope.add.activityname1) {
                filter['Activitydetails_Activitygid'] = $scope.add.activityname1
            } else {
                filter['Activitydetails_Activitygid'] = '';
            }
            if ($scope.add.activitydetailname1) {
                filter['Activitydetails_Name'] = $scope.add.activitydetailname1
            } else {
                filter['Activitydetails_Name'] = '';
            }
            var data = {
                "Params": {
                    "Filter": {
                    "Activitydetails_Activitygid":$scope.act_details,
                    "Mst_Table": $scope.msttable,
                    },
                    "Classification": {
                        "Entity_Gid": $scope.entity_gid
                    }
                }
            }
            var dtamactivity = {
                Group: 'Activity_Details',
                Type: 'Activitydetails_Get',
                data: data
            }
            $scope.getactivity = [];
            var getactivity = Servicedrctsale.getdattamactivity(dtamactivity)
            getactivity.then(function (result) {
                $scope.getactivity = result.data.DATA;
                //alert(JSON.stringify($scope.getactivity));
                $scope.searchactivity_details=$scope.getactivity;
                $scope.pageLength11 = $scope.getactivity.length;
            }, function (err) {
                alert('No data!.');
            }).finally();
        }

        $rootScope.showpopup_actdet = function () {
        $scope.addactivitydetails=true;
        $scope.updateactivitydetails=false;
            $scope.add.activityname= "";
            $scope.add.activitydetailcode= "";
            $scope.add.activitydetailname= "";
            $scope.add.activityremark= "";
            $scope.add.raiser="";
            $scope.add.approvername= "";
            modalshow('addactivitydetailspopup');
        }

        $scope.save_act_details = function (add) {

 if($scope.raiser_employee_gid == $scope.aproval_employee_gid){
 alert("Please Select Raiser and Aproval are Different")
 }else{

            var data = {
                "Params": {
                    "Activitydetails_Activitygid": $scope.act_details,
                    "Activitydetails_Code": add.activitydetailcode,
                    "Activitydetails_Name": add.activitydetailname,
                    "Activitydetails_Remarks": add.activityremark,
                    "Activitydetails_Raisor":$scope.raiser_employee_gid,
                    "Activitydetails_Approver":$scope.aproval_employee_gid,
                },
                "Classification": {
                    "Entity_Gid": $scope.entity_gid,
                    "Create_By": $scope.create_by
                },
            }
            var details = {
                Group: 'Activity_Details',
                Action: 'Insert',
                Type: 'Activity_Details',
                data: data,
            }
            $scope.actdetails = [];
            $scope.loading();

            var set_actdetails = Servicedrctsale.setactdetails(details)
            set_actdetails.then(function (result) {
                    //alert(JSON.stringify(result.data));
                    $scope.actdetails = result.data.MESSAGE;
                    if($scope.actdetails=="SUCCESSFULLY INSERTED"){
                    alert("SUCCESSFULLY INSERTED");
                    modalhide('addactivitydetailspopup');
                    setTab_Changes();
                    }else{
                    alert(JSON.stringify($scope.actdetails));
                     modalshow('addactivitydetailspopup');
                    }
                }),
                function (err) {
                    alert('no data');
                }.finally($scope.endloading());
        }
        }

        fn_raiserload();
        function fn_raiserload(){
        var dat = {
            "Table_name": "gal_mst_temployee",
            "Column_1": "employee_gid,employee_name,employee_code",
            "Column_2": "",
            "Where_Common": "employee",
            "Where_Primary": "employee_gid",
            "Primary_Value": "",
            "Order_by": "name"
        }
        var praiser = {
            Action: "",
            Entity_Gid: $scope.entity_gid,
            data: dat
        }
        $scope.raiser = [];
        var getraiser = Servicedrctsale.getraiserdata(praiser)
        getraiser.then(function (result) {
            $scope.raiser = result.data.DATA;
             $scope.raiser.forEach(function(v)
        {
            v.employee_name=v.employee_name+"-"+v.employee_code;
        });
             //alert(JSON.stringify(result.data));
        }, function (err) {
            // alert('No data!.');
        }).finally();
        }

    function gotoraiser(query) {
            var result = $filter('filter')($scope.raiser, {
                'employee_name': query
            });
            return result;
        }
    function gotoapprover(query) {
            var result = $filter('filter')($scope.approver, {
                'employee_name': query
            });
            return result;
        }
        got_approval();
    function got_approval(){
        var dat = {
            "Table_name": "gal_mst_temployee",
            "Column_1": "employee_gid,employee_name,employee_code",
            "Column_2": "",
            "Where_Common": "employee",
            "Where_Primary": "employee_gid",
            "Primary_Value": "",
            "Order_by": "name"
        }
        var papprover = {
            Action: "",
            Entity_Gid: $scope.entity_gid,
            data: dat
        }
        $scope.approver = [];
        var getapprover = Servicedrctsale.getapproverdata(papprover)
        getapprover.then(function (result) {
            $scope.approver = result.data.DATA;
            $scope.approver.forEach(function(v)
        {
            v.employee_name=v.employee_name+"-"+v.employee_code;
        });
            // alert(JSON.stringify(result.data));
        }, function (err) {
            // alert('No data!.');
        }).finally();
}

   $scope.raiser_empname=function(e){

$scope.raiser_employee_gid=e.employee_gid;
    }
$scope.Approver_empname=function(e){
$scope.aproval_employee_gid=e.employee_gid;
}
$scope.edit_data = function (prod) {

            fn_raiserload();
            $scope.activitydetailsgid=prod.activitydetails_gid;
            $scope.addactivitydetails=false;
            $scope.updateactivitydetails=true;
            $scope.add.activityname= prod.activity_name;
            $scope.add.activitydetailcode= prod.activitydetails_code;
            $scope.add.activitydetailname= prod.activitydetails_name;
            $scope.add.activityremark= prod.activitydetails_remarks;
            $scope.add.raiser=prod.Raisor;
            $scope.add.approvername= prod.Approver;
            modalshow('addactivitydetailspopup');
             }
$scope.update_activitydetails=function(add){

 var data = {
                "Params": {
                    "Activitydetails_Gid":$scope.activitydetailsgid,
                    "Activitydetails_Activitygid": $scope.act_details,
                    "Activitydetails_Code": add.activitydetailcode,
                    "Activitydetails_Name": add.activitydetailname,
                    "Activitydetails_Remarks": add.activityremark,
                    "Activitydetails_Raisor":$scope.raiser_employee_gid,
                    "Activitydetails_Approver":$scope.aproval_employee_gid,
                },
                "Classification": {

                    "Update_By": $scope.create_by
                },
            }
            var details = {
                Group: 'Activity_Details_Update',
                Action: 'UPDATE',
                Type: '',
                data: data,
            }
            $scope.actdetails = [];
<!--            $scope.loading();-->
            var update_actdetails = Servicedrctsale.updateactdetails(details)
            update_actdetails.then(function (result) {
                    //alert(JSON.stringify(result.data));
                    $scope.actdetails = result.data;
                    if($scope.actdetails=="SUCCESS"){
                    alert("SUCCESSFULLY UPDATED");
                    modalhide('addactivitydetailspopup');
                    setTab_Changes();
                    }else{
                    alert(JSON.stringify($scope.actdetails));
                     modalshow('addactivitydetailspopup');
                    }
                }),
                function (err) {
                    alert('no data');
                }.finally($scope.endloading());
        }
 $scope.show_activitydetails = function (prod) {

            fn_raiserload();
            $scope.activitydetailsgid=prod.activitydetails_gid;
            $scope.addactivitydetails=false;
            $scope.updateactivitydetails=false;
            $scope.add.activityname= prod.activity_name;
            $scope.add.activitydetailcode= prod.activitydetails_code;
            $scope.add.activitydetailname= prod.activitydetails_name;
            $scope.add.activityremark= prod.activitydetails_remarks;
            $scope.add.raiser=prod.Raisor;
            $scope.add.approvername= prod.Approver;
            modalshow('addactivitydetailspopup');
             }
             $scope.search_activity_details=function(e){

            $scope.getactivity = $filter('filter')($scope.searchactivity_details , {

               "activitydetails_name": e.activitydetailname1,
               "activitydetails_code": e.activitydetailcode1,
               "activitydetails_remarks":e.activityremark1

        });
}


//end activity details

//start Catalog


    $scope.setTab_ChangeCatalog = function(newTab,e) {
        $scope.tabs = newTab;
        $scope.qwe=true;
        $scope.activity_detgid=e.activitydetails_gid;
        $scope.activity_detname=e.activitydetails_name;
        //alert($scope.activity_detgid);
        getcatalogdetails();

    };

    $scope.isSets = function(tabNum) {
        $scope.tabNums=tabNum;
         if ($scope.tabs === $scope.tabNums){
         return true;
         }
         else{
         return false;
         }
    };


        function getcatalogdetails(){
        var data = {
            "Params": {
                "Filter": {
                "activitydtlpproduct_activitydetailsgid":  $scope.activity_detgid,
                "mpartnerproduct_partner_gid":  $scope.partner_gid,
                "mPartnerProduct_Status":"Draft",
                },
                "Classification": {
                    "Entity_Gid": $scope.entity_gid
                }
            }
        }
        var dtam = {
            Group: 'Catalog_Details',
            Type: 'activitydtlpp_GET',
            data: data
        }
        $scope.getcompaignm = [];
        var getcompaignm = Servicedrctsale.getdattams(dtam)
        getcompaignm.then(function (result) {
            $scope.getcompaignm = result.data.DATA;
            $scope.getcompaignms = result.data.DATA.partner_requestfor;
            //alert(JSON.stringify($scope.getcompaignm));
            //alert(JSON.stringify($scope.getcompaignms));
            $scope.searchcatalog=$scope.getcompaignm;
            $scope.load = $scope.getcompaignm
            $scope.pageLength = $scope.getcompaignm.length;
            $scope.pageLengths = $scope.checkerdetails.length;
        }, function (err) {
            alert('No data!.');
        }).finally();

        }

        $rootScope.showpopup_actdetails = function () {

           $scope.updatecatalog=false;
        $scope.addcatalog=true;
            $scope.add.catalogactivitydetail=$scope.activity_details_name,
            $scope.add.catalogcategory="",
            $scope.add.subcategory="",
            $scope.add.catalogname="",
            $scope.add.catalogspec="",
            $scope.add.catalogsize="",
            $scope.add.catalogremarks="",
            $scope.add.uomgid="",
            $scope.add.catalograte="",
            $scope.add.contractfrom="",
            $scope.add.contractto="",
            $scope.add.unitprice="",
            $scope.add.packingprice="",
            $scope.add.deliverydays="",
            $scope.add.capacitypw="",
            $scope.add.dts="",
            $scope.add.catalog_partner_product_gid="",
            modalshow('addcatalogdetailspopup');
        }

$scope.catalog_save = function (add) {

            //alert(JSON.stringify(add))
            var data = {
                "Params": {
                    "activitydtlpproduct_ActivityDetailsGid":$scope.activity_detgid,
                    "activitydtlpproduct_partnerbranchgid":$scope.activity_partnerbranchgid_formap,
                    "activitydtlpproduct_Category": add.catalogcategory,
                    "activitydtlpproduct_SubCategory": add.subcategory,
                    "activitydtlpproduct_Name": add.catalogname,
                    "activitydtlpproduct_Spec": add.catalogspec,
                    "activitydtlpproduct_Size": add.catalogsize,
                    "activitydtlpproduct_Remarks": add.catalogremarks,
                    "activitydtlpproduct_UomGid": add.uomgid,
                    "activitydtlpproduct_Rate": add.catalograte,
                    "activitydtlpproduct_ValidFrom": add.contractfrom,
                    "activitydtlpproduct_ValidTo": add.contractto,
                    "mPartnerProduct_UnitPrice": add.catalograte,
                    "mPartnerProduct_PackingPrice": add.packingprice,
                    "mPartnerProduct_DeliveryDays": add.deliverydays,
                    "mPartnerProduct_CapacityPW": add.capacitypw,
                    "mPartnerProduct_DTS": add.dts,
                    "mPartnerProduct_Status":"Draft",
                    "mPartnerProduct_Partner_Gid": $scope.partner_gid,
                    "mPartnerProduct_Product_Gid": $scope.mpartnerproduct_gid
                },
                "Classification": {
                    "Create_By": $scope.create_by,
                    "Entity_Gid": $scope.entity_gid,
                },
            }
            var total = {
                Group: 'Catalog Details',
                Action: 'activitydtlpp_INSERT',
                Type: 'Catalog Details',
                data: data
            }
            var set_catalog = Servicedrctsale.pcatalog(total)
            set_catalog.then(function (result) {
                    $scope.catalog = [];
                    $scope.catalog = result.data.MESSAGE;
                    if($scope.catalog=="SUCCESSFULLY INSERTED"){
                    alert("SUCCESSFULLY INSERTED");
                    modalhide('addcatalogdetailspopup');
                    getcatalogdetails();
                    }else{
                    alert(JSON.stringify($scope.catalog));
                    //$window.location.href = 'ATMA_PartnerSummary';
                    }
                }),
                function (err) {
                    alert('no data');
                };
        }

        var
            datan = {
                "Table_name": "ap_mst_tcategory",
                "Column_1": "category_gid,category_name",
                "Column_2": "",
                "Where_Common": "category",
                "Where_Primary": "",
                "Primary_Value": "",
                "Order_by": "name"
            }
        var
            trans = {
                Action: "",
                Entity_Gid: $scope.entity,
                data: datan
            }
        $scope.categorydetails = [];
        var getcategory = Servicedrctsale.getprodt(trans)
        getcategory.then(function (result) {
            $scope.categorydetails = result.data.DATA;
            //alert(JSON.stringify( $scope.categorydetails));
        }, function (err) {
            // alert('No data!.');
        }).finally();
        function subcategoryname(query) {
            var result = $filter('filter')($scope.subcategoryname, {
                'subcategory_name': query
            });
            return result;
        }
         function gotcatagory(query) {
            var result = $filter('filter')($scope.categorydetails, {
                'category_name': query
            });
            return result;
        }
        $scope.catalogcategorychange=function(e){

            var
                datan = {
                    "Table_name": "ap_mst_tsubcategory",
                    "Column_1": "subcategory_gid,subcategory_name",
                    "Column_2": "",
                    "Where_Common": "subcategory",
                    "Where_Primary": "categorygid",
                    "Primary_Value": e.catalogcategory,
                    "Order_by": "name"
                }
            var
                subtrans = {
                    Action: "",
                    Entity_Gid: $scope.entity,
                    data: datan
                }
            $scope.subcategorydetails = [];
            var getsubcategory = Servicedrctsale.getprodt(subtrans)
            getsubcategory.then(function (result) {
                $scope.subcategorydetails = result.data.DATA;
                //alert(JSON.stringify($scope.subcategorydetails));
            }, function (err) {
                // alert('No data!.');
            }).finally();
        }

         var
            datan = {
                "Table_name": "gal_mst_tuom",
                "Column_1": "uom_gid,uom_code,uom_name",
                "Column_2": "",
                "Where_Common": "uom",
                "Where_Primary": "",
                "Primary_Value": "",
                "Order_by": "name"
            }
        var
            transuom = {
                Action: "",
                Entity_Gid: $scope.entity,
                data: datan
            }
        var getuom = Servicedrctsale.getprodtuom(transuom)
        getuom.then(function (result) {
            $scope.uom = result.data.DATA;
        }, function (err) {
            alert('No data!.');
        }).finally();

        function getproduct_gid(module) {
        var result = $filter('filter')($scope.partner_product, {
            'product_name': module

        });
        return result;
    }
     $scope.catalogsubcategorychange=function(e){

           var datan = {
                "Table_name": "gal_mst_tproduct",
                "Column_1": "product_gid,product_name",
                "Column_2": "",
                "Where_Common": "product",
                "Where_Primary": "subcategory_gid",
                "Primary_Value": "1",
                "Order_by": "gid"
            }
        var total = {
                Action: "Productname",
                Entity_Gid: $scope.entity,
                data: datan
            }
            var get_partnerproduct_gid = Servicedrctsale.partnerproductgidservice(total)
            get_partnerproduct_gid.then(function (result) {
                    $scope.partner_product = [];
                    $scope.partner_product = result.data.DATA;
                   //alert(JSON.stringify($scope.partner_product))
                }),
                function (err) {
                    alert('no data');
                };

        }

    $scope.partnerprod_gid=function(e){

        $scope.mpartnerproduct_gid=e.product_gid

        }

        $scope.catalog_update=function(add){

        var data = {
                "Params": {
                    "activitydtlpproduct_Gid":$scope.catalogdetails_gid,
                    "activitydtlpproduct_partnerbranchgid":$scope.activity_partnerbranchgid_formap,
                    "activitydtlpproduct_Category": add.catalogcategory,
                    "activitydtlpproduct_SubCategory": add.subcategory,
                    "activitydtlpproduct_Name": add.catalogname,
                    "activitydtlpproduct_Spec": add.catalogspec,
                    "activitydtlpproduct_Size": add.catalogsize,
                    "activitydtlpproduct_Remarks": add.catalogremarks,
                    "activitydtlpproduct_UomGid": add.uomgid,
                    "activitydtlpproduct_Rate": add.catalograte,
                    "activitydtlpproduct_ValidFrom": add.contractfrom,
                    "activitydtlpproduct_ValidTo": add.contractto,
                    "mPartnerProduct_Product_Gid":$scope.mpartnerproduct_gid,
                    "mPartnerProduct_UnitPrice":add.unitprice,
                    "mPartnerProduct_PackingPrice":add.packingprice,
                    "mPartnerProduct_DeliveryDays":add.deliverydays,
                    "mPartnerProduct_CapacityPW":add.capacitypw,
                    "mPartnerProduct_DTS":add.dts
                },
                "Classification": {
                    "Update_By": $scope.create_by,
                    "Entity_Gid": $scope.entity_gid,
                },
            }
            var total = {
                Group: 'Catalog_Details_Update',
                Action: 'activitydtlpp_UPDATE',
                Type: 'Catalog Details',
                data: data
            }
            var update_catalog = Servicedrctsale.updatecatalogservice(total)
            update_catalog.then(function (result) {
                    $scope.update_catalog = [];
                    $scope.update_catalog = result.data;
                    if($scope.update_catalog=="SUCCESS"){
                    alert("SUCCESSFULLY UPDATED");
                    modalhide('addcatalogdetailspopup');
                    getcatalogdetails();
                    }else{
                    alert(JSON.stringify($scope.update_catalog));
                    modalshow('addcatalogdetailspopup');
                    //$window.location.href = 'ATMA_PartnerSummary';
                    }
                }),
                function (err) {
                    alert('no data');
                };

        }

         $scope.edit_data_actdet=function(e){

        $scope.updatecatalog=true;
        $scope.addcatalog=false;
                $scope.catalogdetails_gid=e.activitydtlpproduct_gid,
                $scope.add.catalog_partner_product_gid=e.product_name,
                $scope.add.catalogactivitydetail=$scope.activity_details_name,
                $scope.add.catalogcategory=e.activitydtlpproduct_category,
               $scope.add.subcategory=e.activitydtlpproduct_subcategory,
                $scope.add.catalogname=e.activitydtlpproduct_name,
                $scope.add.catalogspec=e.activitydtlpproduct_spec,
                $scope.add.catalogsize=e.activitydtlpproduct_size,
                $scope.add.catalogremarks=e.activitydtlpproduct_remarks,
                $scope.add.uomgid=e.activitydtlpproduct_uomgid,
                $scope.add.catalograte=e.activitydtlpproduct_rate,
                $scope.add.contractfrom=new Date(e.activitydtlpproduct_validfrom),
                $scope.add.contractto=new Date(e.activitydtlpproduct_validto),
                $scope.add.unitprice=e.activitydtlpproduct_rate,
                $scope.add.packingprice=e.mpartnerproduct_packingprice,
                $scope.add.deliverydays=e.mpartnerproduct_deliverydays,
                $scope.add.capacitypw=e.mpartnerproduct_capacitypw,
                $scope.add.dts=e.mpartnerproduct_dts,
                $scope.add.mpartnerproduct_gid=e.activitydtlpproduct_gid,
                modalshow('addcatalogdetailspopup')
        }

         $scope.show_catalog=function(e){

        $scope.updatecatalog=false;
        $scope.addcatalog=false;
                $scope.catalogdetails_gid=e.activitydtlpproduct_gid,
                $scope.add.catalog_partner_product_gid=e.product_name,
                $scope.add.catalogactivitydetail=$scope.activity_details_name,
                $scope.add.catalogcategory=e.activitydtlpproduct_category,
               $scope.add.subcategory=e.activitydtlpproduct_subcategory,
                $scope.add.catalogname=e.activitydtlpproduct_name,
                $scope.add.catalogspec=e.activitydtlpproduct_spec,
                $scope.add.catalogsize=e.activitydtlpproduct_size,
                $scope.add.catalogremarks=e.activitydtlpproduct_remarks,
                $scope.add.uomgid=e.activitydtlpproduct_uomgid,
                $scope.add.catalograte=e.activitydtlpproduct_rate,
                $scope.add.contractfrom=new Date(e.activitydtlpproduct_validfrom),
                $scope.add.contractto=new Date(e.activitydtlpproduct_validto),
                $scope.add.unitprice=e.mpartnerproduct_unitprice,
                $scope.add.packingprice=e.mpartnerproduct_packingprice,
                $scope.add.deliverydays=e.mpartnerproduct_deliverydays,
                $scope.add.capacitypw=e.mpartnerproduct_capacitypw,
                $scope.add.dts=e.mpartnerproduct_dts,
                $scope.add.mpartnerproduct_gid=e.activitydtlpproduct_gid,
                modalshow('addcatalogdetailspopup')
        }

        $scope.search_catalog=function(e){

            if(e.catalogcategory1 != undefined && e.catalogcategory1 != null && e.catalogcategory1 !='' )
        {
        var tempvar= e.catalogcategory1.category_name;
        }
        else
        {
        var tempvar='';
        }
            $scope.getcompaignm = $filter('filter')($scope.searchcatalog , {

               "activitydtlpproduct_name":e.catalogname1 == null ||  e.catalogname1 == undefined  || e.catalogname1 == '' ? '' : e.catalogname1,
               "activitydtlpproduct_spec":e.catalogspec1 == null ||  e.catalogspec1 == undefined  || e.catalogspec1 == '' ? '' : e.catalogspec1,
               "activitydtlpproduct_remarks":e.catalogremarks1 == null ||  e.catalogremarks1 == undefined  || e.catalogremarks1 == '' ? '' : e.catalogremarks1,
               "activitydtlpproduct_category":tempvar == null ||  tempvar == undefined  || tempvar == '' ? '' : tempvar


        });


}
//end Catalog
//start maping partner
getPartnerProductCheckerDetails();
function getPartnerProductCheckerDetails(){

    var data = {
        "Params": {
        "Partner_Gid":$scope.partner_gid,

         },
         "Classification": {
            "Entity_Gid":$scope.entity_gid,
         },
    }
    var details = {
        Group: 'Checker_Get',
        Action: 'Checker_Get',
        Type:"",
        data: data,
    }
    var get_checkerdetails = Servicedrctsale.checkergetService(details)
    get_checkerdetails.then(function(result) {

     $scope.checkerdetails =[];
        $scope.checkerdetails = result.data.DATA;
        $scope.searchcheckerdetails=$scope.checkerdetails;
        //alert(JSON.stringify($scope.checkerdetails))
    }),
    function(err) {
        alert('no data');
    };
}
$scope.assign_catalog=function(e){

var data = {
        "Params": {
        "mPartnerProduct_Gid":e.mpartnerproduct_gid,
        "ActivitydtlpProduct_ActivityDetailsGid":$scope.activity_detgid,
        "mPartnerProduct_Status":"Draft",
         },
         "Classification": {
            "Create_By": $scope.create_by,
            "Entity_Gid":$scope.entity_gid,
         },
    }
    var details = {
        Group: 'CATALOG_ASSIGN',
        Action: 'Assign_Catalog_Insert',
        Type:"",
        data: data,
    }
    var set_assingcatalogdetails = Servicedrctsale.assigncatalogService(details)
    set_assingcatalogdetails.then(function(result) {
        $scope.assign_catalogdetails = result.data.MESSAGE;
        if($scope.assign_catalogdetails == "SUCCESS"){
        alert("Catalog Assgin Successfully");
        getcatalogdetails();
        getPartnerProductCheckerDetails();
        }
        $scope.searchassigncatalog=$scope.assign_catalogdetails;
        //alert(JSON.stringify($scope.assign_catalogdetails))
    }),
    function(err) {
        alert('no data');
    };
}

//end maping partner

    $scope.directorarray = [];
    $scope.count = 0;


    $scope.DirectoraddRow = function(value) {


        //$scope.loading();

        if ( typeof $scope.directorName == 'undefined') {
            alert( 'Director name can not be empty');
            return true;
        }

        if ($scope.directorarray.indexOf($scope.directorName) > -1) {
            alert($scope.directorName + ' already exists');
             $scope.directorName='';
            return true; //current string is in list

        }

        if ($scope.directorarray.length == $scope.Partner.nodirector) {
            alert( 'Director count reached the maximum value');
            $scope.directorName='';
            return true;
        }


        if ( $scope.Partner.nodirector < $scope.directorarray.length ) {
            alert( 'Invalid Director/Partner count');
            $scope.Partner.nodirector= $scope.directorarray.length;
            $scope.directorName='';
            return true;

        }

        $scope.directorarray.push($scope.directorName);
        //alert($scope.directorarray.length)

        $scope.directorName='';
        //$scope.endloading();


    };

     // datepart: 'y', 'm', 'w', 'd', 'h', 'n', 's'
    Date.dateDiff = function(datepart, fromdate, todate)
     {

            datepart = datepart.toLowerCase();
            var diff = todate - fromdate;
            var divideBy = { w:604800000,
                   d:86400000,
                   h:3600000,
                   n:60000,
                   s:1000
            };

        return Math.floor( diff/divideBy[datepart]);
    }

    $scope.save = function(Partner) {
    if(Partner.activecontractype=="Yes"){
    $scope.Partner.reasonfornocontract="";
    }else{
    $scope.Partner.reasonfornocontract=Partner.reasonfornocontract;
    }
        //alert(JSON.stringify(add))
        if ($scope.directorarray.length != $scope.Partner.nodirector) {
            alert( 'Check The Direct Count and Name ');
            return false;
        }
        if(Partner.activecontractype=="No"){
        $scope.contract_no=true;
        if(Partner.reasonfornocontract=="" || Partner.reasonfornocontract==undefined){
        alert("Please Enter No Contract Reason")
         return false;
        }
    }

        if (Partner.partnername == undefined) {
            alert('Plesae Enter Partner Name')
            return false;
        }
        if (Partner.custcategorygid == undefined){
         alert('Please Select Customer Category')
            return false;
        }
        if (Partner.partnergroup == undefined){
         alert('Please Select Partner Group')
            return false;
        }
        if (Partner.classification == undefined){
         alert('Please Select Partner Classification')
            return false;
        }
        if (Partner.partnertype == undefined){
         alert('Please Select Partner Type')
            return false;
        }
        if (Partner.activecontractype == undefined){
         alert('Please Select Partner Contract')
            return false;
        }
        if (Partner.organizationtype == undefined){
         alert('Please Select Organization Type')
            return false;
        }
        if ($scope.selectedemp == undefined){
         alert('Please Select RM Name')
            return false;
        }
        if (Partner.partner_renewaldate == undefined){
         alert('Please Select Renewal Date')
            return false;
        }
        if (Partner.approxspend == undefined){
         alert('Please Enter Approximate Spend')
            return false;
        }
        if (Partner.actualspend == undefined){
         alert('Please Enter Actual Spend')
            return false;
        }
        if (Partner.nodirector == undefined){
         alert('Please Enter Number Of Directer')
            return false;
        }


<!--        $scope.daysdifference=(Date.dateDiff('d', Partner.contractfrom, Partner.contractto));-->
<!--        if ($scope.daysdifference<= 365)-->
<!--        {-->
<!--            alert($scope.daysdifference + ' days.Days between contract from date and to date should be 365 days');-->
<!--            return false;-->
<!--        }-->

        var data = {
            "Params": {
                "Partner_Code": Partner.partnercode,
                "Partner_Name": Partner.partnername,
                "Partner_Compregno": Partner.companyregno,
                "Partner_Custcategorygid": Partner.custcategorygid,
                "Partner_Classification": Partner.classification,
                "Partner_Type": Partner.partnertype,
                "Partner_Group": Partner.partnergroup,
                "Partner_Web": Partner.website,
                "Partner_Reason_No_Contract":  $scope.Partner.reasonfornocontract,
                "Partner_Activecontract": Partner.activecontractype,
                "Partner_Contractdatefrom": Partner.contractfrom,
                "Partner_Contractdateto": Partner.contractto,
                "Partner_Aproxspend": Partner.approxspend,
                "Partner_Actualspend": Partner.actualspend,
                "Partner_Orgtype": Partner.organizationtype,
                "Partner_Remarks": Partner.remarks,
                "Partner_Panno": Partner.partnerpan,
                "Partner_Noofdir": Partner.nodirector,
                "Partner_Status": "DRAFT",
                "Partner_Renewdate": Partner.partner_renewaldate,
                "Partner_Rmname": $scope.selectedemp.employee_gid,
                "Partner_Gid": $scope.partner_gid,
                "Create_By": $scope.create_by,
            },
            "Classification": {
                "DirectorName": $scope.directorarray,
                "Entity_Gid": $scope.entity_gid,
                "Update_By":detail.employee_gid,
            },
        }
        var total = {
            Group: 'Header Details',
            Action:$scope.update ,
            Type: 'Header Details',
            data: data
        }
        $scope.loading();
        var set_header = Servicedrctsale.partnerheader_set(total)
        set_header.then(function(result) {
                $scope.header = [];
                $scope.header = result.data.MESSAGE;
                //alert(JSON.stringify($scope.header));

                if (result.data.MESSAGE == 'SUCCESS') {
                $scope.partner_gid =result.data.DATA;
                $scope.partner_rm_gid =result.data.RM_GID;
                $scope.Partner.partnercode =result.data.p_code;
                alert("Partner Code :" + $scope.Partner.partnercode);
                alert("SUCCESSFULLY INSERTED");
                $scope.pacode=true;
                getpaymode();
                gettaxdetails();
                fn_getattachmentsummary();
                loadActivityData();
                $scope.hidetabs=false;
                //alert(JSON.stringify( $scope.hidetabs));
                //$window.location.href = 'ATMA_PartnerSummary';
                }else{
                alert($scope.header);
                }
            }),
            function(err) {
                alert('no data');
            }.finally($scope.endloading());
    }

    $scope.movetoRM=function(){

        var data={
            "Params":{
                "Filter":{
                    "Partner_Gid":$scope.partner_gid,
                    "Partner_Status":"PENDING-RM",
                    "Remarks":$scope.rmremarks,
                },
                "Classification":{
                    "Create_By": $scope.create_by,
                    "Entity_Gid": $scope.entity_gid,
                },
                "Group":"MoveToRM",
                "Action":"Draft_To_Pending_Insert",
            }
        }
        var moverm_approval=Servicedrctsale.partnerheader_set(data)
        moverm_approval.then(function(result){
            $scope.movermdata=result.data;
            $scope.movermdatas=result.data.MESSAGE;
            if($scope.movermdatas=="SUCCESS"){
            alert("Data Moved To RM");
            $window.location.href = 'ATMA_PartnerSummary'

            }else{
            alert(JSON.stringify($scope.movermdata))
            }


        })

    }

    function gotopartner(query) {
        var result = $filter('filter')($scope.partner1, {
            'metadata_gid': query
        });
        return result;
    }

    Partner_partnergroup();

    function Partner_partnergroup() {
        var dat = {
            "Table_name": "gal_mst_tmetadata",
            "Column_1": "metadata_gid,metadata_value",
            "Column_2": "",
            "Where_Common": "metadata",
            "Where_Primary": "columnname",
            "Primary_Value": "partner_group",
            "Order_by": "value"
        }
        var partnergroup = {
            Action: "",
            Entity_Gid: $scope.entity_gid,
            data: dat
        }
        $scope.partnergroup = [];
        var getpartnergroup = Servicedrctsale.getpartnergroupdata(partnergroup)
        getpartnergroup.then(function(result) {
            $scope.partnergroup = result.data.DATA;
            //alert(JSON.stringify($scope.partnerpaymode))
        }, function(err) {
            alert('No data!.');
        }).finally();
    }

    var dat = {
        "Table_name": "gal_mst_tmetadata",
        "Column_1": "metadata_gid,metadata_value",
        "Column_2": "",
        "Where_Common": "metadata",
        "Where_Primary": "columnname",
        "Primary_Value": "partner_type",
        "Order_by": "value"
    }

    var ppartner = {
        Action: "",
        Entity_Gid: $scope.entity_gid,
        data: dat
    }

    //$scope.Partner = [];
    var getpartner = Servicedrctsale.getpartnertype(ppartner)
    getpartner.then(function(result) {
        $scope.partner = result.data.DATA;
    }, function(err) {
        alert('No data!.');
    }).finally();

    function gotoorgpartner(query) {
        var result = $filter('filter')($scope.organizationtype, {
            'partner_gid': query
        });
        return result;
    }
    var dat = {
        "Table_name": "gal_mst_tmetadata",
        "Column_1": "metadata_gid,metadata_value",
        "Column_2": "",
        "Where_Common": "metadata",
        "Where_Primary": "columnname",
        "Primary_Value": "partner_orgtype",
        "Order_by": "value"
    }
    var opartner = {
        Action: "",
        Entity_Gid: $scope.entity_gid,
        data: dat
    }
    $scope.organizationtype = [];
    var getorgpartner = Servicedrctsale.getorgpartnerdata(opartner)
    getorgpartner.then(function(result) {
        if ($scope.parttype) {
            $scope.petype = $scope.parttype.metadata_value;
        } else {
            $scope.petype = '';
        }

        $scope.organizationtype = result.data.DATA;
    }, function(err) {
        alert('No data!.');
    }).finally();

    function gotopartnerclassification(query) {
        var result = $filter('filter')($scope.partnerclassification, {
            'partner_gid': query
        });
        return result;
    }
    var dat = {
        "Table_name": "gal_mst_tmetadata",
        "Column_1": "metadata_gid,metadata_value",
        "Column_2": "",
        "Where_Common": "metadata",
        "Where_Primary": "columnname",
        "Primary_Value": "partner_Classification",
        "Order_by": "value"
    }
    var ppartnerclassification = {
        Action: "",
        Entity_Gid: $scope.entity_gid,
        data: dat
    }

    $scope.partnerclassification = [];
    var getpartnerclassification = Servicedrctsale.getpartnerclassificationdata(ppartnerclassification)
    getpartnerclassification.then(function(result) {
        $scope.partnerclassification = result.data.DATA;
    }, function(err) {
        alert('No data!.');
    }).finally();

    $scope.changepartnertype=function()
    {

        //alert('HAi');
         if ( $scope.Partner.classification=='One Time' )
         {$scope.Partner.partnertype='NA';$scope.editdisabledPartnertype=true;}
         else
         {$scope.editdisabledPartnertype=false;}
    }

    function fn_activitybranchdetails(query) {
        var result = $filter('filter')($scope.act_partnerbranch_name, {
            'partnerbranch_name': query
        });
        return result;
    }

    function fn_rmdetails(query) {
        var result = $filter('filter')($scope.executivename, {
            'employee_name': query
        });
        return result;
    }

    function gotopartne_activity(query) {
        var result = $filter('filter')($scope.executivename_activity, {
            'metadata_gid': query
        });
        return result;
    }

    activity_branchname();
    function activity_branchname(){
        debugger;
        var datan = {
            "Table_name": "atma_tmp_mst_tpartnerbranch",
            "Column_1": "partnerbranch_gid,partnerbranch_name,partnerbranch_code",
            "Column_2": "",
            "Where_Common": "partnerbranch",
            "Where_Primary": "",
            "Primary_Value": "",
            "Order_by": "name"
                   }

        var trans = {
            Action: "",
            Entity_Gid: $scope.entity,
            data: datan
                    }

        var getactivitybranch = Servicedrctsale.getbranchactivity(trans)
        getactivitybranch.then(function(result) {
        $scope.act_partnerbranch_name = result.data.DATA;

    }, function(err) {
        alert('No data!.');
    }).finally();

    }


    activity_rmname();
    function activity_rmname(){
        var datan = {
            "Table_name": "gal_mst_temployee",
            "Column_1": "employee_gid,employee_name,employee_code",
            "Column_2": "",
            "Where_Common": "employee",
            "Where_Primary": "employee_gid",
            "Primary_Value": "",
            "Order_by": "name"
                   }

        var trans = {
            Action: "",
            Entity_Gid: $scope.entity,
            data: datan
                    }

        $scope.executivename = [];
        var getactivityemployee = Servicedrctsale.getrmactivity(trans)
        getactivityemployee.then(function(result) {
        $scope.executivename_activity = result.data.DATA;
        //alert(JSON.stringify($scope.executivename_activity));
        $scope.executivename_activity.forEach(function(v)
        {
            v.employee_name=v.employee_name+"-"+v.employee_code;
        });
        //alert(JSON.stringify( $scope.executivename[0]))
    }, function(err) {
        alert('No data!.');
    }).finally();

    }

    var datan = {
        "Table_name": "gal_mst_temployee",
        "Column_1": "employee_gid,employee_name,employee_code",
        "Column_2": "",
        "Where_Common": "employee",
        "Where_Primary": "employee_gid",
        "Primary_Value": "",
        "Order_by": "name"
    }

    var trans = {
        Action: "",
        Entity_Gid: $scope.entity,
        data: datan
    }

    $scope.executivename = [];
    var getemployee = Servicedrctsale.getprodt(trans)
    getemployee.then(function(result) {

        $scope.executivename = result.data.DATA;
        $scope.executivename.forEach(function(v)
        {
            v.employee_name=v.employee_name+"-"+v.employee_code;
        });
        //alert(JSON.stringify( $scope.executivename[0]))
    }, function(err) {
        alert('No data!.');
    }).finally();

    function gotopartnercustcat(query) {
        var result = $filter('filter')($scope.partnercustcategory, {
            'metadata_gid': query
        });
        return result;
    }

    var dat = {
        "Table_name": "gal_mst_tcustcategory",
        "Column_1": "custcategory_gid,custcategory_name",
        "Column_2": "",
        "Where_Common": "custcategory",
        "Where_Primary": "custcategory_gid",
        "Primary_Value": "",
        "Order_by": "name"
    }
    var ppartnercustcat = {
        Action: "",
        Entity_Gid: $scope.entity_gid,
        data: dat
    }

    $scope.partnercustcategory = [];
    var getpartnercustcat = Servicedrctsale.getpartnercustcatdata(ppartnercustcat)
    getpartnercustcat.then(function(result) {
        $scope.partnercustcategory = result.data.DATA;
    }, function(err) {
        alert('No data!.');
    }).finally();


     //PAYMENTSTART

    function paymodename(module) {
        var result = $filter('filter')($scope.partnerpaymode, {
            'Paymode_name': module
        });
        return result;
    }
    paymodeget();

    function paymodeget() {
        var paymode = {
            "Table_name": "gal_mst_tpaymode",
            "Column_1": "paymode_gid,paymode_code,Paymode_name",
            "Column_2": "",
            "Where_Common": "paymode",
            "Where_Primary": "paymode_gid",
            "Primary_Value": "",
            "Order_by": "code"
        }
        var paymodeval = {
            Action: "",
            Entity_Gid: $scope.entity_gid,
            data: paymode
        }
        $scope.partnerpaymode = [];
        var getpymodeval = Servicedrctsale.getpaymodedata(paymodeval)
        getpymodeval.then(function(result) {
            $scope.partnerpaymode = result.data.DATA;
            //alert(JSON.stringify($scope.partnerpaymode))
        }, function(err) {
            alert('No data!.');
        }).finally();
    }
    function fn_paymentpartnerbranchdetails(query) {
        var result = $filter('filter')($scope.payment_partnerbranch_name, {
            'partnerbranch_name': query
        });
        return result;
    }
    function bankgid(query) {
        var result = $filter('filter')($scope.partnerbank, {
            'bank_name': query
        });
        return result;
    }

    payment_partnerbranchname();
    function payment_partnerbranchname(){
        debugger;
        var datan = {
            "Table_name": "atma_tmp_mst_tpartnerbranch",
            "Column_1": "partnerbranch_gid,partnerbranch_name,partnerbranch_code",
            "Column_2": "",
            "Where_Common": "partnerbranch",
            "Where_Primary": "",
            "Primary_Value": "",
            "Order_by": "name"
                   }

        var trans = {
            Action: "",
            Entity_Gid: $scope.entity,
            data: datan
                    }

        var getpaymentpartnerbranch = Servicedrctsale.getbranch_paymentpartner(trans)
        getpaymentpartnerbranch.then(function(result) {
        $scope.payment_partnerbranch_name = result.data.DATA;

    }, function(err) {
        alert('No data!.');
    }).finally();

    }


    bankname();
    function bankname() {
        var bank = {
            "Table_name": "gal_mst_tbank",
            "Column_1": "bank_gid,bank_code,bank_name",
            "Column_2": "",
            "Where_Common": "bank",
            "Where_Primary": "bank_gid",
            "Primary_Value": "",
            "Order_by": "name"
        }
        var bankval = {
            Action: "",
            Entity_Gid: $scope.entity_gid,
            data: bank
        }
        $scope.partnerbank = [];
        var getbankval = Servicedrctsale.getbankdata(bankval)
        getbankval.then(function(result) {
            $scope.partnerbank = result.data.DATA;
            //alert(JSON.stringify($scope.partnerbank))
        }, function(err) {
            alert('No data!.');
        }).finally();
    }
    $scope.partnerbank = [];
    $scope.searchDetails = function() {

     getpaymode();
<!--    $scope.search_accno=s.accno;-->
<!--    $scope.search_bname=s.beneficiaryname;-->
<!--    $scope.search_ifsc=s.ngmifsc;-->
<!--    $scope.search_acctype=s.payacctype.metadata_value;-->

    }
    $scope.addpaymentpagepopup = function() {

        $scope.paymode_cheque=true;
        $scope.hidebank=false;
		$scope.addpay = true;
		$scope.editpay = false;
		$scope.pay.paymode_paymodedata="";
		$scope.pay.bank_paymodedata="";
		$scope.pay.bankbranch_paymodedata="";
		$scope.pay.acctype_paymodedata="";
		$scope.pay.accnumber_paymodedata="";
		$scope.pay.bname_paymodedata="";
		$scope.pay.paymentremarks="";
		    payment_partnerbranchname();
			modalshow('mdl_present');
		}

		$scope.ngpamodetype=function(e){

		if(e==undefined){
            getpaymode();
		}
		$scope.payment_paymode=e.paymode_gid;
		$scope.payment_paymode_name=e.Paymode_name;
        $scope.alldetails = $filter('filter')($scope.payment_search , {
               "Paymode_name": $scope.payment_paymode_name

        });
		}
		$scope.searchngbank=function(e){

		 if(e.ngbankw != undefined && e.ngbankw != null && e.ngbankw !='' )
        {
        var paytemp2=e.ngbankw.bank_name;
       $scope.paytemp21=e.ngbankw.bank_name;
        }
    else
        {
        var paytemp2='';
        $scope.paytemp21='';
        }

        $scope.paysearch.ngbranchw='';
        $scope.paybank = e.ngbankw.bank_gid;

       $scope.bid = e.bank_gid;
       var paymode = {
           "Table_name": "gal_mst_tbankbranch",
           "Column_1": "bankbranch_gid,bankbranch_name",
           "Column_2": "",
           "Where_Common": "bankbranch",
           "Where_Primary": "bank_gid",
           "Primary_Value": $scope.paybank,
           "Order_by": "name"
       }
       var paymodeval = {
           Action: "",
           Entity_Gid: $scope.entity_gid,
           data: paymode
       }
       $scope.partnerpaymodebranch = [];
       var getpymodebranchval = Servicedrctsale.getpaymodebranchdata(paymodeval)
       getpymodebranchval.then(function(result) {
           $scope.partnerpaymodebranch = result.data.DATA;
           //alert(JSON.stringify($scope.partnerpaymodebranch))
       }, function(err) {
           alert('No data!.');
       }).finally();



        $scope.payment_alldetails = $filter('filter')($scope.payment_search , {
               "bank_name": paytemp2 == null || paytemp2 == undefined || paytemp2 == '' ? '' : paytemp2

        });

   }

$scope.paysearch = [];
		getpaymode();

    function getpaymode() {

        if ($scope.payment_paymode){
            $scope.payname = $scope.payment_paymode;
        } else {
            $scope.payname = '';
        }
        if ($scope.paybank) {
            $scope.paybank = $scope.paybank;
        } else {
            $scope.paybank = '';
        }
        if ($scope.paysearch.ngbranchw) {
            $scope.pay_branch = $scope.paysearch.ngbranchw.bankbranch_gid;
        } else {
            $scope.pay_branch = '';
        }
        if ($scope.paysearch.ngmifsc) {
            $scope.pay_ifsc = $scope.paysearch.ngmifsc;
        }
        else{
        $scope.pay_ifsc = "";
        }
        if ($scope.paysearch.payacctype) {
            $scope.pay_type = $scope.paysearch.payacctype.metadata_value;
        } else {
            $scope.pay_type = '';
        }
        if ($scope.paysearch.accno) {
            $scope.pay_accno = $scope.paysearch.accno;
        } else {
            $scope.pay_accno = '';
        }
        if ($scope.paysearch.beneficiaryname) {
            $scope.pay_beneficiaryname = $scope.paysearch.beneficiaryname;
        } else {
            $scope.pay_beneficiaryname = '';
        }

        var data = {
            "Params": {
                "Filter": {
                    "Paymode_Gid": $scope.payname,
                    "Payment_Partnergid": $scope.partner_gid,
                    "Bank_Gid": $scope.paybank,
                    "Bankbranch_Gid": $scope.pay_branch,
                    "Bankbranch_Ifsccode": $scope.pay_ifsc,
                    "Payment_Acctype": $scope.pay_type,
                    "Payment_Accnumber": $scope.pay_accno,
                    "Payment_Benificiaryname": $scope.pay_beneficiaryname,
                    "Mst_Table": $scope.msttable,
                },
                "Classification": {
                    Entity_Gid: $scope.entity_gid,
                },
                "Group": "ATMAPAYMENTSUMMARY",
                "Action": "Payment_Get",

            }
        }
        var get_data = Servicedrctsale.get_atmapayment(data)
        get_data.then(function(result) {

            $scope.payment_alldetails = result.data.DATA;
            $scope.payment_search=$scope.payment_alldetails
            //console.log($scope.alldetails)
            //alert(JSON.stringify($scope.payment_alldetails))
        })

    }

    $scope.change_payment=function(a){

        if(a.payacctype != undefined && a.payacctype != null && a.payacctype !='' )
        {
        var paytemp4=a.payacctype.metadata_value;
        }
    else
        {
        var paytemp4='';
        }
        if(a.ngbranchw != undefined && a.ngbranchw != null && a.ngbranchw !='' )
        {
        var paytemp3=a.ngbranchw.bankbranch_name;
        }
    else
        {
        var paytemp3='';
        }
        if(a.Paymode_name != undefined && a.Paymode_name != null && a.Paymode_name !='' )
        {
        var paytemp1=a.Paymode_name.Paymode_name;
        }
    else
        {
        var paytemp1='';
        }
        $scope.payment_alldetails = $filter('filter')($scope.payment_search , {
               "bankbranch_ifsccode": a.ngmifsc == null ||  a.ngmifsc == undefined ||  a.ngmifsc == '' ? '' :  a.ngmifsc,
               "payment_accnumber": a.accno == null ||  a.accno == undefined ||  a.accno == '' ? '' :  a.accno,
               "payment_benificiaryname": a.beneficiaryname == null || a.beneficiaryname == undefined || a.beneficiaryname == '' ? '' : a.beneficiaryname ,
               "Paymode_name": paytemp1 == null || paytemp1 == undefined || paytemp1 == '' ? '' : paytemp1 ,
               "bankbranch_name": paytemp3 == null || paytemp3 == undefined || paytemp3 == '' ? '' : paytemp3 ,
               "payment_acctype": paytemp4 == null || paytemp4 == undefined || paytemp4 == '' ? '' : paytemp4 ,
               "bank_name": $scope.paytemp21 == null || $scope.paytemp21 == undefined || $scope.paytemp21 == '' ? '' : $scope.paytemp21 ,

        });
    }

    function bankbranchnames(module) {
        var result = $filter('filter')($scope.branchdetails, {
            'bankbranch_name': module

        });
        return result;
    }
    $scope.ngbank = function(e) {

        if(e == undefined)
        {
       $scope.pay.bankbranch_paymodedata='';
        }
       $scope.bid = e.bank_gid;
       var paymode = {
           "Table_name": "gal_mst_tbankbranch",
           "Column_1": "bankbranch_gid,bankbranch_name",
           "Column_2": "",
           "Where_Common": "bankbranch",
           "Where_Primary": "bank_gid",
           "Primary_Value": $scope.bid,
           "Order_by": "name"
       }
       var paymodeval = {
           Action: "",
           Entity_Gid: $scope.entity_gid,
           data: paymode
       }
       $scope.partnerpaymodebranch = [];
       var getpymodebranchval = Servicedrctsale.getpaymodebranchdata(paymodeval)
       getpymodebranchval.then(function(result) {
           $scope.partnerpaymodebranch = result.data.DATA;
           if($scope.partnerpaymodebranch==undefined){
           alert("No Branch Details")
           }
           //alert(JSON.stringify($scope.partnerpaymodebranch))
       }, function(err) {
           alert('No data!.');
       }).finally();
   }

   bankbranchgid();
   function bankbranchgid(query) {
       var result = $filter('filter')($scope.partnerpaymodebranch, {
           'bankbranch_name': query
       });
       return result;
   }
   $scope.branch_name = bankbranchgid;

   $scope.payngbank = function(e) {
        $scope.bid = e.bank_gid;
        var data = {
            "Params": {
                "Type": "BranchGet",
                "bank_gid": $scope.bid,
            }
        }
        $scope.branchdetails=[];
        var getbranchdata = Servicedrctsale.getbranchdetails(data)
        getbranchdata.then(function(result) {
            $scope.branchdetails = result.data;
            //alert(JSON.stringify($scope.branchdetails))
        })
    }
 $scope.branchdetails=[];
    function gotopartneracctype(query) {
        var result = $filter('filter')($scope.acctype, {
            'metadata_value': query
        });
        return result;
    }

    paymentaccounttype();

    function paymentaccounttype() {
        var dat = {
            "Table_name": "gal_mst_tmetadata",
            "Column_1": "metadata_gid,metadata_value",
            "Column_2": "",
            "Where_Common": "metadata",
            "Where_Primary": "columnname",
            "Primary_Value": "payment_acctype",
            "Order_by": "value"
        }
        var paymentaccount_type = {
            Action: "",
            Entity_Gid: $scope.entity_gid,
            data: dat
        }
        var getpaymentacctype = Servicedrctsale.getaccounttypedata(paymentaccount_type)
        getpaymentacctype.then(function(result) {
                $scope.acctype = result.data.DATA;
                //alert(JSON.stringify( $scope.acctype))
            },
            function(err) {
                alert('No data!.');
            }).finally();
    }

    $scope.payngpamodetype = function(e) {

    $scope.payid = e.paymode_gid;

     if(e == "CHEQUE"){
    $scope.paymode_cheque = false;
    $scope.bid=0;
    $scope.bbranchgid=0;
    $scope.payment_acctype=0;
    $scope.pay.accnumber_paymodedata=0;
    }
    else if(e.Paymode_name != "CHEQUE"){
    $scope.paymode_cheque = true;
    }
    else if(e.Paymode_name == "CHEQUE"){
    $scope.bid=0;
    $scope.bbranchgid=0;
    $scope.payment_acctype=0;
    $scope.pay.accnumber_paymodedata=0;
    $scope.paymode_cheque = false;
    }
    else if(e != "CHEQUE"){
    $scope.paymode_cheque = true;
    }
    else{
    $scope.paymode_cheque = false;
    }

<!--            $scope.paymode_name=e.Paymode_name;-->
<!--        $scope.payid = e.paymode_gid-->
<!--        if(e.Paymode_name=="CHEQUE"){-->
<!--        $scope.paymode_cheque=false;-->
<!--         $scope.bid=0;-->
<!--         $scope.bbranchgid=0;-->
<!--        }-->
<!--        if(e.Paymode_name != "CHEQUE"){-->
<!--        $scope.hidebank=false;-->
<!--        $scope.paymode_cheque=true;-->
<!--        }-->
    }

    $scope.payngbranch1 = function(e) {
        $scope.bbranchgid = e.bankbranch_gid
    }
    $scope.addpayment = function(r) {
  
    if(r.paymode_paymodedata.Paymode_name=="CHEQUE"){
    $scope.acc_paymode=0;
    $scope.pay_acc_num=0;
    }else{
     $scope.acc_paymode=r.acctype_paymodedata.metadata_value;
     $scope.pay_acc_num=r.accnumber_paymodedata;
    }
    if(r.paymode_paymodedata.Paymode_name!="CHEQUE"){
    if($scope.bbranchgid==0){
    alert("Plese Select Bank Branch Name")
    return false;
    }
    }
        debugger;
        var data =
        {
            "Params": {
                    "Filter": {
                    "Payment_Partner_Gid": $scope.partner_gid,
                    "Payment_Paymodegid":$scope.payid,
                    "Payment_Partnerbranchgid":r.branch.partnerbranch_gid,
                    "Payment_Bankgid":$scope.bid,
                    "Payment_Bankbranchgid": $scope.bbranchgid,
                    "Payment_Acctype":$scope.acc_paymode,
                    "Payment_Accnumber":$scope.pay_acc_num,
                    "Payment_Benificiaryname":r.bname_paymodedata,
                    "Payment_Remarks":r.paymentremarks,
                    "Create_By": $scope.create_by
                     },
                     "Classification":{
                    "Entity_Gid": $scope.entity_gid
                     },
            "Group": "PAYMODESUMMARY",
            "Action": "INSERT",
                    }
        }
        $scope.loading();
        var get_data = Servicedrctsale.Paymentaddheader(data)
        get_data.then(function(result) {
        //alert(JSON.stringify(result.data));
            if (result.data == "SUCCESS") {
                alert("Inserted successfully!.");
                getpaymode();
                $scope.pngpaymode = "",
                    $scope.pay.paymode_paymodedata = "",
                    $scope.pay.bank_paymodedata = "",
                    $scope.pay.bankbranch_paymodedata = "",
                    $scope.pay.acctype_paymodedata = "",
                    $scope.pay.accnumber_paymodedata = "",
                    $scope.pay.bname_paymodedata = "",
                    $scope.pay.paymentremarks = "",
                    modalhide('mdl_present');
            } else {
                alert(result.data);
            }

   }),
            function(err) {
                alert('no data');
            }.finally($scope.endloading());

}

    $scope.closedetail = function() {
        $scope.pngpaymode = "";
        $scope.pngbankw = "";
        $scope.pngbranchw = "";
        $scope.ppayacctype = "";
        $scope.ppayaccno = "";
        $scope.ppaybeneficiaryname = "";
        $scope.ppayremarks = "";
    }

    $rootScope.showview = function(ev) {
        $scope.loading();
        modalshow('atma_paymentview_page')
        $scope.paymodepop = ev.Paymode_name
        $scope.bankpop = ev.bank_name
        $scope.branchpop = ev.bankbranch_name
        $scope.ifscpop = ev.bankbranch_ifsccode
        $scope.acctpop = ev.payment_acctype
        $scope.accnpop = ev.payment_accnumber
        $scope.benipop = ev.payment_benificiaryname
        $scope.endloading();
    }
$scope.addpay = true;
$scope.pay=[];

    $scope.paymentedit_data=function(payment){
    debugger;
    $scope.paymode_cheque=false;
    if(payment.Paymode_name=="CHEQUE"){
    $scope.paymode_cheque=false;
    $scope.paymode_readonly=false;
   }
   else{
    $scope.paymode_cheque=true;
    $scope.paymode_readonly=false;
   }
    $scope.payeditid=payment.payment_gid,
    $scope.pay.paymode_paymodedata=payment.Paymode_name,
    $scope.pay.bank_paymodedata=payment.bank_name,
    $scope.pay.bankbranch_paymodedata=payment.bankbranch_name,
    $scope.pay.branch=payment.partnerbranch_name,
    $scope.pay.acctype_paymodedata=payment.payment_acctype,
    $scope.pay.accnumber_paymodedata=payment.payment_accnumber,
    $scope.pay.bname_paymodedata=payment.payment_benificiaryname,
    $scope.pay.paymentremarks=payment.payment_remarks,
    modalshow('mdl_present')
    $scope.addpay = false;
    $scope.editpay = true;
    }
    $scope.view_paymentdetails=function(payment){

    $scope.paymode_cheque=false;
    if(payment.Paymode_name=="CHEQUE"){
    $scope.paymode_cheque=false;
   }
   if(payment.Paymode_name=="NEFT"){
    $scope.paymode_cheque=true;
   }
    $scope.payeditid=payment.payment_gid,
    $scope.pay.paymode_paymodedata=payment.Paymode_name,
    $scope.pay.bank_paymodedata=payment.bank_name,
    $scope.pay.bankbranch_paymodedata=payment.bankbranch_name,
    $scope.pay.acctype_paymodedata=payment.payment_acctype,
    $scope.pay.accnumber_paymodedata=payment.payment_accnumber,
    $scope.pay.bname_paymodedata=payment.payment_benificiaryname,
    $scope.pay.paymentremarks=payment.payment_remarks,
    modalshow('mdl_present')
    $scope.addpay = false;
    $scope.editpay = false;
    }
    $scope.updatepayment=function(e){

   if(e.paymode_paymodedata.Paymode_name ==	"CHEQUE"){
    $scope.payment_acctype=0;
    }else{
    $scope.payment_acctype=e.acctype_paymodedata.metadata_value;
    }
    if(e.paymode_paymodedata == "CHEQUE"){
    $scope.payment_acctype=0;
    }


    if(e.bank_paymodedata==null){
    $scope.bkid=0;
    }else{
    $scope.bkid=$scope.bid;
    }
    if(e.bankbranch_paymodedata==null){
    $scope.bkbranchgid=0;
    }else{
    $scope.bkbranchgid=$scope.bbranchgid;
    }

    var data =
        {
            "Params": {
                    "Filter": {
                    "Payment_Gid": $scope.payeditid,
                    "Payment_Partner_Gid": $scope.partner_gid,
                    "Payment_Partnerbranchgid":e.branch.partnerbranch_gid,
                    "Payment_Paymodegid": $scope.payid,
                    "Payment_Bankgid": $scope.bkid,
                    "Payment_Bankbranchgid": $scope.bkbranchgid,
                    "Payment_Acctype":$scope.payment_acctype,
                    "Payment_Accnumber": $scope.pay.accnumber_paymodedata,
                    "Payment_Benificiaryname": $scope.pay.bname_paymodedata,
                    "Payment_Remarks": $scope.pay.paymentremarks,

                     },
                     "Classification":{
                    "Entity_Gid": $scope.create_by
                     },
            "Group": "UPDATEPAYMODESUMMARY",
            "Action": "UPDATE",
                    }
        }
        $scope.loading();
        var get_data = Servicedrctsale.Paymentaddheader(data)
        get_data.then(function(result) {

            if (result.data == "SUCCESS") {
                alert("SUCCESSFULLY UPDATED!.");
                getpaymode();
                    modalhide('mdl_present');
            } else {
                alert("Data not Update")
            }
   }),
            function(err) {
                alert('no data');
            }.finally($scope.endloading());

}
    //PAYMENTEND

    //ATTACHMENTSTART

    DocumentGroup_dd();
    function DocumentGroup_dd()
    {
        var dat = {
            "Table_name": "atma_mst_tdocgroup",
            "Column_1": "docgroup_gid,docgroup_name",
            "Column_2": "",
            "Where_Common": "docgroup",
            "Where_Primary": "isparent",
            "Primary_Value": "Y",
            "Order_by": "name"
        }
        var pdoc = {
            Action: "",
            Entity_Gid: $scope.entity_gid,
            data: dat
        }
        $scope.documentgroup = [];
        var getdoc = Servicedrctsale.getdocdata(pdoc)
        getdoc.then(function(result) {
            $scope.documentgroup = result.data.DATA;
            //alert(JSON.stringify($scope.documentgroup));
        }, function(err) {
            alert('No data!.');
        }).finally();
    }

    $scope.dd_DocumentGroup = fn_DocumentGroup;

    function fn_DocumentGroup(query) {
        var result = $filter('filter')($scope.documentgroup, {
            'docgroup_name': query
        });
        return result;
    }

    function gotodocname1(query) {
        var result = $filter('filter')($scope.docname, {
            'docgroup_name': query
        });
        return result;
    }

    $scope.addngdocgrop = function(e)
    {
    if(e == undefined)
        {

       $scope.Attachment.Document_Name='';
       $scope.Attachment.selectedItem_documentnamee='';
       $scope.Attachment.selectedItem_documentname='';
        }
        $scope.dgid = e.docgroup_gid;
        var dat = {
            "Table_name": "atma_mst_tdocgroup",
            "Column_1": "docgroup_gid,docgroup_name,docgroup_parentgid",
            "Column_2": "",
            "Where_Common": "docgroup",
            "Where_Primary": "parentgid",
            "Primary_Value": $scope.dgid,
            "Order_by": "name"
        }
        var pdocname = {
            Action: "",
            Entity_Gid: $scope.entity_gid,
            data: dat
        }
        $scope.docname = [];
        var getdocname = Servicedrctsale.getdocnamedata(pdocname)
        getdocname.then(function(result) {
            $scope.docname = result.data.DATA;
            //alert(JSON.stringify($scope.docname))
        }, function(err) {
            alert('No data!.');
        }).finally();
    }


$scope.searchdocumentname=function(e){

if(e != undefined && e != null && e !='' )
        {
        var attachtemp1=e.docgroup_name;
       $scope.attachtemp121=e.docgroup_name;
        }
    else
        {
        var attachtemp1='';
        $scope.attachtemp121='';
        }
 $scope.getattachmentsummary=$filter('filter')($scope.searchgetattachmentsummary,{
    "Document_Name":  attachtemp1 == null || attachtemp1 == undefined || attachtemp1 == '' ? '' : attachtemp1 ,
    "docgroup_name":  $scope.atachs == null || $scope.atachs == undefined || $scope.atachs == '' ? '' : $scope.atachs ,

    })

}

    $scope.ngdocgrop = function(e)
    {

    if(e != undefined && e != null && e !='' )
        {
        var attachtemp=e.docgroup_name;
        $scope.atachs=e.docgroup_name;
        }
    else
        {
        var attachtemp='';
        $scope.atachs='';
        }


    if(e == undefined)
        {
       $scope.Attachment.Document_Name='';
       $scope.Attachment.selectedItem_documentnamee='';
       $scope.Attachment.selectedItem_documentname='';
        }
        $scope.dgid = e.docgroup_gid;
        var dat = {
            "Table_name": "atma_mst_tdocgroup",
            "Column_1": "docgroup_gid,docgroup_name,docgroup_parentgid",
            "Column_2": "",
            "Where_Common": "docgroup",
            "Where_Primary": "parentgid",
            "Primary_Value": $scope.dgid,
            "Order_by": "name"
        }
        var pdocname = {
            Action: "",
            Entity_Gid: $scope.entity_gid,
            data: dat
        }
        $scope.docname = [];
        var getdocname = Servicedrctsale.getdocnamedata(pdocname)
        getdocname.then(function(result) {
            $scope.docname = result.data.DATA;
            //alert(JSON.stringify($scope.docname))
        }, function(err) {
            alert('No data!.');
        }).finally();


        $scope.getattachmentsummary=$filter('filter')($scope.searchgetattachmentsummary,{
    "docgroup_name":  attachtemp == null || attachtemp == undefined || attachtemp == '' ? '' : attachtemp ,
     "Document_Name":  $scope.attachtemp121 == null || $scope.attachtemp121 == undefined || $scope.attachtemp121 == '' ? '' : $scope.attachtemp121 ,

    })
    }
     $scope.docname = [];

    function reconname_attachment(item) {
        var fileExtension = '.' + item.split('.').pop();
        $scope.recon_name = "ATTACH_" + new Date().getTime() + fileExtension;
    };

    $scope.Attachmentsave = function(Attachment){

    if($scope.Attachment.description == undefined){
    $scope.Attachment.descriptions="";
    }else{
    $scope.Attachment.descriptions=$scope.Attachment.description;
    }
        if ($scope.Attachment.file == undefined) {
            alert("Fill the File field!.");
            return false;
        }
        $scope.attachmentfilename = $scope.Attachment.file.name;
        if ($scope.Attachment.selectedItem_documentname) {
            $scope.DocumentGid = $scope.Attachment.selectedItem_documentname.docgroup_gid;
        } else {
            $scope.DocumentGid = '';
        }
        if ($scope.Attachment.file !== undefined) {
            var excl = new FormData();
            reconname_attachment($scope.attachmentfilename);
            excl.append('file', $scope.Attachment.file);
            excl.append('name', $scope.recon_name);
            excl.append('Group', 'Document_Group');
            excl.append('Action','Insert');
            excl.append('Type', 'Document_Group');
            excl.append('Documents_Partnergid', $scope.partner_gid);
            excl.append('Documents_Docgroupgid', $scope.DocumentGid);
            excl.append('Documents_Period', 'one time');
            excl.append('Description', $scope.Attachment.descriptions);
            excl.append('File_Name', $scope.recon_name);
            excl.append('File_Path', "home/bala");
            excl.append('Entity_Gid', $scope.entity_gid);
            excl.append('Create_By', $scope.create_by);
            loadexclAttacment(excl);
        }
    }
    function loadexclAttacment(excl)
    {

        $scope.loading();
        var overalldtl = Servicedrctsale.setdocgrp(excl);
        overalldtl.then(function(res) {
            var hosmr = [];
            $scope.hosmr = res.data.MESSAGE;
            if($scope.hosmr=="SUCCESSFULLY INSERTED"){
            alert("SUCCESSFULLY INSERTED");
            $scope.Attachment.selectedItem_documentgroup="",
            $scope.Attachment.selectedItem_documentname="",
            $scope.Attachment.description="",
            $scope.Attachment.file="",
            fn_getattachmentsummary();
            modalhide('attachmentAddPopup');
            }
            else{
             alert(JSON.stringify($scope.hosmr));
            }
        }).finally($scope.endloading);
    }
   $scope.Search_in_Attachment = function()
    {
        fn_getattachmentsummary();
    }

   fn_getattachmentsummary();

   function fn_getattachmentsummary()
   {


        if ($scope.Attachment.selectedItem_documentgroup) {
            $scope.DocgroupGid = $scope.Attachment.selectedItem_documentgroup.docgroup_gid;
        } else {
            $scope.DocgroupGid = '';
        }

        if ($scope.Attachment.selectedItem_documentname) {
            $scope.DocumentGid = $scope.Attachment.selectedItem_documentname.docgroup_gid;
        } else {
            $scope.DocumentGid = '';
        }

        var data = {
            "Params": {
                "Filter":   {
                    "Docgroup_Gid": $scope.DocgroupGid,
                    "Document_Gid": $scope.DocumentGid,
                    "Documents_Partnergid": $scope.partner_gid,
                    "Document_description":$scope.Attachment.description,
                    "Mst_Table": $scope.msttable,
                            },
                "Classification":   {
                    "Entity_Gid": "1"
                                    }
                    }
                    }
        var dtam = {
            Group: 'Document_Group',
            Type: 'Document_Get',
            data: data
        }

        var getattachmentsummary1 = Servicedrctsale.get_attachmentsummary(dtam)
        getattachmentsummary1.then(function(result)
        {
           $scope.getattachmentsummary = result.data.DATA;
           $scope.searchgetattachmentsummary = result.data.DATA;
           //alert(JSON.stringify( $scope.getattachmentsummary));
        }, function(err)
        {
           alert('No data!.');
        }).finally();
   }


$scope.shwpdf = false;
   //for pdf view
   $scope.showattachment = function(e){

    modalshow('viewpdfpopup');
   $scope.shwpdf = true;
   $scope.pdfurl = e.file_path;
   $scope.pdf_filename = e.file_name;

   }
   //$scope.shwpdfs = false;
   $scope.show_tax_pdfview = function(d){

    modalshow('tax_viewpdfpopup');
   //$scope.shwpdfs = true;
   $scope.pdfurls = d.file_path;
   $scope.pdf_filenames = d.file_name;

   }

   //attachment edit

   $scope.addbattchmentpopup=function(){
   $scope.showattachmentsubmit=true;
   $scope.showattachmetupdate=false;
   modalshow('attachmentAddPopup');

   }
    $scope.edit_attachment=function(e)
    {

      $scope.showattachmentsubmit=false;
   $scope.showattachmetupdate=true;
        $scope.docgid=e.documents_gid
        $scope.attachfile=false;
        $scope.Attachment.docgroup_name=e.docgroup_name,
        $scope.Attachment.Document_Name=e.Document_Name,
        $scope.Attachment.file_name=e.file_name,
        $scope.Attachment.documents_remarks=e.documents_remarks,
        $scope.documnet_filepath=e.file_path
    }
    $scope.attachfileupdate=function(){
        $scope.attachfile=true;
    }
    $scope.updateattachment=function(e){

        if(e.documents_remarks==undefined){
         $scope.Attachment.documents_remarke1="";
        }else{
         $scope.Attachment.documents_remarke1= $scope.Attachment.documents_remarks
        }
        if ($scope.Attachment.fileEdit !== undefined) {
            $scope.attachmentfilename = $scope.Attachment.fileEdit.name;
            var excl = new FormData();
            reconname_attachment($scope.attachmentfilename);
            excl.append('file', $scope.Attachment.fileEdit);
            excl.append('name', $scope.recon_name);
            excl.append('Group', 'Document_Update');
            excl.append('Action','UPDATE');
            excl.append('Type', 'Document_Group');
            excl.append('Documents_Gid', $scope.docgid );
            excl.append('Documents_Docgroupgid', $scope.DocumentGid);
            excl.append('Documents_Period', 'one time');
            excl.append('Description', $scope.Attachment.documents_remarke1);
            excl.append('File_Name', $scope.recon_name);
            excl.append('File_Path', " $scope.documnet_filepath");
            Attachment_Update(excl);
        }else{
                var excl = new FormData();
                $scope.attachmentfilename=$scope.Attachment.file_name;
                reconname_attachment($scope.attachmentfilename);
                excl.append('file','');
                excl.append('name', '');
                excl.append('Group', 'Document_Updatenofile');
                excl.append('Action','UPDATE');
                excl.append('Type', 'Document_Group');
                excl.append('Documents_Gid', $scope.docgid );
                excl.append('Documents_Docgroupgid', $scope.DocumentGid);
                excl.append('Documents_Period', 'one time');
                excl.append('Description', $scope.Attachment.documents_remarke1);
                excl.append('File_Name', $scope.Attachment.file_name);
                excl.append('File_Path', "$scope.documnet_filepath");
                Attachment_Update(excl);
        }

    }

	function Attachment_Update(excl) {
	 //modalhide('myModal')
			$scope.loading();
			var overalldtl = Servicedrctsale.updateattachmentdetails(excl);
			overalldtl.then(function(res) {
				var hosmr = [];
				$scope.hosmr = res.data;
				//alert(JSON.stringify( $scope.hosmr));
				if ($scope.hosmr == "SUCCESSFULLY UPDATED") {
					alert("SUCCESSFULLY UPDATED!.");
					fn_getattachmentsummary();
                      modalhide('myModal')
				} else {
					    alert($scope.hosmr);
                       // modalshow('myModal')
				}
			}).finally($scope.endloading);
		}

	$scope.ngdoc_name=function(e){


	}
	//ATTACHMENTEND

//TAXSTART
    tax_partnerbranchname();
    function tax_partnerbranchname(){
        debugger;
        var datan = {
            "Table_name": "atma_tmp_mst_tpartnerbranch",
            "Column_1": "partnerbranch_gid,partnerbranch_name,partnerbranch_code",
            "Column_2": "",
            "Where_Common": "partnerbranch",
            "Where_Primary": "",
            "Primary_Value": "",
            "Order_by": "name"
                   }

        var trans = {
            Action: "",
            Entity_Gid: $scope.entity,
            data: datan
                    }

        var gettaxpartnerbranch = Servicedrctsale.getbranch_taxpartner(trans)
        gettaxpartnerbranch.then(function(result) {
        $scope.tax_partnerbranch_name = result.data.DATA;

    }, function(err) {
        alert('No data!.');
    }).finally();

    }


    $scope.updatetaxdetailsmode=function(e){

    $scope.ad=$scope.add_tax.fdate;
    $scope.ads=$scope.add_tax.tdate;
    $scope.updatetax_fromdate = formatStringDate($scope.ad, 'yyyy-mm-dd');
    $scope.updatetax_todate = formatStringDate($scope.ads, 'yyyy-mm-dd');
    if($scope.add_tax.ngisexcem.metadata_value){
        $scope.isexcem=$scope.add_tax.ngisexcem.metadata_value
    }else{
        $scope.isexcem=$scope.add_tax.ngisexcem
    }
    if($scope.hg == undefined){
        $scope.add_tax.ngpsMSME="";
    }
   if($scope.add_tax.ngpsMSME.metadata_value){
        $scope.add_tax.ngpsMSME = $scope.add_tax.ngpsMSME.metadata_value
   }
   else{
        $scope.add_tax.ngpsMSME = $scope.add_tax.ngpsMSME
   }
   if( $scope.trgid){
        $scope.ngistaxrategid=$scope.trgid;
   }else{
        $scope.ngistaxrategid=$scope.add_tax.ngistaxrategid;
   }
   if(  $scope.trat){
        $scope.ngistaxrate=  $scope.trat;
   }else{
        $scope.ngistaxrate=$scope.add_tax.ngistaxrate;
   }
   if( $scope.tgd){
        $scope.tax_gids= $scope.tgd;
    }else{
        $scope.tax_gids= $scope.tax_gid;
    }
  if( $scope.isexcem=="NO"){
        var excl = new FormData();
            $scope.name="";
            reconname($scope.name);
            excl.append('file',$scope.add_tax.file);
            excl.append('name', '');
            excl.append('Group', 'TAXINSERTSUMMARYEXEMPTEDUPDATENO');
            excl.append('Action','TAX_UPDATE');
            excl.append('Tax_Gid',     $scope.tax_gids);
            excl.append('TaxDetails_Gid',$scope.add_tax.taxgid);
            excl.append('TaxDetails_Partner_Gid',$scope.partner_gid);
            excl.append('TaxDetails_Partnerbranchcode',e.branch.partnerbranch_code);
            excl.append('TaxDetails_Partner_Code',$scope.Partner.partnercode);
            excl.append('TaxDetails_Partner_Type','S');
            excl.append('TaxDetails_Is_MSME', $scope.add_tax.ngpsMSME);
            excl.append('TaxDetails_TaxNo', $scope.add_tax.ngmtaxno);
            excl.append('TaxSubDetails_TaxRate_Gid',$scope.trgid);
            excl.append('TaxSubDetails_TaxRate',$scope.trat);
            excl.append('TaxSubDetails_IsExcempted', $scope.idsd);
            excl.append('TaxSubDetails_ExcemFrom',  $scope.updatetax_fromdate);
            excl.append('TaxSubDetails_ExcemTo', $scope.updatetax_todate);
            excl.append('TaxSubDetails_ExcemthroSold', $scope.add_tax.ngthrosold);
            excl.append('TaxSubDetails_ExcemRate', "");
            excl.append('FileName', "");
            excl.append('Create_By', $scope.create_by);
            loadexcl_updatetax(excl);
  }
if( $scope.isexcem=="YES"){
        if ($scope.add_tax.file !== undefined) {
            $scope.name = $scope.add_tax.file.name;
            var excl = new FormData();
            reconname($scope.name);
            excl.append('file',$scope.add_tax.file);
            excl.append('name', $scope.recon_name);
            excl.append('Group', 'TAXINSERTSUMMARYEXEMPTEDUPDATEYES');
            excl.append('Action','TAX_UPDATE');
            excl.append('TaxDetails_Gid',$scope.add_tax.taxgid);
            excl.append('TaxDetails_Partner_Gid',$scope.partner_gid);
            excl.append('TaxDetails_Partnerbranchcode',e.branch.partnerbranch_code);
            excl.append('TaxDetails_Partner_Code',$scope.Partner.partnercode);
            excl.append('TaxDetails_Partner_Type','S');
            excl.append('TaxDetails_Is_MSME', $scope.add_tax.ngpsMSME);
            excl.append('Tax_Gid',$scope.tax_gids);
            excl.append('TaxDetails_TaxNo', $scope.add_tax.ngmtaxno);
            excl.append('TaxSubDetails_TaxRate_Gid', $scope.ngistaxrategid);
            excl.append('TaxSubDetails_TaxRate', $scope.ngistaxrate);
            excl.append('TaxSubDetails_IsExcempted', $scope.idsd);
            excl.append('TaxSubDetails_ExcemFrom', $scope.updatetax_fromdate);
            excl.append('TaxSubDetails_ExcemTo',  $scope.updatetax_todate);
            excl.append('TaxSubDetails_ExcemthroSold',$scope.add_tax.ngthrosold);
            excl.append('TaxSubDetails_ExcemRate',  $scope.add_tax.ngmtaxExempted);

            excl.append('File_Name', $scope.recon_name);
            excl.append('Create_By', $scope.create_by);
            loadexcl_updatetax(excl);
        }
        else
        {
            var excl = new FormData();
            $scope.name="";
            reconname($scope.name);
            excl.append('Group', 'TAXINSERTSUMMARYEXEMPTEDUPDATEYESNOFILE');
            excl.append('Action','TAX_UPDATE');
            excl.append('TaxDetails_Gid',$scope.add_tax.taxgid);
            excl.append('TaxDetails_Partner_Gid',$scope.partner_gid);
            excl.append('TaxDetails_Partnerbranchcode',e.branch.partnerbranch_code);
            excl.append('TaxDetails_Partner_Code',$scope.Partner.partnercode);
            excl.append('TaxDetails_Partner_Type','S');
            excl.append('name', $scope.recon_name);
            excl.append('TaxDetails_Is_MSME', $scope.add_tax.ngpsMSME);
            excl.append('Tax_Gid',$scope.tax_gids);
            excl.append('TaxDetails_TaxNo', $scope.add_tax.ngmtaxno);
            excl.append('TaxSubDetails_TaxRate_Gid', $scope.ngistaxrategid);
            excl.append('TaxSubDetails_TaxRate',$scope.ngistaxrate);
            excl.append('TaxSubDetails_IsExcempted', $scope.idsd);
            excl.append('TaxSubDetails_ExcemFrom', $scope.updatetax_fromdate);
            excl.append('TaxSubDetails_ExcemTo',  $scope.updatetax_todate);
            excl.append('TaxSubDetails_ExcemthroSold',$scope.add_tax.ngthrosold);
            excl.append('TaxSubDetails_ExcemRate',  $scope.add_tax.ngmtaxExempted);
            excl.append('File_Name',e.tax_filename);
            excl.append('FilePath',   $scope.add_tax.file_path);
            excl.append('Create_By', $scope.create_by);
            loadexcl_updatetax(excl);
        }
}
}
    function loadexcl_updatetax(excl) {
        var tax_update = Servicedrctsale.taxupdate_details(excl);
        tax_update.then(function(res) {
            var hosmr = [];
            $scope.hosmr = res.data;
            //alert(JSON.stringify($scope.hosmr));
            if($scope.hosmr == "SUCCESS"){
                    alert("SUCCESSFULLY UPDATED!")
                modalhide('taxdetailsmodal');
                gettaxdetails();
            }else {
                alert(JSON.stringify($scope.hosmr));
            }
        })
    }

    function gottaxdetails(query) {
        var result = $filter('filter')($scope.tax, {
            'tax_type': query
        });
        return result;
    }

    function fn_taxpartnerbranchdetails(query) {
        var result = $filter('filter')($scope.tax_partnerbranch_name, {
            'partnerbranch_name': query
        });
        return result;
    }

    function gottaxratedetails(query) {

        var result = $filter('filter')($scope.taxrate, {
            'taxrate_rate': query
        });
        return result;
    }


    dropdowntaxtype();
    function dropdowntaxtype(){
        var data = {
            "Params": {
                "Group": "GETTAXTYPE",
                "Action": "TaxType_Get",
            }
        }
        var gettaxtype = Servicedrctsale.gettaxtypedata(data)
        gettaxtype.then(function (result) {

            $scope.tax = result.data.DATA;
            //alert(JSON.stringify( $scope.tax))
        },
        function (err) {
            alert('No data!.');
        }).finally();
    }



    $scope.ngctaxtype=function(e)
    {

        if(e == undefined){
        $scope.add_tax.ngistaxrate='';
        }
        $scope.tgd=e.tax_type_gid
        var a=e.tax_type_gid.split('-').pop();
        var b=e.tax_type.split('-');
        $scope.tax_showtype=b[0];
        if($scope.tax_showtype == "GST "){
        $scope.tax_show_data=false;
        $scope.showform=false;
        $scope.idsd='N';

        }else{
        $scope.tax_show_data=true;
        $scope.showform=true;

        }
        var dat = {
            "Table_name": "gal_mst_ttaxrate",
            "Column_1": "taxrate_gid,taxrate_rate,taxrate_subtax_gid",
            "Column_2": "",
            "Where_Common": "taxrate",
            "Where_Primary": "subtax_gid",
            "Primary_Value": a,
            "Order_by": "gid"
        }
        var ppartnertaxrate = {
            Action: "",
            Entity_Gid: $scope.entity_gid,
            data: dat
        }
        //$scope.taxrate=[];
        var getpartnertaxrate = Servicedrctsale.gettaxreateedata(ppartnertaxrate)
        getpartnertaxrate.then(function (result) {

            $scope.taxrate = (result.data.DATA);
           //alert(JSON.stringify( $scope.taxrate))
        },
        function (err) {
            alert('No data!.');
        }).finally();
    }

    function gotisexcempted(query){
    var result=$filter('filter')($scope.metaisexcempted,{
    'metadata_value':query
    });
    return result;
    }

    isexcempted();

    function isexcempted(){
        var dat = {
            "Table_name": "gal_mst_tmetadata",
            "Column_1": "metadata_value",
            "Column_2": "",
            "Where_Common": "metadata",
            "Where_Primary": "columnname",
            "Primary_Value": "taxsubdetails_isexcempted",
            "Order_by": "value"
        }
        var ppartnerisexcempted = {
            Action: "",
            Entity_Gid: $scope.entity_gid,
            data: dat
        }
        $scope.metaisexcempted=[];
        var getpartnerisexcempted = Servicedrctsale.getisexcempteddata(ppartnerisexcempted)
        getpartnerisexcempted.then(function (result) {

            $scope. metaisexcempted= result.data.DATA;
            //alert(JSON.stringify( $scope.metaisexcempted))
        },
        function (err) {
            alert('No data!.');
        }).finally();
    }

    taxdisabled();

    function taxdisabled(){

    }
    $scope.ngcMSME=function(e){

    $scope.hg=e;
    $scope.ngpsMSME=e.metadata_value;

    }

    if($scope.ones=="YES"){
    $scope.taxexce=true;
    }

    $scope.ngcngtaxrate=function(e){

    $scope.trgid=e.taxrate_gid
    $scope.trat=e.taxrate_rate
    }

    $scope.ngcngtaxExempted=function(e){


    if(e == "NO" || e == undefined){
    $scope.showform = false;
    $scope.idsd="N"
    }
        else if(e.metadata_value == "YES"){
    $scope.showform = true;
    $scope.idsd="Y"
    }

    else if(e == "YES"){
    $scope.showform = true;
    $scope.idsd="Y"
    }

    else{
    $scope.showform = false;
     $scope.idsd="N";
    }
    }
function reconname(item) {
        var fileExtension = '.' + item.split('.').pop();
        $scope.recon_name = "TDS-TAXDETAILS" + new Date().getTime() + fileExtension;
    };

    $scope.addtaxdetailsmode=function(e){
        debugger;
        if ($scope.add_tax.fdate) {
            $scope.fromdate = formatStringDate($scope.add_tax.fdate, 'yyyy-mm-dd');
        }
        else {
            $scope.fromdate = '';
        }
        if ($scope.add_tax.tdate) {
            $scope.todate = formatStringDate($scope.add_tax.tdate, 'yyyy-mm-dd');
        }
        else {
            $scope.todate = '';
        }
        if ($scope.add_tax.ngthrosold) {
            $scope.throsold = $scope.add_tax.ngthrosold;
        }
        else {
            $scope.throsold = '';
        }
        if ($scope.add_tax.ngmtaxExempted) {
            $scope.taxExempted = $scope.add_tax.ngmtaxExempted;
        }
        else {
            $scope.taxExempted = '';
        }

        if($scope.idsd=="Y"){

        if ($scope.add_tax.file == undefined) {
            alert("Fill the tax File field!.");
            return false;
        }

        $scope.name = $scope.add_tax.file.name;
        debugger;
        if ($scope.file !== undefined) {
            var excl = new FormData();
            reconname($scope.name);
            excl.append('file',$scope.add_tax.file);
            excl.append('name', $scope.recon_name);
            excl.append('Group', 'TAXINSERTSUMMARYEXEMPTEDYES');
            excl.append('Action','TAX_INSERT');
            excl.append('Tax_Gid', $scope.tgd);
            excl.append('TaxDetails_Partner_Gid',$scope.partner_gid);
            excl.append('TaxDetails_Partnerbranchcode',e.branch.partnerbranch_code);
            excl.append('TaxDetails_Partner_Code',$scope.Partner.partnercode);
            excl.append('TaxDetails_Partner_Type','S');
            excl.append('TaxDetails_TaxNo', $scope.add_tax.ngmtaxno);
            excl.append('TaxDetails_Is_MSME',  $scope.ngpsMSME);
            excl.append('TaxSubDetails_TaxRate_Gid', $scope.trgid);
            excl.append('TaxSubDetails_TaxRate', $scope.trat);
            excl.append('TaxSubDetails_IsExcempted', $scope.idsd);
            excl.append('TaxSubDetails_ExcemFrom', $scope.fromdate);
            excl.append('TaxSubDetails_ExcemTo', $scope.todate);
            excl.append('TaxSubDetails_ExcemthroSold', $scope.throsold);
            excl.append('TaxSubDetails_ExcemRate', $scope.taxExempted);
            excl.append('FileName', $scope.recon_name);
            excl.append('Create_By', $scope.create_by);
            loadexclTax(excl);
        }}else{
            var excl = new FormData();
            $scope.name="";
            reconname($scope.name);
            excl.append('file','');
            excl.append('name', '');
            excl.append('Group', 'TAXINSERTSUMMARYEXEMPTEDNO');
            excl.append('Action','TAX_INSERT');
            excl.append('Tax_Gid', $scope.tgd);
            excl.append('TaxDetails_Partner_Gid',$scope.partner_gid);
            excl.append('TaxDetails_Partnerbranchcode',e.branch.partnerbranch_code);
            excl.append('TaxDetails_Partner_Code',$scope.Partner.partnercode);
            excl.append('TaxDetails_Partner_Type','S');
            excl.append('TaxDetails_TaxNo', $scope.add_tax.ngmtaxno);
            excl.append('TaxSubDetails_TaxRate_Gid', $scope.trgid);
            excl.append('TaxDetails_Is_MSME',  $scope.ngpsMSME);
            excl.append('TaxSubDetails_TaxRate', $scope.trat);
            excl.append('TaxSubDetails_IsExcempted', $scope.idsd);
            excl.append('TaxSubDetails_ExcemFrom',$scope.fromdate);
            excl.append('TaxSubDetails_ExcemTo', $scope.todate);
            excl.append('TaxSubDetails_ExcemthroSold', $scope.throsold);
            excl.append('TaxSubDetails_ExcemRate',$scope.taxExempted);
            excl.append('FileName', "");
            excl.append('Create_By', $scope.create_by);
            loadexclTax(excl);

        }
     }
     function gottaxmsmedetails(query) {
        var result = $filter('filter')($scope.partnertaxdetails, {
            'metadata_value': query
        });
        return result;
    }
    gettaxmsme();
    function gettaxmsme(){
        var taxdetailsmode = {
            "Table_name":"gal_mst_tmetadata",
            "Column_1":"metadata_gid,metadata_value",
            "Column_2":"",
            "Where_Common":"metadata",
            "Where_Primary":"columnname",
            "Primary_Value":"taxdetails_ismsme",
            "Order_by":"gid"
        }
        var taxdetailsval = {
             Action: "",
             Entity_Gid: $scope.entity_gid,
             data: taxdetailsmode
        }
        $scope.partnertaxdetails = [];
        var getpartnertaxdetails = Servicedrctsale.getmsmetaxdata(taxdetailsval)
        getpartnertaxdetails.then(function (result) {

            $scope.partnertaxdetails = result.data.DATA;

            //alert(JSON.stringify($scope.partnertaxdetails))
        }, function (err) {
              alert('No data!.');
        }).finally();
    }

function loadexclTax(excl) {

        $scope.loading();

        var overalldtl = Servicedrctsale.taxinsert(excl);
        overalldtl.then(function(res) {
            var hosmr = [];
            $scope.hosmrw=res.data
            $scope.hosmr = res.data.MESSAGE;

            if ($scope.hosmr == "SUCCESSFULLY INSERTED") {
                alert("SUCCESSFULLY INSERTED!")
                $scope.add_tax.ngpsMSME='',
                $scope.add_tax.ngstaxtype='',
                $scope.add_tax.ngmtaxno='',
                $scope.add_tax.ngistaxrate='',
                $scope.add_tax.ngisexcem='',
                $scope.add_tax.fdate='',
                $scope.add_tax.tdate='',
                $scope.add_tax.ngmtaxExempted='',
                $scope.add_tax.ngthrosold='',
                $scope.file=''
                modalhide('taxdetailsmodal');
                gettaxdetails();

            } else {
                alert(JSON.stringify($scope.hosmrw));

            }
        }).finally($scope.endloading);
    }
$scope.addtaxpagepopup = function()
    {
       $scope.add_tax.ngpsMSME="";
       $scope.add_tax.ngstaxtype="";
       $scope.add_tax.ngmtaxno="";
       $scope.add_tax.ngistaxrate="";
       $scope.add_tax.ngisexcem="";
       $scope.add_tax.fdate="";
       $scope.add.tdate="";
       $scope.add_tax.ngmtaxExempted="";
       $scope.add_tax.ngthrosold="";
       $scope.file="";
       $scope.addtax=true;
       $scope.taxupdate=false;
       tax_partnerbranchname();
       modalshow('taxdetailsmodal');
	}

	$scope.edit_tax_file=function(){
	$scope.showforms=true;
	}

$scope.show_taxdetails=function(e){


   //alert(JSON.stringify($scope.showform));
   $scope.tax_gid=e.taxdetails_tax_gid +' '+ '-'+' '+e.taxdetails_subtax_gid;
   $scope.addtax=false;
   $scope.taxupdate=false;

   if(e.taxsubdetails_isexcempted=="YES"){
   $scope.showform = true;
   $scope.idsd="Y"
   }
   else{
   $scope.idsd="N";
   $scope.showform = false;
   }
   $scope.add_tax.taxgid=e.taxdetails_gid;

   $scope.add_tax.ngpsMSME=e.taxdetails_ismsme;
   $scope.add_tax.ngstaxtype=e.tax_type;
   $scope.add_tax.file_path=e.file_path;
   $scope.add_tax.tax_filename=e.file_name;
   $scope.add_tax.ngmtaxno=e.taxdetails_taxno;
   $scope.add_tax.ngistaxrate=e.taxsubdetails_taxrate;
   $scope.add_tax.ngistaxrategid=e.taxsubdetails_taxrate_gid;
   $scope.add_tax.ngisexcem=e.taxsubdetails_isexcempted;
   $scope.add_tax.fdate=new Date(e.taxsubdetails_excemfrom);
   $scope.add_tax.tdate=new Date(e.taxsubdetails_excemto);
   $scope.add_tax.ngmtaxExempted=e.taxsubdetails_excemrate;
   $scope.add_tax.ngthrosold=e.taxsubdetails_excemthrosold;
   $scope.file=e.taxsubdetails_isexcempted;
   modalshow('taxdetailsmodal');
   }


$scope.edit_taxdata=function(e){
$scope.aa=e.tax_type.split(" - ");
$scope.aa1=$scope.aa[0];
if($scope.aa1 == "GST"){
$scope.tax_show_data=false;
}
if($scope.aa1 != "GST"){
$scope.tax_show_data=true;
}
    //alert(JSON.stringify($scope.showform));
   $scope.tax_gid=e.taxdetails_tax_gid +' '+ '-'+' '+e.taxdetails_subtax_gid;
   $scope.addtax=false;
   $scope.taxupdate=true;

   if(e.taxsubdetails_isexcempted=="YES"){
   $scope.showform = true;
   $scope.idsd="Y"
   }
   else{
   $scope.idsd="N";
   $scope.showform = false;
   }
   debugger;
   $scope.add_tax.taxgid=e.taxdetails_gid;
   $scope.add_tax.branch=e.partnerbranch_name,
   $scope.add_tax.ngpsMSME=e.taxdetails_ismsme;
   $scope.add_tax.ngstaxtype=e.tax_type;
   $scope.add_tax.file_path=e.file_path;
   $scope.add_tax.tax_filename=e.file_name;
   $scope.add_tax.ngmtaxno=e.taxdetails_taxno;
   $scope.add_tax.ngistaxrate=e.taxsubdetails_taxrate;
   $scope.add_tax.ngistaxrategid=e.taxsubdetails_taxrate_gid;
   $scope.add_tax.ngisexcem=e.taxsubdetails_isexcempted;
   $scope.add_tax.fdate=new Date(e.taxsubdetails_excemfrom);
   $scope.add_tax.tdate=new Date(e.taxsubdetails_excemto);
   $scope.add_tax.ngmtaxExempted=e.taxsubdetails_excemrate;
   $scope.add_tax.ngthrosold=e.taxsubdetails_excemthrosold;
   $scope.file=e.taxsubdetails_isexcempted;
   modalshow('taxdetailsmodal');
   }
$scope.add_tax=[];
$scope.TaxsearchDetails=function(d){

    $scope.as=$scope.add_tax.ngmptaxno;
    gettaxdetails();
}

gettaxdetails();

function gettaxdetails()
    {

        if ($scope.add_tax.ngsstaxtype) {
            $scope.ttaxid = $scope.add_tax.ngsstaxtype.tax_type_gid;
        }
        else {
            $scope.ttaxid = '';
        }
        if ($scope.add_tax.ngmptaxno) {
            $scope.ttaxno = $scope.add_tax.ngmptaxno;
        }
        else {
             $scope.ttaxno = '';
        }

        var data = {
            "Params": {
                "Filter":{
                "TaxDetails_Partner_gid":$scope.partner_gid,
                "Mst_Table": $scope.msttable,
                },
                "Classification": {
                "Entity_Gid":1
                },
                "Group": "ATMATAXSUMMARY",
                "Action": "Tax_Details_Get",

            }
        }

        var get_data = Servicedrctsale.get_atmataxdetails(data)
        get_data.then(function(result) {
            $scope.get_tax_details=result.data.DATA;
            $scope.searchtaxdetails=$scope.get_tax_details;
            //console.log($scope.alldetails)
           //alert(JSON.stringify($scope.get_tax_details))
        })

    }

    $scope.change_tax=function(e){

        if(e.ngsstaxtype != undefined && e.ngsstaxtype != null && e.ngsstaxtype !='' )
        {
        var temp= e.ngsstaxtype.tax_type;
        }
        else
        {
        var temp='';
        }
        $scope.get_tax_details = $filter('filter')($scope.searchtaxdetails , {
               "taxdetails_taxno": e.ngmptaxno == null || e.ngmptaxno == undefined || e.ngmptaxno == '' ? '' : e.ngmptaxno ,
               "tax_type": temp == null ||  temp == undefined  || temp == '' ? '' : temp
        });
}
    $rootScope.showvtaxdetails = function(ev) {
    $scope.loading();

    modalshow('atma_taxview_page');
    $scope.paymodepop=ev.taxdetails_ismsme
    $scope.bankpop=ev.tax_type
    $scope.branchpop=ev.taxdetails_taxno
    $scope.ifscpop=ev.taxsubdetails_taxrate
    $scope.acctpop=ev.taxsubdetails_isexcempted

    $scope.endloading();

    }

    //TAXEND

    //ACTIVITYSTART

    $scope.gotoactivity = gotoactivity;
    $scope.showpopup_Activity = function() {

    $scope.addactivityButton = true;
    $scope.editactivityButton = false;
        $scope.Activityadd.actgid="";
        $scope.Activityadd.activitycode="";
        $scope.Activityadd.activitytype="";
        $scope.Activityadd.activityname="";
        $scope.Activityadd.description="";
        $scope.Activityadd.activitystartdate="";
        $scope.Activityadd.activityenddate="";
        $scope.Activityadd.projectedcontract="";

        $scope.Activityadd.fidelityinsurance="";
        $scope.Activityadd.bidding="";
        $scope.Activityadd.reason="";
        $scope.Activityadd.ngactgrp="";
        $scope.add.prsnname="";
        $scope.add.dsgntn="";
        $scope.add.lndlne="";
        $scope.add.lndlne2="";
        $scope.add.mobno="";
        $scope.add.mobno2="";
        $scope.add.mailid="";
        $scope.add.dobb="";
        $scope.add.weddy="";
        activity_branchname();
<!--        $scope.add.cntcttype="";-->
       modalshow('Activity_showpopup');
   }

    $scope.activitytypes = [{
        id: 'P',
        data: 'Product'
    }, {
        id: 'S',
        data: 'Service'
    }];
    $scope.fidelityinsurance = [{
        id: 'Y',
        data: 'YES'
    }, {
        id: 'N',
        data: 'NO'
    }];
    $scope.bidding = [{
        key: 'Y',
        value: 'YES'
    }, {
        key: 'N',
        value: 'NO'
    }];
    function gotoactivity(query) {
        var result = $filter('filter')($scope.act, {
            'metadata_value': query
        });
        return result;
    }
    var dat = {
        "Table_name": "gal_mst_tmetadata",
        "Column_1": "metadata_value",
        "Column_2": "",
        "Where_Common": "metadata",
        "Where_Primary": "columnname",
        "Primary_Value": "activity_status",
        "Order_by": "value"
    }
    var pact = {
        Action: "",
        Entity_Gid: $scope.entity_gid,
        data: dat
    }
    $scope.act = [];
    var getact = Servicedrctsale.getactdata(pact)
    getact.then(function(result) {
        $scope.act = result.data.DATA;
        // alert(JSON.stringify(result.data));
    }, function(err) {
        // alert('No data!.');
    }).finally();

    var custgrpddl = Servicedrctsale.getcustgrp()
    custgrpddl.then(function(result) {
        $scope.conttype = [];
        $scope.conttype = JSON.parse(result.data);
    }),
    function() {
        alert('No data!.');
    };

    function loaddata1() {
           $scope.designationdetails == [];
           var rolegrouplist = Servicedrctsale.getdesg();
           rolegrouplist.then(function(rolegrouplist) {
                   $scope.designationdetails = JSON.parse(rolegrouplist.data);
               }, function(err) {
                   alert('No data!.');
               })
               .finally();
   };
       loaddata1();

    loadActivityData();

   $scope.edit_activitydata=function(e){

    if (e.Contact_DOB){
                $scope.Contact_DOBs =  formatStringDate( new Date(e.Contact_DOB), 'yyyy-mm-dd');
             }
             else
             {
                $scope.Contact_DOBs= null;
             }
     if (e.Contact_WD){
                $scope.Contact_WDs =  formatStringDate( new Date(e.Contact_WD), 'yyyy-mm-dd');
             }
             else
             {
                $scope.Contact_WDs= null;
             }

        $scope.Activityadd=[];
        $scope.addactivityButton = false;
        $scope.editactivityButton = true;
        modalshow('Activity_showpopup');
        $scope.Activityadd.actgid=e.activity_gid;
        $scope.Activityadd.activitycode=e.activity_code;
        $scope.Activityadd.activitytype=e.activity_type;
        $scope.Activityadd.activityname=e.activity_name;
        $scope.Activityadd.description=e.activity_desc;
        $scope.Activityadd.branch=e.partnerbranch_name;
        $scope.Activityadd.activitystartdate=new Date(e.activity_startdate);
        $scope.Activityadd.activityenddate=new Date(e.activity_enddate);
        $scope.Activityadd.projectedcontract=e.activity_projectedspend;
        $scope.Activityadd.actrm=e.employee_name;
        $scope.Activityadd.fidelityinsurance=e.activity_fidiinsur;
        $scope.Activityadd.bidding=e.activity_bidding;
        $scope.Activityadd.reason=e.activity_reason;
        $scope.Activityadd.ngactgrp=e.activity_status;
        $scope.add.prsnname=e.Contact_personname;
        $scope.add.dsgntn=e.Contact_designation_gid;
        $scope.add.lndlne=e.Contact_landline;
        $scope.add.lndlne2=e.Contact_landline2;
        $scope.add.mobno=e.Contact_mobileno;
        $scope.add.mobno2=e.Contact_mobileno2;
        $scope.add.mailid=e.Contact_email;
        $scope.add.cntcttype=e.Contact_contacttype_gid;
        $scope.add.dobb=$scope.Contact_DOBs;
        $scope.add.weddy=$scope.Contact_WDs;
   }

$scope.show_activity=function(e){

    if (e.Contact_DOB){
                $scope.Contact_DOBs =  formatStringDate( new Date(e.Contact_DOB), 'yyyy-mm-dd');
             }
             else
             {
                $scope.Contact_DOBs= null;
             }
     if (e.Contact_WD){
                $scope.Contact_WDs =  formatStringDate( new Date(e.Contact_WD), 'yyyy-mm-dd');
             }
             else
             {
                $scope.Contact_WDs= null;
             }

        $scope.Activityadd=[];
        $scope.addactivityButton = false;
        $scope.editactivityButton = false;

        $scope.Activityadd.actgid=e.activity_gid;
        $scope.Activityadd.activitycode=e.activity_code;
        $scope.Activityadd.activitytype=e.activity_type;
        $scope.Activityadd.activityname=e.activity_name;
        $scope.Activityadd.description=e.activity_desc;
        $scope.Activityadd.activitystartdate=new Date(e.activity_startdate);
        $scope.Activityadd.activityenddate=new Date(e.activity_enddate);
        $scope.Activityadd.projectedcontract=e.activity_projectedspend;
        $scope.Activityadd.actrm=e.employee_name;
        $scope.Activityadd.fidelityinsurance=e.activity_fidiinsur;
        $scope.Activityadd.bidding=e.activity_bidding;
        $scope.Activityadd.reason=e.activity_reason;
        $scope.Activityadd.ngactgrp=e.activity_status;
        $scope.add.prsnname=e.Contact_personname;
        $scope.add.dsgntn=e.Contact_designation_gid;
        $scope.add.lndlne=e.Contact_landline;
        $scope.add.lndlne2=e.Contact_landline2;
        $scope.add.mobno=e.Contact_mobileno;
        $scope.add.mobno2=e.Contact_mobileno2;
        $scope.add.mailid=e.Contact_email;
        $scope.add.cntcttype=e.Contact_contacttype_gid;
        $scope.add.dobb=$scope.Contact_DOBs;
        $scope.add.weddy=$scope.Contact_WDs;
        modalshow('Activity_showpopup');
   }

    $scope.activitydetailshref=function(e){



<!--    sessionStorage.setItem('activity_details_gid', JSON.stringify(e));-->
<!--    $window.location.href="atma_activitydetails";-->
    //alert(e);
    }

    //to Save edited data
   $scope.activitysummaryedit=function(){
       debugger;
       var data = {
           "Params": {
               "Activity_Gid": $scope.Activityadd.actgid,
               "Activity_Partnergid":$scope.partner_gid,
               "Activity_PartnerCode":$scope.Partner.partnercode,
               "Activity_partnerbranchgid":$scope.Activityadd.branch.partnerbranch_gid,
               "Activity_Type": $scope.Activityadd.activitytype,
               "Activity_Name": $scope.Activityadd.activityname,
               "Activity_Desc": $scope.Activityadd.description,
               "Activity_Code":$scope.Activityadd.activitycode,
               "Activity_StartDate":formatStringDate($scope.Activityadd.activitystartdate, 'yyyy-mm-dd'),
               "Activity_EndDate":formatStringDate($scope.Activityadd.activityenddate, 'yyyy-mm-dd'),
               "Activity_ProjectedSpend": $scope.Activityadd.projectedcontract,
               "Activity_rm":$scope.Activityadd.actrm.employee_gid,
               "Activity_FidiInsur":$scope.Activityadd.fidelityinsurance,
               "Activity_Bidding":$scope.Activityadd.bidding,
               "Activity_Reason":$scope.Activityadd.reason,
               "Activity_Status": $scope.Activityadd.ngactgrp,
               "Contact_ContactType_Gid": $scope.add.cntcttype,
               "Contact_PersonName": $scope.add.prsnname,
               "Contact_Designation_Gid":$scope.add.dsgntn,
               "Contact_LandLine":$scope.add.lndlne,
               "Contact_LandLine2":$scope.add.lndlne2,
               "Contact_MobileNo":$scope.add.mobno,
               "Contact_MobileNo2":$scope. add.mobno,
               "Contact_Email":$scope.add.mailid,
               "Contact_DOB":$scope. add.dobb,
               "Contact_WD":$scope.add.weddy
           },
           "Classification": {
               "Update_By": $scope.entity_gid,
           },
       }
       var details = {
           Group: 'Activity_UPDATE',
           Action: 'ACTIVITY_UPDATE',
           Type:'ACTIVITY_UPDATE',
           data: data,
       }
       $scope.loading();
       var update_actgrp = Servicedrctsale.updateactgrp(details)
       update_actgrp.then(function(result) {
               $scope.actupdate_group = result.data.MESSAGE;
               if($scope.actupdate_group=="SUCCESS"){
               alert($scope.actupdate_group);
                modalhide('Activity_showpopup');
                loadActivityData();
               }else{
               alert(JSON.stringify($scope.actupdate_group));
               }

           }),
           function(err) {
               alert('no data');
           }.finally($scope.endloading());
   }

$scope.searchActivitydata=function(){
    loadActivityData();
}

function loadActivityData() {
    var filter={};
       if ($scope.Activityadd.Search_activitytype) {
           filter['Activity_Type'] = $scope.Activityadd.Search_activitytype
       } else {
           filter['Activity_Type'] = '';
       }
       if ($scope.Activityadd.Search_activityname) {
           filter['Activity_Name'] = $scope.Activityadd.Search_activityname
       } else {
           filter['Activity_Name'] = '';
       }
       if ($scope.Activityadd.Search_description) {
           filter['Activity_Desc'] = $scope.Activityadd.Search_description
       } else {
           filter['Activity_Desc'] = '';
       }
       if ($scope.Activityadd.Searchselectedemp) {
           filter['Activity_Rm'] = $scope.Activityadd.Searchselectedemp.employee_gid
       } else {
          filter['Activity_Rm']= '';
       }
       filter['Activity_Partnergid']= $scope.partner_gid,
       filter['Mst_Table']= $scope.msttable

       var data = {
           "Params": {
               "Filter": filter,
               "Classification":
               {
                   "Entity_Gid": $scope.entity_gid
               }
           }
       }
       var dtam = {
           Group: 'Activity_Group',
           Type: 'Activity_Get',
           data: data
       }
       $scope.getActivitySummary = [];
       var getActivitySummary = Servicedrctsale.getdattam(dtam)
       getActivitySummary.then(function(result) {

            //alert(JSON.stringify(result.data));
           $scope.getActivitySummary = result.data.DATA;
           $scope.searchActivitySummary = $scope.getActivitySummary;
           $scope.pageLength1 = $scope.getActivitySummary.length
           //alert(JSON.stringify($scope.getActivitySummary))
           //$scope.load = $scope.getActivitySummary
           //$scope.pageLength = $scope.getActivitySummary.length;
       }, function(err) {
           alert('No data!.');
       }).finally();
   }

$scope.search_activity=function(a){

if(a.Searchselectedemp != undefined && a.Searchselectedemp != null && a.Searchselectedemp !='' )
        {
        var activitytemp=a.Searchselectedemp.employee_name;
        }
    else
        {
        var activitytemp='';
        }
        $scope.getActivitySummary = $filter('filter')($scope.searchActivitySummary , {
               "employee_name": activitytemp == null || activitytemp == undefined || activitytemp == '' ? '' : activitytemp,
                "activity_name": a.Search_activityname == null ||  a.Search_activityname == undefined ||  a.Search_activityname == '' ? '' :  a.Search_activityname,

        });

}


$scope.activitysummarysave = function(Activityadd) {
        debugger;
       var data = {
           "Params": {
               "Activity_Partnergid":$scope.partner_gid,
               "Activity_PartnerCode":$scope.Partner.partnercode,
               "Activity_partnerbranchgid":Activityadd.branch.partnerbranch_gid,
               "Activity_Type": Activityadd.activitytype,
               "Activity_Name": Activityadd.activityname,
               "Activity_Desc": Activityadd.description,
               "Activity_Code": Activityadd.activitycode,
               "Activity_StartDate": Activityadd.activitystartdate,
               "Activity_EndDate": Activityadd.activityenddate,
               "Activity_ProjectedSpend": Activityadd.projectedcontract,
               "Activity_rm": $scope.partner_rm_gid,
               "Activity_FidiInsur": Activityadd.fidelityinsurance,
               "Activity_Bidding": Activityadd.bidding,
               "Activity_Reason": Activityadd.reason,
               "Activity_Status": Activityadd.ngactgrp.metadata_value,
               "Create_By": $scope.create_by,
               "Contact_ContactType_Gid": $scope.add.cntcttype,
               "Contact_PersonName": $scope.add.prsnname,
               "Contact_Designation_Gid": $scope.add.dsgntn,
               "Contact_LandLine": $scope.add.lndlne,
               "Contact_LandLine2": $scope.add.lndlne2,
               "Contact_MobileNo": $scope.add.mobno,
               "Contact_MobileNo2": $scope.add.mobno2,
               "Contact_Email": $scope.add.mailid,
               "Contact_DOB": $scope.add.dobb,
               "Contact_WD": $scope.add.weddy
           },
           "Classification": {
               "Update_By":detail.employee_gid,
               "Entity_Gid": $scope.entity_gid,
           },
       }
       var details = {
           Group: 'Activity_ADD',
           Action: 'Activity_Insert',
           Type: 'Activity_Group',
           data: data,
       }
       $scope.loading();
       var set_actgrp = Servicedrctsale.ActivityaddService(details)
       set_actgrp.then(function(result) {
               $scope.actgroup = result.data.MESSAGE;
               //alert(JSON.stringify($scope.actgroup));
               if($scope.actgroup =="SUCCESSFULLY INSERTED"){
               alert(JSON.stringify($scope.actgroup));
              // $scope.activityform.$setPristine();
               modalhide('Activity_showpopup');
               loadActivityData();
               }
               else{
               alert(JSON.stringify($scope.actgroup))
               }
           }),
           function(err) {
               alert('no data');
           }.finally($scope.endloading());
   }

   $scope.values=true;
//ACTIVITYEND

//ClientDetails Start Page...!
$scope.addclient=[];
$scope.ClientDetailspopup=function(){

  $scope.clientsubmit=true;
        $scope.clientupdate=false;
$scope.add.name="",
$scope.add.addline="",
$scope.add.addline2="",
$scope.add.addline3="",
$scope.add.addselectedstate="",
$scope.add.addselecteddistrict="",
$scope.add.addselectedcity="",
$scope.add.pincode1="",
modalshow('ClientAddPopup')

}
var eaddrsttddl = Servicedrctsale.getstateddl()
        eaddrsttddl.then(function(result) {
                $scope.stateddl = [];
                $scope.stateddl = JSON.parse(result.data);
            }),
            function() {
                alert('No data!.');
            };
$scope.state_clk = function(state_gid, type) {

            $scope.client_stategid=state_gid;

            var distddl = Servicedrctsale.getdistddl(state_gid)
            distddl.then(function(result) {


                        $scope.adistrictddl = JSON.parse(result.data);

                }),
                function() {
                    alert('No data!.');
                };
        };

        $scope.district_clk = function(district_gid, type) {

        if(type == "address"){
        $scope.client_districtgid=district_gid;
        }else{
         $scope.client_districtgid="";
        }
            var ctyddl = Servicedrctsale.getcityddl(district_gid)
            ctyddl.then(function(result) {
                    if (type == 'address') {
                        $scope.acity1 = [];
                        $scope.acity1 = JSON.parse(result.data);
                    } else {
                        $scope.city1 = [];
                        $scope.city1 = JSON.parse(result.data);
                    }
                }),
                function() {
                    alert('No data!.');
                };
        };
$scope.pinchange = function(pincode, type) {

            var pincd = Servicedrctsale.getpincodeall(pincode)
            pincd.then(function(result) {
                    if (type == 'address') {
                        var apincde = [];
                        apincde = JSON.parse(result.data);
                        $scope.add.addselectedstate = apincde[0].city_state_gid;
                        $scope.state_clk($scope.add.addselectedstate, 'address');
                        $scope.add.addselecteddistrict = apincde[0].pincode_district_gid;
                        $scope.district_clk($scope.add.addselecteddistrict, 'address');
                        $scope.add.addselectedcity = apincde[0].pincode_City_gid;
                        $scope.add.pincode1 = apincde[0].pincode_no;
                    }
                }),
                function() {
                    alert('No data!.');
                };
        };


$scope.city_clk = function(city_gid, type) {

            $scope.client_citygid=city_gid;
            var pincd = Servicedrctsale.getpincode(city_gid)
            pincd.then(function(result) {
                    if (type == 'address') {
                        var apincde = [];
                        apincde = JSON.parse(result.data);
                        $scope.add.pincode1 = apincde[0].pincode_no;
                    } else {
                        var pincde = [];
                        pincde = JSON.parse(result.data);
                        $scope.pcode = pincde[0].pincode_no;
                    }
                }),
                function() {
                    alert('No data!.');
                };
        };

        $scope.addclientdetails=function(e){

        if(e==undefined){
        $scope.client_addline="";
        $scope.client_addline2="";
        $scope.client_addline3="";
        }else{
         $scope.client_addline=e.addline;
        $scope.client_addline2=e.addline2;
        $scope.client_addline3=e.addline3;
        }

            var data = {
                "Params": {
                    "Partnerclient_Partnergid": $scope.partner_gid,
                    "Address_1":$scope.client_addline,
                    "Address_2": $scope.client_addline2,
                   "Address_3": $scope.client_addline3,
                   "Address_Pincode": e.pincode1,
                   "Address_District_gid":e.addselecteddistrict,
                   "Address_City_gid": e.addselectedcity,
                   "Address_State_gid": $scope.client_stategid,
                   "Partnerclient_Name": e.name,

                },
                "Classification": {
                    "Create_By":detail.employee_gid,
                    "Entity_Gid": $scope.entity_gid,
                },
            }
            var details = {
               Group: 'ClientDetails_ADD',
               Action: 'INSERT',
               Type:"",
               data: data,
            }
            $scope.loading();
                var set_clientdetails = Servicedrctsale.clientaddService(details)
                set_clientdetails.then(function(result) {
                    $scope.clientgroup = result.data.MESSAGE;
                    if( $scope.clientgroup=="SUCCESS"){
                    alert("SUCCESSFULLY INSERTED");
                    modalhide('ClientAddPopup');
                    $scope.add.name="",
                    $scope.add.addline="",
                    $scope.add.addline2="",
                    $scope.add.addline3="",
                    $scope.add.addselectedstate="",
                    $scope.add.addselecteddistrict="",
                    $scope.add.addselectedcity="",
                    $scope.add.pincode1="",
                    getclient_details();

                    }
                    else{
                    alert(JSON.stringify($scope.clientgroup));
                     modalshow('ClientAddPopup')
                    }


                }),
            function(err) {
                alert('no data');
            }.finally($scope.endloading());
        }
        getclient_details();
        function getclient_details(){
        var data = {
                "Params": {
                    "Partnerclient_Partnergid":$scope.partner_gid,
                    "Mst_Table": $scope.msttable,
                },
                "Classification": {
                    "Entity_Gid": $scope.entity_gid,
                },
            }
            var details = {
               Group: 'ClientDetails_GET',
               Action: 'Partnerclient_Get',
               Type:"",
               data: data,
            }
                var get_clientdetails = Servicedrctsale.clientgetService(details)
                get_clientdetails.then(function(result) {
                    $scope.clientgetgroup = result.data.DATA;
                    $scope.clientgropename=$scope.clientgetgroup;

                }),
            function(err) {
                alert('no data');
            };

        }
     $scope.change_clientname=function(e){

        $scope.clientgetgroup = $filter('filter')($scope.clientgropename , {
               "partnerclient_name": e.name

        });
        }

        $scope.client_edit_data=function(e){
        modalshow('ClientAddPopup')
        $scope.clientsubmit=false;
        $scope.clientupdate=true;
            $scope.clientgid=e.partnerclient_gid,
            $scope.add.name=e.partnerclient_name,
            $scope.add.addline=e.address_1,
            $scope.add.addline2=e.address_2,
            $scope.add.addline3=e.address_3,
            $scope.add.addselectedstate=e.address_state_gid,
            $scope.state_clk(e.address_state_gid,'address');
            $scope.add.addselecteddistrict = e.address_district_gid;
            $scope.district_clk(e.address_district_gid,'address')
            $scope.add.addselectedcity=e.address_city_gid,
            $scope.add.pincode1=e.address_pincode
        }
        $scope.view_clientdetails=function(e){
        modalshow('ClientAddPopup')
        $scope.clientsubmit=false;
        $scope.clientupdate=false;



            $scope.clientgid=e.partnerclient_gid,
            $scope.add.name=e.partnerclient_name,
            $scope.add.addline=e.address_1,
            $scope.add.addline2=e.address_2,
            $scope.add.addline3=e.address_3,
            $scope.add.addselectedstate=e.address_state_gid,
            $scope.state_clk(e.address_state_gid,'address');
            $scope.add.addselecteddistrict = e.address_district_gid;
            $scope.district_clk(e.address_district_gid,'address')
            $scope.add.addselectedcity=e.address_city_gid,
            $scope.add.pincode1=e.address_pincode
        }
    $scope.updateclientdetails=function(e){

    if( $scope.client_stategid){
    $scope.update_stategid= $scope.client_stategid;
    }
    else{
      $scope.update_stategid=$scope.add.addselectedstate;
    }
    if( $scope.client_districtgid){
    $scope.update_districtgid= $scope.client_districtgid;
    }
    else{
       $scope.update_districtgid=$scope.add.addselecteddistrict
    }
    if($scope.client_citygid){
     $scope.update_citygid=  $scope.client_citygid
    }
    else{
    $scope.update_citygid=  $scope.add.addselectedcity
    }

        var data = {
                "Params": {
                    "Partnerclient_Gid":$scope.clientgid,
                    "Address_1":$scope.add.addline,
                    "Address_2":$scope.add.addline2,
                    "Address_3":$scope.add.addline3,
                    "Address_Pincode":$scope.add.pincode1,
                    "Address_District_gid":  $scope.update_districtgid,
                    "Address_City_gid":$scope.update_citygid,
                    "Address_State_gid": $scope.update_stategid,
                    "Partnerclient_Name":$scope.add.name
                },
                "Classification": {
                   "Update_By":$scope.create_by,
                },
        }
            var details = {
               Group: 'ClientDetails_Update',
               Action: 'UPDATE',
               Type:"",
               data: data,
            }
            $scope.loading();
                var update_clientdetails = Servicedrctsale.clientupdateService(details)
                update_clientdetails.then(function(result) {
                    $scope.clientgetgroup = result.data;
                    if($scope.clientgetgroup=="SUCCESS"){
                    alert("SUCCESSFULLY UPDATED");
                    getclient_details();
                    modalhide('ClientAddPopup')
                    }else{
                    alert(JSON.stringify($scope.clientgetgroup));
                    getclient_details();
                    modalshow('ClientAddPopup')
                    }
                }),
            function(err) {
                alert('no data');
            }.finally($scope.endloading());

    }

//ClientDetails End Page...!

//ContractDetails Start Page...!
$scope.addcontract=[];
$scope.addcontractpagepopup=function(){
$scope.addcontracts=true;
 $scope.editcontract=false;
 $scope.truefalse =false,
  $scope.addcontract.code="",
 $scope.addcontract.name="",
 $scope.addcontract.service="",
 $scope.addcontract.remarks="",
 modalshow('ContractAddPopup')

}
$scope.updatecontract=function(e){

    var data = {
        "Params": {
            "Partnercontractor_Gid":$scope.partnercontractgid,
             "Partnercontractor_Name":$scope.addcontract.name,
             "Partnercontractor_Service":$scope.addcontract.service,
            "Partnercontractor_Remarks":$scope.addcontract.remarks,

                },
                "Classification": {
                   "Update_By":$scope.create_by,
                },
        }
            var details = {
               Group: 'ContractDetails_Update',
               Action: 'UPDATE',
               Type:"",
               data: data,
            }
                var update_contractdetails = Servicedrctsale.contractupdateService(details)
                update_contractdetails.then(function(result) {
                    $scope.contractgroup = result.data;

                    if($scope.contractgroup=="SUCCESS"){
                    alert("SUCCESSFULLY UPDATED");
                    getcontractdetails();
                    modalhide('ContractAddPopup')
                    }else{
                    alert(JSON.stringify($scope.contractgroup));
                    modalshow('ContractAddPopup')
                    }



                }),
            function(err) {
                alert('no data');
            };

}

$scope.addpartnercontract=function(e){

        var data = {
                "Params": {
                    "Partnercontractor_Partnergid":$scope.partner_gid,
                    "Partnercontractor_Code":e.code,
                    "Partnercontractor_Name":e.name,
                    "Partnercontractor_Service":e.service,
                    "Partnercontractor_Remarks":e.remarks,

                },
                "Classification": {
                   "Create_By":$scope.create_by,
                    "Entity_Gid": $scope.entity_gid,
                },
        }
        var details = {
               Group: 'ContractDetails_SET',
               Action: 'INSERT',
               Type:"",
               data: data,
        }
        $scope.loading();
                var set_contractdetails = Servicedrctsale.contractsetService(details)
                set_contractdetails.then(function(result) {
                    $scope.clientgetgroup = result.data.MESSAGE;
                    if( $scope.clientgetgroup == "SUCCESS"){
                    alert("SUCCESSFULLY INSERTED");
                    $scope.addcontract.code="";
                    $scope.addcontract.name="";
                    $scope.addcontract.service="";
                    $scope.addcontract.remarks="";
                    modalhide('ContractAddPopup');
                    getcontractdetails();
                    }else{
                    alert(JSON.stringify($scope.clientgetgroup))
                         modalshow('ContractAddPopup')
                    }

                }),
            function(err) {
                alert('no data');
            }.finally($scope.endloading());

}
getcontractdetails();
function getcontractdetails(){

        var data = {
                "Params": {
                "Partnercontractor_Partnergid":$scope.partner_gid,
                "Mst_Table": $scope.msttable,
                },
                "Classification": {

                    "Entity_Gid": $scope.entity_gid,
                },
        }
        var details = {
               Group: 'ContractDetails_GET',
               Action: 'Partnercontractor_Get',
               Type:"",
               data: data,
        }
                var GET_contractdetails = Servicedrctsale.contractgetService(details)
                GET_contractdetails.then(function(result) {
                    $scope.contractgetgroup = result.data.DATA;
                    $scope.searchcontractdetails=$scope.contractgetgroup;
                    //alert(JSON.stringify($scope.contractgetgroup))


                }),
            function(err) {
                alert('no data');
            };

}

$scope.contractchange=function(e){

        $scope.contractgetgroup = $filter('filter')($scope.searchcontractdetails , {
               "partnercontractor_code": e.code,
               "partnercontractor_name": e.name,
               "partnercontractor_service": e.service,
               "partnercontractor_remarks": e.remarks

        });
        }

 $scope.contractedit_data=function(e){

 $scope.partnercontractgid=e.partnercontractor_gid;
 $scope.addcontracts=false;
 $scope.editcontract=true;
  $scope.truefalse = true;
 $scope.addcontract.code=e.partnercontractor_code;
 $scope.addcontract.name=e.partnercontractor_name;
 $scope.addcontract.service=e.partnercontractor_service;
 $scope.addcontract.remarks=e.partnercontractor_remarks;
 modalshow('ContractAddPopup')

 }
//ContractDetails End Page...!

//Branch Details Start Page...!
$scope.addbranchpagepopup=function(){
$scope.showbranchsubmit=true;
$scope.showbranchupdate=false;
 $scope.add.addline="";
                    $scope.add.addline2="";
                    $scope.add.pincode1="";
                    $scope.add.addline3="";
                    $scope.add.addselectedstate="";
                    $scope.add.addselecteddistrict="";
                    $scope.add.addselectedcity="";
                    $scope.add.cntcttype="";
                    $scope.add.prsnname="";
                    $scope.add.dsgntn="";
                    $scope.add.lndlne="";
                    $scope.add.lndlne2="";
                    $scope.add.mobno="";
                    $scope.add.mobno2="";
                    $scope.add.mailid="";
                    $scope.add.dobb="";
                    $scope.add.weddy="";
                    $scope.add.branchcode="";
                    $scope.add.branchname="";
                    $scope.add.branchremarks="";
modalshow('BranchAddPopup')
}
$scope.addbranchdetails=function(a){
    if($scope.add.branchname ==  undefined || $scope.add.branchname ==  '' ){
         alert('Please Enter Branch Name');
            return false;
    }

 var data = {
                "Params": {
                    "PartnerBranch_Partner_Gid":$scope.partner_gid,
                    "Address_1":$scope.add.addline,
                    "Address_2":$scope.add.addline2,
                    "Address_Pincode":$scope.add.pincode1,
                    "Address_3":$scope.add.addline3,
                    "Address_State_Gid":$scope.client_stategid,
                    "Address_District_Gid":a.addselecteddistrict,
                    "Address_City_Gid": a.addselectedcity,
                    "Contact_ContactType_Gid": $scope.add.cntcttype,
                    "Contact_PersonName":$scope.add.prsnname,
                    "Contact_Designation_Gid":$scope.add.dsgntn,
                    "Contact_LandLine": $scope.add.lndlne,
                    "Contact_LandLine2":$scope.add.lndlne2,
                    "Contact_MobileNo": $scope.add.mobno,
                    "Contact_MobileNo2":$scope.add.mobno2,
                    "Contact_Email": $scope.add.mailid,
                    "Contact_DOB":$scope.add.dobb,
                    "Contact_WD":$scope.add.weddy,
                    "PartnerBranch_Code":$scope.add.branchcode,
                    "PartnerBranch_Name":$scope.add.branchname,
                    "PartnerBranch_Remarks":$scope.add.branchremarks,

                },
                "Classification": {
                   "Entity_Gid":$scope.entity_gid,
                   "Create_By":$scope.create_by,
                },
        }
            var details = {
               Group: 'BranchDetails_Set',
               Action: 'Atma_Branch_Insert',
               Type:"",
               data: data,
            }
                            $scope.loading();
                var set_branchdetails = Servicedrctsale.branchsetService(details)
                set_branchdetails.then(function(result) {

                    $scope.branchgetgroup = result.data.MESSAGE;
                    if($scope.branchgetgroup=="SUCCESS"){
                    alert("SUCCESSFULLY INSERTED");
                    $scope.add.addline="";
                    $scope.add.addline2="";
                    $scope.add.pincode1="";
                    $scope.add.addline3="";
                    $scope.add.addselectedstate="";
                    $scope.add.addselecteddistrict="";
                    $scope.add.addselectedcity="";
                    $scope.add.cntcttype="";
                    $scope.add.prsnname="";
                    $scope.add.dsgntn="";
                    $scope.add.lndlne="";
                    $scope.add.lndlne2="";
                    $scope.add.mobno="";
                    $scope.add.mobno2="";
                    $scope.add.mailid="";
                    $scope.add.dobb="";
                    $scope.add.weddy="";
                    $scope.add.branchcode="";
                    $scope.add.branchname="";
                    $scope.add.branchremarks="";
                    modalhide('BranchAddPopup')
                    getbranchdetails();
                    }else{
                    alert($scope.branchgetgroup);
                    getbranchdetails();
                    modalshow('BranchAddPopup')
                    }
                }),
            function(err) {
                alert('no data');
            }.finally($scope.endloading());

}


getbranchdetails();
function getbranchdetails(){


        var data = {
                "Params": {
                    "Branch_PartnerGid":$scope.partner_gid,
                    "Mst_Table": $scope.msttable,
                },
                "Classification": {

                    "Entity_Gid": $scope.entity_gid,
                },
        }
        var details = {
               Group: 'BranchDetails_GET',
               Action: 'Atma_Branch_Get',
               Type:"",
               data: data,
        }
            $scope.branchgetgroup_get = {}

                var GET_branchdetails = Servicedrctsale.branchgetService(details)
                GET_branchdetails.then(function(result) {
                 $scope.branchgetgroup_get = []

                   if(result.data.DATA != undefined){
                       $scope.branchgetgroup_get =result.data.DATA;
                       //alert(JSON.stringify($scope.branchgetgroup_get));
                   }else{
                         $scope.branchgetgroup_get = []
                   }
                    //$scope.branchgetgroup_get1 = result.data.MESSAGE;
                    //$scope.d=JSON.stringify($scope.branchgetgroup_get1);
                    //alert($scope.d);
                    $scope.searchbranchdetails=$scope.branchgetgroup_get;
                    //alert(JSON.stringify($scope.branchgetgroup_get));



                }),
            function(err) {
                alert('no data');
            };

}

$scope.change_branch=function(e){

        $scope.branchgetgroup_get = $filter('filter')($scope.searchbranchdetails , {
               "partnerbranch_code": e.code,
               "partnerbranch_name": e.name

        });
}
$scope.branchtedit_data=function(e){

$scope.showbranchsubmit=false;
$scope.showbranchupdate=true;
        $scope.partnerbranch_Gid=e.partnerbranch_gid;
        $scope.add.addline=e.address_1;
        $scope.add.addline2=e.address_2;
        $scope.add.pincode1=e.address_pincode;
        $scope.add.addline3=e.address_3;
        $scope.add.addselectedstate=e.address_state_gid;
        $scope.add.addselectedstate=e.address_state_gid,
        $scope.state_clk(e.address_state_gid,'address');
        $scope.add.addselecteddistrict = e.address_district_gid;
        $scope.district_clk(e.address_district_gid,'address'),
         $scope.add.addselectedcity=e.address_city_gid,
        $scope.add.cntcttype=e.Contact_contacttype_gid;
        $scope.add.prsnname=e.Contact_personname;
        $scope.add.dsgntn=e.Contact_designation_gid;
        $scope.add.lndlne=e.Contact_landline;
        $scope.add.lndlne2=e.Contact_landline2;
        $scope.add.mobno=e.Contact_mobileno;
        $scope.add.mobno2=e.Contact_mobileno2;
        $scope.add.mailid=e.Contact_email;
        if (e.Contact_DOB==null)  {
            $scope.add.dobb=null;
        }else
        {
            $scope.add.dobb=new Date(e.Contact_DOB);
        }
        if (e.Contact_WD==null)
        {
            $scope.add.weddy=null;
        }
        else
        {
            $scope.add.weddy=new Date(e.Contact_WD);
        }

        $scope.add.branchcode=e.partnerbranch_code;
        $scope.add.branchname=e.partnerbranch_name;
        $scope.add.branchremarks=e.partnerbranch_remarks;
        modalshow('BranchAddPopup')
}
$scope.view_branchdetails=function(e){
$scope.showbranchsubmit=false;
$scope.showbranchupdate=false;

        if (e.Contact_DOB){
                $scope.Contact_DOB1 =  formatStringDate( new Date(e.Contact_DOB), 'yyyy-mm-dd');
             }
             else
             {
                $scope.Contact_DOB1= null;
             }

         if (e.Contact_WD){
                $scope.Contact_WD1 =  formatStringDate( new Date(e.Contact_WD), 'yyyy-mm-dd');
             }
             else
             {
                $scope.Contact_WD1= null;
             }
        $scope.partnerbranch_Gid=e.partnerbranch_gid;
        $scope.add.addline=e.address_1;
        $scope.add.addline2=e.address_2;
        $scope.add.pincode1=e.address_pincode;
        $scope.add.addline3=e.address_3;
        $scope.add.addselectedstate=e.address_state_gid;
        $scope.add.addselectedstate=e.address_state_gid,
        $scope.state_clk(e.address_state_gid,'address');
        $scope.add.addselecteddistrict = e.address_district_gid;
        $scope.district_clk(e.address_district_gid,'address'),
         $scope.add.addselectedcity=e.address_city_gid,
        $scope.add.cntcttype=e.Contact_contacttype_gid;
        $scope.add.prsnname=e.Contact_personname;
        $scope.add.dsgntn=e.Contact_designation_gid;
        $scope.add.lndlne=e.Contact_landline;
        $scope.add.lndlne2=e.Contact_landline2;
        $scope.add.mobno=e.Contact_mobileno;
        $scope.add.mobno2=e.Contact_mobileno2;
        $scope.add.mailid=e.Contact_email;
        $scope.add.dobb=$scope.Contact_DOB1;
        $scope.add.weddy=$scope.Contact_WD1;
        $scope.add.branchcode=e.partnerbranch_code;
        $scope.add.branchname=e.partnerbranch_name;
        $scope.add.branchremarks=e.partnerbranch_remarks;
        modalshow('BranchAddPopup')
}
$scope.updatebranchdetails=function(e){



if( $scope.client_stategid){
    $scope.update_branchstategid= $scope.client_stategid;
    }
    else{
      $scope.update_branchstategid=$scope.add.addselectedstate;
    }
    if( $scope.client_districtgid){
    $scope.update_branchdistrictgid= $scope.client_districtgid;
    }
    else{
       $scope.update_branchdistrictgid=$scope.add.addselecteddistrict
    }
    if($scope.client_citygid){
     $scope.update_branchcitygid=  $scope.client_citygid
    }
    else{
    $scope.update_branchcitygid=  $scope.add.addselectedcity
    }
    if ($scope.add.dobb){
     $scope.update_branchdobdate = formatStringDate( $scope.add.dobb, 'yyyy-mm-dd');
     }
     else
     {
     $scope.update_branchdobdate=null;
     }
     if ($scope.add.weddy){
     $scope.update_branch_wddate = formatStringDate( $scope.add.weddy, 'yyyy-mm-dd');
     }
     else
     {
     $scope.update_branch_wddate=null;
     }
var data = {
                "Params": {
                    "PartnerBranch_Gid":$scope.partnerbranch_Gid,
                    "Address_1":e.addline,
                    "Address_2":e.addline2,
                    "Address_PinCode":e.pincode1,
                    "Address_3":e.addline3,
                    "Address_State_Gid":$scope.update_branchstategid,
                    "Address_District_Gid":$scope.update_branchdistrictgid,
                    "Address_City_Gid": $scope.update_branchcitygid,
                    "PartnerBranch_Code":$scope.add.branchcode,
                    "PartnerBranch_Name":$scope.add.branchname,
                    "PartnerBranch_Remarks":$scope.add.branchremarks,
                    "Contact_ContactType_Gid": $scope.add.cntcttype,
                   "Contact_PersonName": $scope.add.prsnname,
                   "Contact_Designation_Gid": $scope.add.dsgntn,
                   "Contact_LandLine": $scope.add.lndlne,
                   "Contact_LandLine2": $scope.add.lndlne2,
                   "Contact_MobileNo": $scope.add.mobno,
                   "Contact_MobileNo2": $scope.add.mobno2,
                   "Contact_Email": $scope.add.mailid,
                   "Contact_DOB": $scope.update_branchdobdate,
                   "Contact_WD":$scope.update_branch_wddate

                },
                "Classification": {
                   "Update_By":$scope.create_by,
                },
        }
            var details = {
               Group: 'BranchDetails_Update',
               Action: 'BRANCH_UPDATE',
               Type:"",
               data: data,
            }
            $scope.loading();
                var update_branchdetails = Servicedrctsale.branchupdateService(details)
                update_branchdetails.then(function(result) {
                    $scope.branchupdategroup = result.data;
                    if($scope.branchupdategroup=="SUCCESS"){
                    alert("SUCCESSFULLY UPDATED");
                    modalhide('BranchAddPopup')
                    getbranchdetails();
                    }else{
                    alert(JSON.stringify($scope.branchupdategroup));
                    getbranchdetails();
                    modalshow('BranchAddPopup')
                    }
                }),
            function(err) {
                alert('no data');
            }.finally($scope.endloading());


}

//Branch Details End Page...!
//Basic Profile Details Start Page...!
$scope.basicprofile=[];
$scope.change_basicprofile=function(e){

$scope.employeeparmanentcount=parseInt(e.partnerprofile_noofempper);
$scope.employeetemporarycount=parseInt(e.partnerprofile_noofemptmp);
$scope.basicprofile.partnerprofile_totemp=parseInt($scope.employeeparmanentcount) + parseInt($scope.employeetemporarycount);
}

$scope.addbasicprofile=function(e){

var data = {
                "Params": {
                    "Partnerprofile_Partnergid":$scope.partner_gid,
                    "Partnerprofile_Noofyears":$scope.basicprofile.partnerprofile_noofyears,
                    "Partnerprofile_Associateyears":$scope.basicprofile.partnerprofile_associateyears,
                    "Partnerprofile_Awarddetails":$scope.basicprofile.partnerprofile_awarddetails,
                    "Partnerprofile_Noofempper":$scope.basicprofile.partnerprofile_noofempper,
                    "Partnerprofile_Noofemptmp":$scope.basicprofile.partnerprofile_noofemptmp,
                    "Partnerprofile_Totemp": $scope.basicprofile.partnerprofile_totemp,
                    "Partnerprofile_Branchcount": $scope.basicprofile.partnerprofile_branchcount,
                    "Partnerprofile_Factorycount":$scope.basicprofile.partnerprofile_factorycount,
                    "Partnerprofile_Remarks":$scope.basicprofile.partnerprofile_remarks,


                },
                "Classification": {
                   "Entity_Gid":$scope.entity_gid,
                   "Create_By":$scope.create_by,
                },
        }
            var details = {
               Group: 'BasicProfile_Set',
               Action: '',
               Type:"",
               data: data,
            }
            $scope.loading();
                var set_basicprofiledetails = Servicedrctsale.basicprofilesetService(details)
                set_basicprofiledetails.then(function(result) {
                    $scope.basicprofilesetgroup = result.data.MESSAGE;
                    if($scope.basicprofilesetgroup == "SUCCESS"){

                    if($scope.partnerprofile_branchcount == undefined || $scope.partnerprofile_branchcount == ''){
                    $scope.brach_count=1;
                    }
                    else{
                    $scope.brach_count= parseInt($scope.basicprofile.partnerprofile_branchcount) + 1;
                      alert($scope.brach_count)
                    }
                    }
                    alert(JSON.stringify($scope.basicprofilesetgroup))
                    if($scope.basicprofilesetgroup=="SUCCESSFULLY UPDATED"){
                    getbasicprofiledetails();
                    }
                }),
            function(err) {
                alert('no data');
            }.finally($scope.endloading());

}
getbasicprofiledetails();
function getbasicprofiledetails(){

var data = {
                "Params": {
                    "Partnerprofile_Partnergid":$scope.partner_gid,
                    "Mst_Table": $scope.msttable,
                },
                "Classification": {
                   "Entity_Gid":$scope.entity_gid,
                },
        }
            var details = {
               Group: 'Partnerprofile_Get',
               Action: 'Partnerprofile_Get',
               Type:"",
               data: data,
            }
                var get_basicprofiledetails = Servicedrctsale.basicprofilegetService(details)
                get_basicprofiledetails.then(function(result) {
                //alert(result.data.DATA[0].partnerprofile_gid)

                    $scope.basicprofiles = result.data.MESSAGE;
                    //alert( $scope.basicprofile.partnerprofile_gid)
                    //alert(JSON.stringify($scope.basicprofiles))
                    if($scope.basicprofiles=="NOT_FOUND"){
                     $scope.brach_count=1;
                    //alert($scope.brach_count);
                    }else{
                    $scope.basicprofile = result.data.DATA[0];
                    }
                    if($scope.basicprofile.partnerprofile_branchcount >= 0){
                    $scope.brach_count=$scope.basicprofile.partnerprofile_branchcount + 1;
                    //alert($scope.brach_count);
                    }
                    //alert(JSON.stringify($scope.basicprofile.partnerprofile_branchcount))
                }),
            function(err) {
                alert('no data');
            };

}


$scope.showbranchadd=true;
<!--$scope.brach_count=1;-->
//Basic Profile Details End Page...!
//PARTNERPRODUCT START PAGE
$scope.profileproduct = [];
$rootScope.partnerprofilepopup_add = function() {
            $scope.btnProfileProduct_Save = true;
            $scope.btnProfileProduct_Update = false;
            $scope.profileproduct.producttype = "";
            $scope.profileproduct.name = "";
            $scope.profileproduct.personname1 = "";
            $scope.profileproduct.personname2 = "";
            $scope.profileproduct.personname3 = "";
            $scope.profileproduct.personname4 = "";
            $scope.profileproduct.contacttype1 = "";
            $scope.profileproduct.designation1 = "";
            $scope.profileproduct.landline1 = "";
            $scope.profileproduct.landline2_1 = "";
            $scope.profileproduct.mobilenumber1 = "";
            $scope.profileproduct.mobilenumber2_1 = "";
            $scope.profileproduct.emailid1 = "";
            $scope.profileproduct.dobb1 = "";
            $scope.profileproduct.weddy1 = "";
            $scope.profileproduct.contacttype2 = "";
            $scope.profileproduct.designation2 = "";
            $scope.profileproduct.landline2 = "";
            $scope.profileproduct.landline2_2 = "";
            $scope.profileproduct.mobilenumber2 = "";
            $scope.profileproduct.mobilenumber2_2 = "";
            $scope.profileproduct.emailid2 = "";
            $scope.profileproduct.dobb2 = "";
            $scope.profileproduct.weddy2 = "";
            $scope.profileproduct.contacttype3 = "";
            $scope.profileproduct.designation3 = "";
            $scope.profileproduct.landline3 = "";
            $scope.profileproduct.landline2_3 = "";
            $scope.profileproduct.mobilenumber3 = "";
            $scope.profileproduct.mobilenumber2_3 = "";
            $scope.profileproduct.emailid3 = "";
            $scope.profileproduct.dobb3 = "";
            $scope.profileproduct.weddy3 = "";
            $scope.profileproduct.contacttype4 = "";
            $scope.profileproduct.designation4 = "";
            $scope.profileproduct.landline4 = "";
            $scope.profileproduct.landline2_4 = "";
            $scope.profileproduct.mobilenumber4 = "";
            $scope.profileproduct.mobilenumber2_4 = "";
            $scope.profileproduct.emailid4 = "";
            $scope.profileproduct.weddy4 = "";
            $scope.profileproduct.age = "";
            modalshow('popup_product');
        }
        var datan = {
            "Table_name": "gal_mst_tmetadata",
            "Column_1": "metadata_value,metadata_gid",
            "Column_2": "",
            "Where_Common": "metadata",
            "Where_Primary": "columnname",
            "Primary_Value": "partnerproduct_type",
            "Order_by": "value"
        }
        var partnerprod = {
            Action: "",
            Entity_Gid: $scope.entity,
            data: datan
        }
        $scope.partnerproduct = [];
        var getpartnerproduct = Servicedrctsale.getpartnerprodtact(partnerprod)
        getpartnerproduct.then(function(result) {
            $scope.partnerproduct = result.data.DATA;
        }, function(err) {}).finally();
        var datan = {
            "Table_name": "gal_mst_tdesignation",
            "Column_1": "designation_gid,designation_name",
            "Column_2": "",
            "Where_Common": "designation",
            "Where_Primary": "designation_gid",
            "Primary_Value": "",
            "Order_by": "code"
        }
        var pdesig = {
            Action: "",
            Entity_Gid: $scope.entity_gid,
            data: datan
        }
        $scope.product_desig = [];
        var getdesig = Servicedrctsale.getdesigdata(pdesig)
        getdesig.then(function(result) {
            $scope.product_desig = result.data.DATA;
        }, function(err) {
            alert('No data!.');
        }).finally();
        var data = {
            "Table_name": "gal_mst_tcontacttype",
            "Column_1": "contacttype_gid,contacttype_Name",
            "Column_2": "",
            "Where_Common": "contacttype",
            "Where_Primary": "contacttype_gid",
            "Primary_Value": "",
            "Order_by": "gid"
        }
        var pcont = {
            Action: "",
            Entity_Gid: $scope.entity_gid,
            data: data
        }
        $scope.contacttype = [];
        var getcont = Servicedrctsale.getcontdata(pcont)
        getcont.then(function(result) {
            $scope.contacttype = result.data.DATA;
        }, function(err) {
            alert('No data!.');
        }).finally();
        $scope.saveproduct = function(profileproduct) {

        if($scope.profileproduct.producttype ==  undefined || $scope.profileproduct.producttype ==  '' ){
         alert('Please Select Product Type');
            return false;
        }
        if($scope.profileproduct.name ==  undefined || $scope.profileproduct.name ==  '' ){
         alert('Please Enter Product Name');
            return false;
        }
        //contact 1
        if($scope.profileproduct.contacttype1 ==  undefined || $scope.profileproduct.contacttype1 ==  '' ){
            alert('Please Select Client Contact 1- Contact Type');
            return false;
        }
        if($scope.profileproduct.contacttype1 ==  undefined || $scope.profileproduct.contacttype1 ==  '' ){
            alert('Please Select Client Contact 1 - Contact Type');
            return false;
        }
        if($scope.profileproduct.personname1 ==  undefined || $scope.profileproduct.personname1 ==  '' ){
            alert('Please Enter Client Contact 1 - Person Name ');
            return false;
        }
        if($scope.profileproduct.designation1 ==  undefined || $scope.profileproduct.designation1 ==  '' ){
            alert('Please Select Client Contact 1 - Designation Name ');
            return false;
        }
        if($scope.profileproduct.mobilenumber1 ==  undefined || $scope.profileproduct.mobilenumber1 ==  '' ){
            alert('Please Enter Client Contact 1 - Mobile Number ');
            return false;
        }
        //contact 1
        if($scope.profileproduct.contacttype1 ==  undefined || $scope.profileproduct.contacttype1 ==  '' ){
            alert('Please Select Client Contact 2- Contact Type');
            return false;
        }
        if($scope.profileproduct.contacttype1 ==  undefined || $scope.profileproduct.contacttype1 ==  '' ){
            alert('Please Select Client Contact 2 - Contact Type');
            return false;
        }
        if($scope.profileproduct.personname1 ==  undefined || $scope.profileproduct.personname1 ==  '' ){
            alert('Please Enter Client Contact 2 - Person Name ');
            return false;
        }
        if($scope.profileproduct.designation1 ==  undefined || $scope.profileproduct.designation1 ==  '' ){
            alert('Please Select Client Contact 2 - Designation Name ');
            return false;
        }
        if($scope.profileproduct.mobilenumber1 ==  undefined || $scope.profileproduct.mobilenumber1 ==  '' ){
            alert('Please Enter Client Contact 2 - Mobile Number ');
            return false;
        }


            var data = {
                "Params": {
                    "PartnerProduct_Partner_Gid": $scope.partner_gid,
                    "Client_Contact_ContactType_Gid": profileproduct.contacttype1,
                    "Client_Contact_PersonName": profileproduct.personname1,
                    "Client_Contact_Designation_Gid": profileproduct.designation1,
                    "Client_Contact_LandLine": profileproduct.landline1,
                    "Client_Contact_LandLine2": profileproduct.landline2_1,
                    "Client_Contact_MobileNo": profileproduct.mobilenumber1,
                    "Client_Contact_MobileNo2": profileproduct.mobilenumber2_1,
                    "Client_Contact_Email": profileproduct.emailid1,
                    "Client_Contact_DOB":profileproduct.dobb1,
                    "Client_Contact_WD": profileproduct.weddy1,
                    "Client_Contact_ContactType_Gid_2": profileproduct.contacttype2,
                    "Client_Contact_PersonName_2": profileproduct.personname2,
                    "Client_Contact_Designation_Gid_2": profileproduct.designation2,
                    "Client_Contact_LandLine_2": profileproduct.landline2,
                    "Client_Contact_LandLine2_2": profileproduct.landline2_2,
                    "Client_Contact_MobileNo_2": profileproduct.mobilenumber2,
                    "Client_Contact_MobileNo2_2": profileproduct.mobilenumber2_2,
                    "Client_Contact_Email_2": profileproduct.emailid2,
                    "Client_Contact_DOB_2": profileproduct.dobb2,
                    "Client_Contact_WD_2": profileproduct.weddy2,
                    "Customer_Contact_ContactType_Gid": profileproduct.contacttype3,
                    "Customer_Contact_PersonName": profileproduct.personname3,
                    "Customer_Contact_Designation_Gid": profileproduct.designation3,
                    "Customer_Contact_LandLine": profileproduct.landline3,
                    "Customer_Contact_LandLine2": profileproduct.landline2_3,
                    "Customer_Contact_MobileNo": profileproduct.mobilenumber3,
                    "Customer_Contact_MobileNo2": profileproduct.mobilenumber2_3,
                    "Customer_Contact_Email": profileproduct.emailid3,
                    "Customer_Contact_DOB": profileproduct.dobb3,
                    "Customer_Contact_WD": profileproduct.weddy3,
                    "Customer_Contact_ContactType_Gid_2": profileproduct.contacttype4,
                    "Customer_Contact_PersonName_2": profileproduct.personname4,
                    "Customer_Contact_Designation_Gid_2": profileproduct.designation4,
                    "Customer_Contact_LandLine_2": profileproduct.landline4,
                    "Customer_Contact_LandLine2_2": profileproduct.landline2_4,
                    "Customer_Contact_MobileNo_2": profileproduct.mobilenumber4,
                    "Customer_Contact_MobileNo2_2": profileproduct.mobilenumber2_4,
                    "Customer_Contact_Email_2": profileproduct.emailid4,
                    "Customer_Contact_DOB_2": profileproduct.dobb4,
                    "Customer_Contact_WD_2": profileproduct.weddy4,
                    "PartnerProduct_Type": profileproduct.producttype,
                    "PartnerProduct_Name": profileproduct.name,
                    "PartnerProduct_Age": profileproduct.age,
                },
                "Classification": {
                    "Create_By": $scope.create_by,
                    "Entity_Gid": $scope.entity_gid,
                },
            }
            var total = {
                Group: 'Partner Product',
                Action: 'Atma_Product_Insert',
                Type: 'Partner Product',
                data: data
            }
            $scope.partnerprofile = [];
            $scope.loading();
            var set_partnerprofile = Servicedrctsale.PartnerProductSet(total)
            set_partnerprofile.then(function(result) {

                    $scope.partnerprofile = result.data.MESSAGE;
                    if($scope.partnerprofile == "SUCCESS"){
                    alert("SUCCESSFULLY INSERTED ");
                    modalhide('popup_product');
                    loadData_PartnerProfileProduct();
                    }else{
                    alert(JSON.stringify(result.data.MESSAGE));
                    }
                }),
                function(err) {
                    alert('no data');
                }.finally($scope.endloading());
        }
        $scope.showviewprof = function(prof) {
            $scope.profileproduct.producttype = prof.partnerproduct_type;
            $scope.profileproduct.name = prof.partnerproduct_name;
            $scope.profileproduct.personname1 = prof.Contact_personname;
            $scope.profileproduct.personname2 = prof.Contact_personname_2;
            $scope.profileproduct.personname3 = prof.Contact_personname_3;
            $scope.profileproduct.personname4 = prof.Contact_personname_4;
            modalshow('partnerprofile_view_page');
        }
        $scope.edit_partnerprofileproduct = function(prof) {

             $scope.disabeld_pproduct=false;
            $scope.btnProfileProduct_Save = false;
            $scope.btnProfileProduct_Update = true;
            $scope.profileproduct.partnerproduct_gid=prof.partnerproduct_gid;
            $scope.profileproduct.contacttype1 = prof.Contact_contacttype_gid;
            $scope.profileproduct.contacttype2 = prof.Contact_contacttype_gid_2;
            $scope.profileproduct.contacttype3 = prof.Contact_contacttype_gid_3;
            $scope.profileproduct.contacttype4 = prof.Contact_contacttype_gid_4;
            $scope.profileproduct.producttype = prof.partnerproduct_type;
            $scope.profileproduct.name = prof.partnerproduct_name;
            $scope.profileproduct.personname1 = prof.Contact_personname;
            $scope.profileproduct.personname2 = prof.Contact_personname_2;
            $scope.profileproduct.personname3 = prof.Contact_personname_3;
            $scope.profileproduct.personname4 = prof.Contact_personname_4;
            $scope.profileproduct.designation1 = prof.Contact_designation_gid;
            $scope.profileproduct.designation2 = prof.Contact_designation_gid_2;
            $scope.profileproduct.designation3 = prof.Contact_designation_gid_3;
            $scope.profileproduct.designation4 = prof.Contact_designation_gid_4;
            $scope.profileproduct.emailid1 = prof.Contact_email;
            $scope.profileproduct.emailid2 = prof.Contact_email_2;
            $scope.profileproduct.emailid3 = prof.Contact_email_3;
            $scope.profileproduct.emailid4 = prof.Contact_email_4;
            $scope.profileproduct.mobilenumber1 = prof.Contact_mobileno;
            $scope.profileproduct.mobilenumber2_1 = prof.Contact_mobileno2;
            $scope.profileproduct.mobilenumber2 = prof.Contact_mobileno_2;
            $scope.profileproduct.mobilenumber2_2 = prof.Contact_mobileno2_2;
            $scope.profileproduct.mobilenumber3 = prof.Contact_mobileno_3;
            $scope.profileproduct.mobilenumber2_3 = prof.Contact_mobileno2_3;
            $scope.profileproduct.mobilenumber4 = prof.Contact_mobileno_4;
            $scope.profileproduct.mobilenumber2_4 = prof.Contact_mobileno2_4;
            $scope.profileproduct.landline1 = prof.Contact_landline;
            $scope.profileproduct.landline2_1 = prof.Contact_landline2;
            $scope.profileproduct.landline2 = prof.Contact_landline_2;
            $scope.profileproduct.landline2_2 = prof.Contact_landline2_2;
            $scope.profileproduct.landline3 = prof.Contact_landline_3;
            $scope.profileproduct.landline2_3 = prof.Contact_landline2_3;
            $scope.profileproduct.landline4 = prof.Contact_landline_4;
            $scope.profileproduct.landline2_4 = prof.Contact_landline2_4;

            if (prof.Contact_DOB==null)  {
                $scope.profileproduct.dobb1=null;
            }else
            {
                $scope.profileproduct.dobb1=new Date(prof.Contact_DOB);
            }
            if (prof.Contact_WD==null)  {
                $scope.profileproduct.weddy1=null;
            }else
            {
                $scope.profileproduct.weddy1=new Date(prof.Contact_WD);
            }

            if (prof.Contact_DOB_2==null)  {
                $scope.profileproduct.dobb2=null;
            }else
            {
                $scope.profileproduct.dobb2=new Date(prof.Contact_DOB_2);
            }
            if (prof.Contact_WD_2==null)  {
                $scope.profileproduct.weddy2=null;
            }else
            {
                $scope.profileproduct.weddy2=new Date(prof.Contact_WD_2);
            }

            if (prof.Contact_DOB_3==null)  {
                $scope.profileproduct.dobb3=null;
            }else
            {
                $scope.profileproduct.dobb3=new Date(prof.Contact_DOB_3);
            }
            if (prof.Contact_WD_3==null)  {
                $scope.profileproduct.weddy3=null;
            }else
            {
                $scope.profileproduct.weddy3=new Date(prof.Contact_WD_3);
            }

            if (prof.Contact_DOB_4==null)  {
                $scope.profileproduct.dobb4=null;
            }else
            {
                $scope.profileproduct.dobb4=new Date(prof.Contact_DOB_4);
            }
            if (prof.Contact_WD_4==null)  {
                $scope.profileproduct.weddy4=null;
            }else
            {
                $scope.profileproduct.weddy4=new Date(prof.Contact_WD_4);
            }

            $scope.profileproduct.Contact_ref_gid = prof.Contact_ref_gid_2;
            $scope.profileproduct.Contact_ref_gid_3 = prof.Contact_ref_gid_2;
            $scope.profileproduct.Contact_ref_gid = prof.Contact_ref_gid_3;
            $scope.profileproduct.Contact_reftable_gid = prof.Contact_ref_gid_4;
            $scope.profileproduct.Contact_reftable_gid_2 = prof.Contact_reftable_gid;
            $scope.profileproduct.Contact_reftable_gid_3 = prof.Contact_reftable_gid_2;
            $scope.profileproduct.Contact_reftable_gid_4 = prof.Contact_reftable_gid_3;
            $scope.profileproduct.Contact_reftable_gid = prof.Contact_reftable_gid_4;
            $scope.profileproduct.contact_reftablecode = prof.contact_reftablecode;
            $scope.profileproduct.contact_reftable_2 = prof.contact_reftablecode_2;
            $scope.profileproduct.contact_reftablecode_3 = prof.contact_reftablecode_3;
            $scope.profileproduct.contact_reftablecode_4 = prof.contact_reftablecode_4;
            $scope.profileproduct.age = prof.partnerproduct_age;
            $scope.profileproduct.partnerproduct_clientcontactgid1 = prof.partnerproduct_clientcontactgid1;
            $scope.profileproduct.partnerproduct_clientcontactgid2 = prof.partnerproduct_clientcontactgid2;
            $scope.profileproduct.partnerproduct_customercontactgid1 = prof.partnerproduct_customercontactgid1;
            $scope.profileproduct.partnerproduct_customercontactgid2 = prof.partnerproduct_customercontactgid2;
            modalshow('popup_product');
        }
        $scope.showview_pproduct = function(prof) {
            $scope.disabeld_pproduct=false;
            $scope.btnProfileProduct_Save = false;
            $scope.btnProfileProduct_Update = false;
            $scope.profileproduct.partnerproduct_gid=prof.partnerproduct_gid;
            $scope.profileproduct.contacttype1 = prof.Contact_contacttype_gid;
            $scope.profileproduct.contacttype2 = prof.Contact_contacttype_gid_2;
            $scope.profileproduct.contacttype3 = prof.Contact_contacttype_gid_3;
            $scope.profileproduct.contacttype4 = prof.Contact_contacttype_gid_4;
            $scope.profileproduct.producttype = prof.partnerproduct_type;
            $scope.profileproduct.name = prof.partnerproduct_name;
            $scope.profileproduct.personname1 = prof.Contact_personname;
            $scope.profileproduct.personname2 = prof.Contact_personname_2;
            $scope.profileproduct.personname3 = prof.Contact_personname_3;
            $scope.profileproduct.personname4 = prof.Contact_personname_4;
            $scope.profileproduct.designation1 = prof.Contact_designation_gid;
            $scope.profileproduct.designation2 = prof.Contact_designation_gid_2;
            $scope.profileproduct.designation3 = prof.Contact_designation_gid_3;
            $scope.profileproduct.designation4 = prof.Contact_designation_gid_4;
            $scope.profileproduct.emailid1 = prof.Contact_email;
            $scope.profileproduct.emailid2 = prof.Contact_email_2;
            $scope.profileproduct.emailid3 = prof.Contact_email_3;
            $scope.profileproduct.emailid4 = prof.Contact_email_4;
            $scope.profileproduct.mobilenumber1 = prof.Contact_mobileno;
            $scope.profileproduct.mobilenumber2_1 = prof.Contact_mobileno2;
            $scope.profileproduct.mobilenumber2 = prof.Contact_mobileno_2;
            $scope.profileproduct.mobilenumber2_2 = prof.Contact_mobileno2_2;
            $scope.profileproduct.mobilenumber3 = prof.Contact_mobileno_3;
            $scope.profileproduct.mobilenumber2_3 = prof.Contact_mobileno2_3;
            $scope.profileproduct.mobilenumber4 = prof.Contact_mobileno_4;
            $scope.profileproduct.mobilenumber2_4 = prof.Contact_mobileno2_4;
            $scope.profileproduct.landline1 = prof.Contact_landline;
            $scope.profileproduct.landline2_1 = prof.Contact_landline2;
            $scope.profileproduct.landline2 = prof.Contact_landline_2;
            $scope.profileproduct.landline2_2 = prof.Contact_landline2_2;
            $scope.profileproduct.landline3 = prof.Contact_landline_3;
            $scope.profileproduct.landline2_3 = prof.Contact_landline2_3;
            $scope.profileproduct.landline4 = prof.Contact_landline_4;
            $scope.profileproduct.landline2_4 = prof.Contact_landline2_4;
            $scope.profileproduct.dobb1 = $filter('date')(prof.Contact_DOB, "yyyy-MM-dd");
            $scope.profileproduct.weddy1 = $filter('date')(prof.Contact_WD, "yyyy-MM-dd");
            $scope.profileproduct.dobb2 = $filter('date')(prof.Contact_DOB_2, "yyyy-MM-dd");
            $scope.profileproduct.weddy2 = $filter('date')(prof.Contact_WD_2, "yyyy-MM-dd");
            $scope.profileproduct.dobb3 = $filter('date')(prof.Contact_DOB_3, "yyyy-MM-dd");
            $scope.profileproduct.weddy3 = $filter('date')(prof.Contact_WD_3, "yyyy-MM-dd");
            $scope.profileproduct.dobb4 = $filter('date')(prof.Contact_DOB_4, "yyyy-MM-dd");
            $scope.profileproduct.weddy4 = $filter('date')(prof.Contact_WD_4, "yyyy-MM-dd");
            $scope.profileproduct.Contact_ref_gid = prof.Contact_ref_gid_2;
            $scope.profileproduct.Contact_ref_gid_3 = prof.Contact_ref_gid_2;
            $scope.profileproduct.Contact_ref_gid = prof.Contact_ref_gid_3;
            $scope.profileproduct.Contact_reftable_gid = prof.Contact_ref_gid_4;
            $scope.profileproduct.Contact_reftable_gid_2 = prof.Contact_reftable_gid;
            $scope.profileproduct.Contact_reftable_gid_3 = prof.Contact_reftable_gid_2;
            $scope.profileproduct.Contact_reftable_gid_4 = prof.Contact_reftable_gid_3;
            $scope.profileproduct.Contact_reftable_gid = prof.Contact_reftable_gid_4;
            $scope.profileproduct.contact_reftablecode = prof.contact_reftablecode;
            $scope.profileproduct.contact_reftable_2 = prof.contact_reftablecode_2;
            $scope.profileproduct.contact_reftablecode_3 = prof.contact_reftablecode_3;
            $scope.profileproduct.contact_reftablecode_4 = prof.contact_reftablecode_4;
            $scope.profileproduct.age = prof.partnerproduct_age;
            $scope.profileproduct.partnerproduct_clientcontactgid1 = prof.partnerproduct_clientcontactgid1;
            $scope.profileproduct.partnerproduct_clientcontactgid2 = prof.partnerproduct_clientcontactgid2;
            $scope.profileproduct.partnerproduct_customercontactgid1 = prof.partnerproduct_customercontactgid1;
            $scope.profileproduct.partnerproduct_customercontactgid2 = prof.partnerproduct_customercontactgid2;
            modalshow('popup_product');
        }
        $scope.updatePartnerProfileProduct = function(profileproduct) {

            if (profileproduct.dobb1){
                $scope.update_profileproductdobb1 =  formatStringDate( profileproduct.dobb1, 'yyyy-mm-dd');
             }
             else
             {
                $scope.update_profileproductdobb1= null;
             }
            if (profileproduct.weddy1){
                $scope.update_profileproductweddy1= formatStringDate( profileproduct.weddy1, 'yyyy-mm-dd');
             }
             else
             {
                $scope.update_profileproductweddy1= null;
             }
             if (profileproduct.dobb2){
                $scope.update_profileproductdobb2 =  formatStringDate( profileproduct.dobb2, 'yyyy-mm-dd');
             }
             else
             {
                $scope.update_profileproductdobb2= null;
             }
            if (profileproduct.weddy2){
                $scope.update_profileproductweddy2= formatStringDate( profileproduct.weddy2, 'yyyy-mm-dd');
             }
             else
             {
                $scope.update_profileproductweddy2= null;
             }
             if (profileproduct.dobb3){
                $scope.update_profileproductdobb3 =  formatStringDate( profileproduct.dobb3, 'yyyy-mm-dd');
             }
             else
             {
                $scope.update_profileproductdobb3= null;
             }
            if (profileproduct.weddy3){
                $scope.update_profileproductweddy3= formatStringDate( profileproduct.weddy3, 'yyyy-mm-dd');
             }
             else
             {
                $scope.update_profileproductweddy3= null;
             }
             if (profileproduct.dobb4){
                $scope.update_profileproductdobb4 =  formatStringDate( profileproduct.dobb4, 'yyyy-mm-dd');
             }
             else
             {
                $scope.update_profileproductdobb4 = null;
             }
            if (profileproduct.weddy4){
                $scope.update_profileproductweddy4= formatStringDate( profileproduct.weddy4, 'yyyy-mm-dd');
             }
             else
             {
                $scope.update_profileproductweddy4= null;
             }
            var data = {
                "Params": {
                    "PartnerProduct_Gid": $scope.profileproduct.partnerproduct_gid,
                    "Client_Contact_ContactType_Gid": profileproduct.contacttype1,
                    "Client_Contact_PersonName": profileproduct.personname1,
                    "Client_Contact_Designation_Gid": profileproduct.designation1,
                    "Client_Contact_LandLine": profileproduct.landline1,
                    "Client_Contact_LandLine2": profileproduct.landline2_1,
                    "Client_Contact_MobileNo": profileproduct.mobilenumber1,
                    "Client_Contact_MobileNo2": profileproduct.mobilenumber2_1,
                    "Client_Contact_Email": profileproduct.emailid1,
                    "Client_Contact_DOB":$scope.update_profileproductdobb1,
                    "Client_Contact_WD":$scope.update_profileproductweddy1,
                    "Client_Contact_ContactType_Gid_2": profileproduct.contacttype2,
                    "Client_Contact_PersonName_2": profileproduct.personname2,
                    "Client_Contact_Designation_Gid_2": profileproduct.designation2,
                    "Client_Contact_LandLine_2": profileproduct.landline2,
                    "Client_Contact_LandLine2_2": profileproduct.landline2_2,
                    "Client_Contact_MobileNo_2": profileproduct.mobilenumber2,
                    "Client_Contact_MobileNo2_2": profileproduct.mobilenumber2_2,
                    "Client_Contact_Email_2": profileproduct.emailid2,
                    "Client_Contact_DOB_2": $scope.update_profileproductdobb2,
                    "Client_Contact_WD_2": $scope.update_profileproductweddy2,
                    "Customer_Contact_ContactType_Gid": profileproduct.contacttype3,
                    "Customer_Contact_PersonName": profileproduct.personname3,
                    "Customer_Contact_Designation_Gid": profileproduct.designation3,
                    "Customer_Contact_LandLine": profileproduct.landline3,
                    "Customer_Contact_LandLine2": profileproduct.landline2_3,
                    "Customer_Contact_MobileNo": profileproduct.mobilenumber3,
                    "Customer_Contact_MobileNo2": profileproduct.mobilenumber2_3,
                    "Customer_Contact_Email": profileproduct.emailid3,
                    "Customer_Contact_DOB": $scope.update_profileproductdobb3,
                    "Customer_Contact_WD": $scope.update_profileproductweddy3,
                    "Customer_Contact_ContactType_Gid_2": profileproduct.contacttype4,
                    "Customer_Contact_PersonName_2": profileproduct.personname4,
                    "Customer_Contact_Designation_Gid_2": profileproduct.designation4,
                    "Customer_Contact_LandLine_2": profileproduct.landline4,
                    "Customer_Contact_LandLine2_2": profileproduct.landline2_4,
                    "Customer_Contact_MobileNo_2": profileproduct.mobilenumber4,
                    "Customer_Contact_MobileNo2_2": profileproduct.mobilenumber2_4,
                    "Customer_Contact_Email_2": profileproduct.emailid4,
                    "Customer_Contact_DOB_2": $scope.update_profileproductdobb4,
                    "Customer_Contact_WD_2": $scope.update_profileproductweddy4,
                    "PartnerProduct_Type": profileproduct.producttype,
                    "PartnerProduct_Name": profileproduct.name
                },
                "Classification": {
                    "Update_By": 3,
                },
            }
            var total = {
                Group: 'Partner Product',
                Action: 'Product_Update',
                Type: 'Partner Product',
                data: data
            }
            $scope.partnerprofile = [];
            $scope.loading();
            var set_partnerprofile = Servicedrctsale.PartnerProductSet(total)
            set_partnerprofile.then(function(result) {
                    alert(JSON.stringify(result.data));
                    $scope.partnerprofile = result.data.Data;
                    loadData_PartnerProfileProduct();
                    modalhide('popup_product');
                }),
                function(err) {
                    alert('no data');
                }.finally($scope.endloading());
        }
         loadData_PartnerProfileProduct();
        function loadData_PartnerProfileProduct() {
            var data = {
                "Params": {
                    "Filter": {
                    "PartnerProduct_Gid":$scope.partner_gid,
                    "Mst_Table": $scope.msttable,
                    },
                    "Classification": {
                        "Entity_Gid": $scope.entity_gid
                    }
                }
            }
            var dpart = {
                Group: 'Partner Product',
                Type: 'Atma_Product_Get',
                data: data
            }
            $scope.getprofileproduct = [];
            var getprofileproduct = Servicedrctsale.get_profileproduct(dpart)
            getprofileproduct.then(function(result) {
                //alert(JSON.stringify(result.data));
                //alert('12')
                $scope.getprofileproduct = result.data.DATA;
                //alert(JSON.stringify($scope.getprofileproduct));
                $scope.searchproductprofile = $scope.getprofileproduct;
                $scope.pageLength = $scope.getprofileproduct.length;
            }, function(err) {
                alert('No data!.');
            }).finally();
        }

        $scope.profileproductname = function(e) {
            $scope.getprofileproduct = $filter('filter')($scope.getprofileproduct, {
                "partnerproduct_name": e.name1,
                "partnerproduct_type": e.producttype1
            });
        }

//alert(JSON.stringify($scope.basicprofile.partnerprofile_branchcount);
//PARTNERPRODUCT END PAGE

$scope.close_fun=function(e){

var r = confirm("Press Ok to Close This Window");
            if(e=="client"){
                if (r == true) {
                    modalhide('ClientAddPopup');
                }else{
                 modalshow('ClientAddPopup');
                }
             }
             if(e=="catalog_deta"){
                if (r == true) {
                    modalhide('addcatalogdetailspopup');
                }else{
                 modalshow('addcatalogdetailspopup');
                }
             }
             if(e=="pdf_popup"){
                if (r == true) {
                    modalhide('viewpdfpopup');
                }else{
                 modalshow('viewpdfpopup');
                }
             }
             if(e=="pdf_tax_popup"){
                if (r == true) {
                    modalhide('tax_viewpdfpopup');
                }else{
                 modalshow('tax_viewpdfpopup');
                }
             }
            if(e=="branch"){
                if (r == true) {
                    modalhide('BranchAddPopup');
                }else{
                 modalshow('BranchAddPopup');
                }
            }
            if(e=="product"){
                if (r == true) {
                    modalhide('popup_product');
                }else{
                 modalshow('popup_product');
                }
            }
            if(e=="contract"){
                if (r == true) {
                    modalhide('ContractAddPopup');
                }else{
                 modalshow('ContractAddPopup');
                }
            }
            if(e=="tax"){
                if (r == true) {
                    modalhide('taxdetailsmodal');
                }else{
                 modalshow('taxdetailsmodal');
                }
            }
            if(e=="paymode"){
                if (r == true) {
                    modalhide('mdl_present');
                }else{
                 modalshow('mdl_present');
                }
            }
            if(e=="activity"){
                if (r == true) {
                    modalhide('Activity_showpopup');
                }else{
                 modalshow('Activity_showpopup');
                }
            }
            if(e=="Act_details"){
                if (r == true) {
                    modalhide('addactivitydetailspopup');
                }else{
                 modalshow('addactivitydetailspopup');
                }
            }
    }

});
//SERVICESTART

app_review.service("Servicedrctsale", function($http) {

//PARTNERPRODUCT SERVICE START
this.getpartnerprodtact = function(partnerprod) {
        var respons = $http.post(Appname + "/prodget/", partnerprod);
        return respons;
    }
    this.getdesigdata = function(pdesig) {
        var respons = $http.post(Appname + "/prodget/", pdesig);
        return respons;
    }
    this.getcontdata = function(pcont) {
        var respons = $http.post(Appname + "/prodget/", pcont);
        return respons;
    }
    this.PartnerProductSet = function(total) {
        var response = $http.post(Appname + "/atma_profileproduct_set/", total);
        return response;
    }
    this.get_profileproduct = function(dpart) {
        var respons = $http.post(Appname + "/atma_profileproduct_get/", dpart);
        return respons;
    }

//PARTNERPRODUCT SERVICE END

//ActivityServiceStart

this.getactdata = function(pact) {
        var respons = $http.post(Appname + "/prodget/", pact);
        return respons;
    }
    this.getbranchactivity = function(bactivity) {
        debugger;
        var respons = $http.post(Appname + "/prodget/", bactivity);
        return respons;
    }
    this.getrmactivity = function(pact) {

        var respons = $http.post(Appname + "/prodget/", pact);
        return respons;
    }
    this.getcustgrp = function(d) {
            var response = $http.get(Appname + "/get_contctgroup/");
            return response;
        }
    this.getdesg = function() {
            var response = $http.get(Appname + "/desgjson/");
            return response;
        }
       this.getdattam = function(dtam) {
        var respons = $http.post(Appname + "/atma_activity_get/", dtam);
        return respons;
    }
    this.ActivityaddService = function(details) {
       var response = $http.post(Appname + "/atma_activityaddedit/", details);
       return response;
   }
   this.updateactgrp = function(details) {
       var response = $http.post(Appname + "/atma_activityaddedit/", details);
       return response;
   }
//ActivityServiceEnd

//AttachmentServiceStart
    this.getdocdata = function(pdoc) {
        var respons = $http.post(Appname + "/prodget/", pdoc);
        return respons;
    }
    this.getdocnamedata = function(pdocname) {
        var respons = $http.post(Appname + "/prodget/", pdocname);
        return respons;
    }
    this.setdocgrp = function(details) {
        var response = $http.post(Appname + "/atma_attachmentupload/", details, {
            transformRequest: angular.identity,
            headers: {
                'Content-Type': undefined
            }
        });
        return response;
    }
    this.get_attachmentsummary = function(dtam) {
        var respons = $http.post(Appname + "/atma_doc_get/", dtam);
        return respons;
    }
    this.updateattachmentdetails = function(custid) {
			var respons = $http.post(Appname + "/atma_updateattacment_details/",
				custid, {
					transformRequest: angular.identity,
					headers: {
						'Content-Type': undefined
					}
				}
			);
			return respons;
	}
//AttachmentServiceEnd

    this.getpartnertype = function(ppartner) {
        var respons = $http.post(Appname + "/prodget/", ppartner);
        return respons;
    }

    this.getpartnergroupdata = function(partnergroup) {
        var respons = $http.post(Appname + "/prodget/", partnergroup);
        return respons;
    }


    this.get_director= function(get_data) {
        var response = $http.post(Appname + "/atma_getdirectordata/", get_data);
        return response;
    }

    this.getorgpartnerdata = function(opartner) {
        var respons = $http.post(Appname + "/prodget/", opartner);
        return respons;
    }
    this.getpartnerclassificationdata = function(ppartnerclassification) {
        var respons = $http.post(Appname + "/prodget/", ppartnerclassification);
        return respons;
    }
    this.getpartnercustcatdata = function(ppartnercustcat) {
        var respons = $http.post(Appname + "/prodget/", ppartnercustcat);
        return respons;
    }
    this.getprodt = function(trans) {
        var respons = $http.post(Appname + "/prodget/", trans);
        return respons;
    }
    this.partnerheader_set = function(total) {
        var response = $http.post(Appname + "/atmaPartnerPayment_Set/", total);
        return response;
    }
    this.atma_fileupload = function(custid) {
        var respons = $http.post(Appname + "/atma_fileuploadurl/",
            custid, {
                transformRequest: angular.identity,
                headers: {
                    'Content-Type': undefined
                }
            }
        );
        return respons;
    }

    //Pament service start
    this.getpaymodedata = function(data) {
        var respons = $http.post(Appname + "/prodget/", data);
        return respons;
    }
    this.getbankdata = function(data) {
        var respons = $http.post(Appname + "/prodget/", data);
        return respons;
    }
    this.getbranch_paymentpartner = function(pbranch) {
        debugger;
        var respons = $http.post(Appname + "/prodget/", pbranch);
        return respons;
    }
    this.getbranchdata = function(data) {
        var respons = $http.post(Appname + "/prodget/", data);
        return respons;
    }
    this.getpaymodebranchdata = function(data) {
			var respons = $http.post(Appname + "/prodget/", data);
			return respons;
		}
    this.get_atmapayment = function(data) {
        var respons = $http.post(Appname + "/atma_getdata/", data);
        return respons;
    }
    this.getbranchdetails = function(data) {
        var respons = $http.post(Appname + "/atma_branchdetailsdropdown/", data);
        return respons;
    }
    this.getaccounttypedata = function(paymentaccount_type) {
        var respons = $http.post(Appname + "/prodget/", paymentaccount_type);
        return respons;
    }
    this.Paymentaddheader = function(total) {
        var response = $http.post(Appname + "/atmaPartnerPayment_Set/", total);
        return response;
    }
    //Pamentserviceend

    //tax services start

    this.gettaxtypedata = function (total) {
            var response = $http.post(Appname + "/atma_gettaxdetails/", total);
            return response;
        }
        this.gettaxreateedata = function (data) {
            var respons = $http.post(Appname + "/prodget/", data);
            return respons;
        }
        this.getbranch_taxpartner = function(taxbranch) {
        debugger;
        var respons = $http.post(Appname + "/prodget/", taxbranch);
        return respons;
    }
        this.getisexcempteddata = function (data) {
        var respons = $http.post(Appname + "/prodget/", data);
        return respons;
        }

        this.taxinsert = function(details) {
        var response = $http.post(Appname + "/atma_taxdetailsfileupload/", details, {
            transformRequest: angular.identity,
            headers: {
                'Content-Type': undefined
            }
        });
        return response;
        }
        this.taxupdate_details = function(details) {
        var response = $http.post(Appname + "/atma_taxdetailsfileupload/", details, {
            transformRequest: angular.identity,
            headers: {
                'Content-Type': undefined
            }
        });
        return response;
        }
        this.get_atmataxdetails = function (data) {
        var respons = $http.post(Appname + "/atma_gettaxdetails/", data);
        return respons;
        }
        this.getmsmetaxdata = function (data) {
            var respons = $http.post(Appname + "/prodget/", data);
            return respons;
        }
        //taxservicesend

        //ClientDetailsStart

          this.getstateddl = function(d) {
            var response = $http.get(Appname + "/stateddl/");
            return response;
        }
        this.getpincodeall = function(pincode) {
            var response = $http.get(Appname + "/allpinget/", {
                params: {
                    "pincode": pincode
                }
            });
            return response;
        }

        this.getpincode = function(city_gid) {
            var response = $http.get(Appname + "/pincode/", {
                params: {
                    "city_gid": city_gid
                }
            });
            return response;
        }
        this.getdistddl = function(state_gid) {
            var response = $http.get(Appname + "/districtddl/", {
                params: {
                    "state_gid": state_gid
                }
            });
            return response;
        }
        this.getcityddl = function(district_gid) {
            var response = $http.get(Appname + "/cityddl/", {
                params: {
                    "district_gid": district_gid
                }
            });
            return response;
        }

        this.clientaddService = function(data) {
        var respons = $http.post(Appname + "/atma_SetClientdetails/", data);
        return respons;
    }
    this.clientgetService = function(data) {
        var respons = $http.post(Appname + "/atma_SetClientdetails/", data);
        return respons;
    }
    this.clientupdateService = function(data) {
        var respons = $http.post(Appname + "/atma_SetClientdetails/", data);
        return respons;
    }
        //Client Details End
        //contract Details Srart

    this.contractsetService = function(data) {
        var respons = $http.post(Appname + "/atma_SetContractdetails/", data);
        return respons;
    }
    this.contractgetService = function(data) {
        var respons = $http.post(Appname + "/atma_SetContractdetails/", data);
        return respons;
    }
    this.contractupdateService = function(data) {
        var respons = $http.post(Appname + "/atma_SetContractdetails/", data);
        return respons;
    }
        //contract Details end

        //branch Details start page...!
    this.branchsetService = function(data) {
        var respons = $http.post(Appname + "/atma_SetBranchdetails/", data);
        return respons;
    }
    this.branchgetService = function(data) {
        var respons = $http.post(Appname + "/atma_SetBranchdetails/", data);
        return respons;
    }
    this.branchupdateService = function(data) {
        var respons = $http.post(Appname + "/atma_SetBranchdetails/", data);
        return respons;
    }

        //branch Details end page...!
        //basic profile Details Start page...!
    this.basicprofilesetService = function(data) {
        var respons = $http.post(Appname + "/atma_Setbasicprofildedetails/", data);
        return respons;
    }
    this.basicprofilegetService = function(data) {
        var respons = $http.post(Appname + "/atma_Setbasicprofildedetails/", data);
        return respons;
    }

        //basic profile Details End page...!

     this.getdattamactivity = function (dtamactivity) {
            var respons = $http.post(Appname + "/atma_activitydetailsget/", dtamactivity);
            return respons;
        }
     this.setactdetails = function (details) {
            var response = $http.post(Appname + "/atma_activitydetailsset/", details);
            return response;
        }
       this.getraiserdata = function (praiser) {
            var respons = $http.post(Appname + "/prodget/", praiser);
            return respons;
        }
         this.getapproverdata = function (papprover) {
            var respons = $http.post(Appname + "/prodget/", papprover);
            return respons;
        }
        this.updateactdetails = function (dtamactivity) {
            var respons = $http.post(Appname + "/atma_activitydetailsset/", dtamactivity);
            return respons;
        }
        //start catalog
        this.getdattams = function (dtam) {
            var respons = $http.post(Appname + "/atmacatalog_get/", dtam);
            return respons;
        }
         this.getprodtuom = function (transuom) {
            var respons = $http.post(Appname + "/prodget/", transuom);
            return respons;
        }
        this.partnerproductgidservice = function (dtam) {
            var respons = $http.post(Appname + "/prodget/", dtam);
            return respons;
        }
        this.pcatalog = function (total) {
            var response = $http.post(Appname + "/atmacatalogset/", total);
            return response;
        }
        this.updatecatalogservice = function (dtam) {
            var respons = $http.post(Appname + "/atmacatalogset/", dtam);
            return respons;
        }
         this.checkergetService = function(get_data) {
        var response = $http.post(Appname + "/atma_CheckerDetails/", get_data);
        return response;
    }
    this.assigncatalogService = function(get_data) {
        var response = $http.post(Appname + "/atmacatalogset/", get_data);
        return response;
    }
});

</script>
{% endblock %}
